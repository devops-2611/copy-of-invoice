import{z as O,j as r,Q as z,S as P,I as A,r as p,M as K,A as w,F as G,V as Y,N as V,R as H,t as U,l as W,P as q,G as B,k as I,D as T}from"./index-BDS8Zh-4.js";import{A as Q}from"./AppTabs-CNZvlIg9.js";import{c as _,B as $,o as E,u as Z,M as J,a as X,D as ee,F as ae}from"./MUIThemeProvider-B4bX1qBk.js";import{u as re,A as M,a as j}from"./ApiConstants-CdfQ_uAX.js";import{A as te}from"./AppChipComponent-BF78w1_k.js";import{I as se}from"./IconCreditCardPay-DVflfq5X.js";import{R as le}from"./helperFuntions-BTpvtHBU.js";import{c as oe,g as ie,F as ne,h as ce}from"./index.esm-B_xLMHMf.js";import{F as de,U as me,I as ue}from"./UploadOrderErrorDisplay-DbXanmfe.js";import{u as fe,S as pe,L as ye}from"./DateTimePicker-CE81UsHd.js";import{T as N}from"./Text-JJVpRIZE.js";import"./IconX-BroLQfEp.js";import"./Alert-BUxpPlYV.js";import"./index-DKyDv0ww.js";import"./List-YcmB9FhM.js";import"./Card-BSGj5qUC.js";import"./Title-Cq8rOHww.js";/**
 * @license @tabler/icons-react v3.21.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var be=O("outline","clipboard-list","IconClipboardList",[["path",{d:"M9 5h-2a2 2 0 0 0 -2 2v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-12a2 2 0 0 0 -2 -2h-2",key:"svg-0"}],["path",{d:"M9 3m0 2a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v0a2 2 0 0 1 -2 2h-2a2 2 0 0 1 -2 -2z",key:"svg-1"}],["path",{d:"M9 12l.01 0",key:"svg-2"}],["path",{d:"M13 12l2 0",key:"svg-3"}],["path",{d:"M9 16l.01 0",key:"svg-4"}],["path",{d:"M13 16l2 0",key:"svg-5"}]]);/**
 * @license @tabler/icons-react v3.21.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var he=O("outline","currency-euro","IconCurrencyEuro",[["path",{d:"M17.2 7a6 7 0 1 0 0 10",key:"svg-0"}],["path",{d:"M13 10h-8m0 4h8",key:"svg-1"}]]);const Se=_(r.jsx("path",{d:"M22 16V4c0-1.1-.9-2-2-2H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2m-11-4 2.03 2.71L16 11l4 5H8zM2 6v14c0 1.1.9 2 2 2h14v-2H4V6z"}),"Collections");function F(e){return P(e,"DD MMM YYYY hh:mm A").format("YYYY-MM-DDTHH:mm:ss.SSS[Z]")}const x=["merchantId","pageNo","limit","customerId","orderType","paymentType","confirmationStatus","status","paymentStatus","branchName","orderId"],De=e=>{let t={};return e==null||e.forEach(s=>{var a;x!=null&&x.includes(s.id)&&(Array.isArray(s.value)?t[s.id]=(a=s.value)==null?void 0:a.join(","):t[s.id]=s.value)}),t},Ce=e=>{var n,u;let t="";const s=(n=e==null?void 0:e[0])==null?void 0:n.id,a=(u=e==null?void 0:e[0])==null?void 0:u.desc;if(s==="customerFirstName"&&!a?t="ascFirstName":s==="customerFirstName"&&a?t="descFirstName":s==="customerLastName"&&!a?t="ascLastName":s==="customerLastName"&&a?t="descLastName":s==="orderDate"&&!a?t="ascOrder":s==="orderDate"&&a&&(t="descOrder"),t)return{sort:t}},ve=e=>{let t="",s="";const a=e==null?void 0:e.find(n=>n.id==="orderDate");if(a&&Array.isArray(a==null?void 0:a.value)&&(t=a!=null&&a.value[0]?F(a==null?void 0:a.value[0]):"",s=a!=null&&a.value[1]?F(a==null?void 0:a.value[1]):""),t||s)return{startDate:t,endDate:s}};function Te(e,t,s){const a={merchantId:null,pageNo:s.pageIndex+1,limit:s.pageSize,...Ce(t),...De(e),...ve(e)};return M.GET(j.GET_ALL_ORDERS(),{params:a})}const xe=e=>{const{columnFilters:t,EnableQuery:s,sorting:a,pagination:n}=e;return re({queryKey:["Orders-Grid-data",t,a,n],queryFn:()=>Te(t,a,n),placeholderData:z,enabled:s,refetchOnMount:!1,refetchOnWindowFocus:!1,retry:2})},g=({renderedCellValue:e})=>r.jsxs($,{sx:{display:"flex",alignItems:"center",gap:"0.5rem",justifyContent:"center"},children:[e==="CASH"&&r.jsx(he,{}),e==="CARD"&&r.jsx(se,{}),e==="DELIVERY"&&r.jsx(A,{}),e==="COLLECTION"&&r.jsx(Se,{}),r.jsx("span",{children:e})]}),ge=[{key:"merchantId",name:"merchantId",fieldType:"Number",label:"Merchant ID",disabled:{disabledFieldForNew:!1}},{key:"orderId",name:"orderId",fieldType:"Number",label:"Order ID",disabled:{disabledFieldForNew:!0,disableFieldForEdit:!0}},{key:"orderDate",name:"orderDate",fieldType:"DateTimeRange",label:"Order Date",disabled:{disabledFieldForNew:!1,disableFieldForEdit:!0}},{key:"customerId",name:"customerId",fieldType:"Number",label:"Customer ID",disabled:{disabledFieldForNew:!1}},{key:"customerFirstName",name:"customerFirstName",fieldType:"Text",label:"Customer First Name"},{key:"customerLastName",name:"customerLastName",fieldType:"Text",label:"Customer Last Name"},{key:"orderType",name:"orderType",fieldType:"Select",label:"Order Type",meta:{options:[{label:"DELIVERY",value:"DELIVERY"},{label:"COLLECTION",value:"COLLECTION"}]}},{key:"paymentType",name:"paymentType",fieldType:"Select",label:"Payment Type",meta:{options:[{label:"CASH",value:"CASH"},{label:"CARD",value:"CARD"}]}},{key:"paymentStatus",name:"paymentStatus",fieldType:"Select",label:"Payment Status",meta:{options:[{label:"COMPLETED",value:"COMPLETED"},{label:"PENDING",value:"PENDING"},{label:"PROCESSED",value:"PROCESSED"}]}},{key:"confirmationStatus",name:"confirmationStatus",fieldType:"Select",label:"Confirmation Status",meta:{options:[{label:"COMPLETED",value:"COMPLETED"},{label:"PENDING",value:"PENDING"}]}},{key:"promoCode",name:"promoCode",fieldType:"Text",label:"Promo Code"},{key:"promoDiscountSwishr",name:"promoDiscountSwishr",fieldType:"Number",label:"Promo Discount (SWISHR)"},{key:"promoDiscountMerchant",name:"promoDiscountMerchant",fieldType:"Number",label:"Promo Discount (Merchant)"},{key:"refundSwishr",name:"refundSwishr",fieldType:"Number",label:"Refund (SWISHR)"},{key:"refundMerchant",name:"refundMerchant",fieldType:"Number",label:"Refund (Merchant)"},{key:"orderDiscount",name:"orderDiscount",fieldType:"Number",label:"Order Discount"},{key:"driverTip",name:"driverTip",fieldType:"Number",label:"Driver Tip"},{key:"deliveryCharge",name:"deliveryCharge",fieldType:"Number",label:"Delivery Charge"},{key:"serviceFee",name:"serviceFee",fieldType:"Number",label:"Service Fee"},{key:"surcharge",name:"surcharge",fieldType:"Number",label:"Surcharge"},{key:"subTotal",name:"subTotal",fieldType:"Number",label:"Sub Total"},{key:"taxes",name:"taxes",fieldType:"Number",label:"Taxes"},{key:"total",name:"total",fieldType:"Number",label:"Total"},{key:"branchName",name:"branchName",fieldType:"Text",label:"Branch Name"},{key:"status",name:"status",fieldType:"Select",label:"Status",meta:{options:E}}],Ee=({data:e,columns:t})=>{const s=Z({columns:t,data:e,enableFullScreenToggle:!1,enableHiding:!1});return r.jsx(J,{table:s})},Ie=()=>{var m,i;const[e,t]=p.useState([]),[s,a]=p.useState([]),[n,u]=p.useState({pageIndex:0,pageSize:10}),[y,{open:b,close:h}]=K(!1),{data:d,isError:C,isLoading:S}=xe({columnFilters:e,EnableQuery:!y,sorting:s,pagination:n}),D=p.useMemo(()=>[{accessorKey:"merchantId",header:"Merchant ID",enableSorting:!1,size:150},{accessorKey:"orderId",header:"Order ID",enableSorting:!1,size:150},{accessorKey:"customerId",header:"Customer ID",enableSorting:!1,size:150,enableEditing:!1},{accessorKey:"branchName",header:"Branch Name",enableSorting:!1},{accessorKey:"orderDate",accessorFn:l=>new Date(l.orderDate),header:"Order Date",filterVariant:"datetime-range",Cell:({cell:l})=>{const o=l.getValue();return P(o).format("DD MMM YYYY hh:mm A")},muiFilterDateTimePickerProps:{label:"Order Date",timeSteps:{minutes:1}},maxSize:150},{accessorKey:"customerFirstName",header:"Customer First Name",enableColumnFilter:!1},{accessorKey:"customerLastName",header:"Customer Last Name",enableColumnFilter:!1},{accessorKey:"orderType",header:"Order Type",filterVariant:"multi-select",filterSelectOptions:[{label:"DELIVERY",value:"DELIVERY"},{label:"COLLECTION",value:"COLLECTION"}],enableSorting:!1,maxSize:30,Cell:({renderedCellValue:l})=>g({renderedCellValue:l})},{accessorKey:"paymentType",header:"Payment Type",filterVariant:"multi-select",filterSelectOptions:[{label:"CASH",value:"CASH"},{label:"CARD",value:"CARD"}],enableSorting:!1,maxSize:30,Cell:({renderedCellValue:l})=>g({renderedCellValue:l})},{accessorKey:"paymentStatus",header:"Payment Status",filterVariant:"multi-select",filterSelectOptions:[{label:"COMPLETED",value:"COMPLETED"},{label:"PENDING",value:"PENDING"},{label:"PROCESSED",value:"PROCESSED"}],enableSorting:!1,maxSize:30},{accessorKey:"confirmationStatus",header:"Confirmation Status",filterVariant:"multi-select",filterSelectOptions:[{label:"COMPLETED",value:"COMPLETED"},{label:"PENDING",value:"PENDING"}],enableSorting:!1,maxSize:30},{accessorKey:"promoCode",header:"Promo Code",enableSorting:!1,enableColumnFilter:!1,maxSize:30},{accessorKey:"promoDiscountSwishr",header:"Promo Discount (SWISHR)",enableSorting:!1,enableColumnFilter:!1,maxSize:50},{accessorKey:"promoDiscountMerchant",header:"Promo Discount (Merchant)",enableSorting:!1,enableColumnFilter:!1,maxSize:50},{accessorKey:"refundSwishr",header:"Refund (SWISHR)",enableSorting:!1,enableColumnFilter:!1,maxSize:30},{accessorKey:"refundMerchant",header:"Refund (Merchant)",enableSorting:!1,enableColumnFilter:!1,maxSize:30},{accessorKey:"orderDiscount",header:"Order Discount",enableSorting:!1,enableColumnFilter:!1,maxSize:30},{accessorKey:"driverTip",header:"Driver Tip",enableSorting:!1,enableColumnFilter:!1,maxSize:30},{accessorKey:"deliveryCharge",header:"Delivery Charge",filterVariant:"range-slider",enableSorting:!1,enableColumnFilter:!1,maxSize:30,Cell:({renderedCellValue:l})=>g({renderedCellValue:l})},{accessorKey:"serviceFee",header:"Service Fee",enableSorting:!1,enableColumnFilter:!1,maxSize:30},{accessorKey:"surcharge",header:"Surcharge",enableSorting:!1,enableColumnFilter:!1,maxSize:30},{accessorKey:"subTotal",header:"Sub Total",enableSorting:!1,enableColumnFilter:!1,maxSize:30},{accessorKey:"taxes",header:"Taxes",enableSorting:!1,enableColumnFilter:!1,maxSize:30},{accessorKey:"total",header:"Total",enableSorting:!1,enableColumnFilter:!1,maxSize:30},{accessorKey:"orderItems",header:"Order Items",enableSorting:!1,Cell:({row:l})=>r.jsx(w,{variant:"transparent",onClick:()=>{var o,c;return G.open({title:r.jsx(Y,{icon:r.jsx(be,{}),color:"teal",title:`Order Items for Order ID: ${(o=l==null?void 0:l.original)==null?void 0:o.orderId}`,mt:"md",withCloseButton:!1,styles:{root:{boxShadow:"none"}}}),children:r.jsx(Ee,{data:((c=l==null?void 0:l.original)==null?void 0:c.orderItems)??[],columns:[{header:"Product",accessorKey:"product"},{header:"Quantity",accessorKey:"quantity"}]}),size:"xl"})},children:r.jsx(V,{color:"green"})})},{accessorKey:"feedback",header:"Feedback",enableSorting:!1,enableColumnFilter:!1,maxSize:60,Cell:({cell:l})=>l.getValue()?r.jsx(le,{value:l.getValue(),readOnly:!0,m:"auto"}):void 0},{accessorKey:"status",header:"Status",maxSize:60,Cell:({cell:l})=>{var o,c;return r.jsx(te,{value:((c=(o=E)==null?void 0:o.find(v=>v.value===l.getValue()))==null?void 0:c.label)??""})},filterVariant:"multi-select",enableSorting:!1,filterSelectOptions:E,editSelectOptions:[{label:"COMPLETED",value:"COMPLETED"},{label:"PENDING",value:"PENDING"}]}],[]);return r.jsx(X,{children:r.jsx(ee,{data:((m=d==null?void 0:d.data)==null?void 0:m.orders)??[],columnFilters:e,columns:D,pagination:n,sorting:s,totalRowCount:((i=d==null?void 0:d.data)==null?void 0:i.totalCount)??0,onColumnFiltersChange:t,onPaginationChange:u,onSortingChange:a,isLoading:S,OnFilterButtonClicked:()=>b(),OnApplyFiltersClicked:()=>h(),filterDrawerIsOpen:y,enableRowSelection:!0,isError:C,tableName:"OrdersDisplay",columnPinning:{left:["mrt-row-select","mrt-row-actions","orderId","customerId","branchName"],right:["status"]},crudOperationHeader:"Order",uniqueIDForRows:"orderID",uiSchema:ge})})},Ne=async e=>{const t=new FormData;return e.csvfile.forEach(s=>{t.append("files",s)}),await M.POST(j.UPLOAD_AND_PARSE_DOCUMENT(),t)},Fe=()=>fe({mutationFn:Ne}),Oe=oe({csvfile:ie().min(1,"You must upload at least one file.").required("CSV file is required.")}),Pe=()=>{var S,D;const e={csvfile:[]},t=p.useRef(null),{mutate:s,error:a,reset:n,isPending:u}=Fe(),[y,b]=H.useState(!1),h=U(),d=W(),C=m=>{s({csvfile:m.csvfile},{onSuccess:i=>{var l,o;T.show({title:"Success",message:((l=i.data)==null?void 0:l.message)||"File uploaded successfully.",color:"green",position:"top-center",withCloseButton:!0,autoClose:!0}),(o=t.current)==null||o.resetForm(),d.invalidateQueries({queryKey:["Orders-Grid-data"]}),b(!0)},onError:i=>{var l,o,c;T.show({title:"Error",message:((o=(l=i.response)==null?void 0:l.data)==null?void 0:o.message)||"Failed to upload files.",color:"red"}),(c=t.current)==null||c.setErrors(i),b(!1)}})};return r.jsx(q,{shadow:"sm",p:20,children:r.jsxs(pe,{gap:20,pos:"relative",children:[r.jsx(N,{size:"lg",style:{fontWeight:"600"},children:"Upload Excel or CSV file to store order details. (Multiple files can be uploaded)"}),r.jsx(ne,{initialValues:e,validationSchema:Oe,onSubmit:C,innerRef:t,onReset:()=>n(),children:({values:m,errors:i,touched:l,setFieldValue:o})=>{const c=f=>{o("csvfile",[...m.csvfile,...f])},v=f=>{T.show({title:"Invalid Files",message:"Some files were rejected due to invalid format.",color:"red"}),console.error("Rejected files:",f)},k=f=>{const L=m.csvfile.filter(R=>R.name!==f);o("csvfile",L),n()};return r.jsxs(ce,{children:[r.jsx(de,{onDrop:c,onReject:v,uploadedFiles:m.csvfile,onDeleteFile:k,dropzoneText:{title:"Upload files with relevant data",description:"You can upload at max 10 files with size not exceeding 5 MB",rejectMessage:"Invalid file type. Only CSV files are allowed."},maxFiles:10}),(i==null?void 0:i.csvfile)&&(l==null?void 0:l.csvfile)&&r.jsx("div",{style:{color:"red",marginTop:"10px"},children:i==null?void 0:i.csvfile}),r.jsxs(B,{mt:"md",justify:"center",children:[r.jsx(I,{type:"submit",loading:!1,children:"Submit"}),r.jsx(I,{type:"reset",variant:"outline",children:"Reset"})]})]})}}),r.jsx(ye,{visible:u,zIndex:1e3,overlayProps:{radius:"sm",blur:2}}),((S=t.current)==null?void 0:S.errors)&&r.jsx(me,{response:(D=a==null?void 0:a.response)==null?void 0:D.data}),y&&r.jsxs(ae,{direction:"column",align:"center",mt:"10px",children:[r.jsx(ue,{stroke:2,size:40,color:h.colors.green[6]}),r.jsxs(N,{size:"lg",style:{fontWeight:"600",color:h.colors.gray[7],textAlign:"center"},children:[" ",'Orders are saved successfully. You can see uploaded orders by switching tab to "All Orders".']})]})]})})};function Qe(){const e=[{label:"All Orders",value:"All_Orders",content:r.jsx(Ie,{})},{label:"Upload Files",value:"Upload_Files",content:r.jsx(Pe,{})}];return r.jsx(Q,{tabs:e})}export{Qe as default};
