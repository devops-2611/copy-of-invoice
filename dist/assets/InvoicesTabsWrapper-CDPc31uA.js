import{f as E,u as V,c as H,j as n,B as G,g as ee,h as z,aa as De,s as Ie,ab as $e,r as C,b as ye,e as qe,a as Ke,v as We,z as Re,S as M,M as te,Q as Se,L as Ce,N as je,X as Pe,G as Z,l as He,D as ue,F as he,V as Ue,P as Be,k as me,ac as Qe}from"./index-BDS8Zh-4.js";import{A as Xe}from"./AppTabs-CNZvlIg9.js";import{I as Ze,b as Je,d as et,C as ve,e as tt,a as ke,D as Me,f as at,g as st,h as nt}from"./MUIThemeProvider-B4bX1qBk.js";import{u as Ae,A as ae,a as se}from"./ApiConstants-CdfQ_uAX.js";import{a as rt,I as ot}from"./InvoiceParameters-C__hZVaP.js";import{i as Ye,j as it,I as lt,a as _e,u as ct,e as ze,k as dt,c as ut,g as pe,b as ht,F as mt,h as pt}from"./index.esm-B_xLMHMf.js";import{I as Ne}from"./IconX-BroLQfEp.js";import{s as Te,d as we,e as ft,f as Fe,h as Ee,p as gt,i as bt,j as _,C as xt,u as Dt,A as It,T as F,S as fe,L as yt}from"./DateTimePicker-CE81UsHd.js";import{T as J}from"./Text-JJVpRIZE.js";import{A as St}from"./AppChipComponent-BF78w1_k.js";import{C as Ct}from"./Container-ChFYAoo1.js";import{T as jt}from"./Title-Cq8rOHww.js";import"./Alert-BUxpPlYV.js";import"./helperFuntions-BTpvtHBU.js";import"./List-YcmB9FhM.js";const[Pt,ne]=Ye(),[vt,kt]=Ye();var U={root:"m_7cda1cd6","root--default":"m_44da308b","root--contrast":"m_e3a01f8",label:"m_1e0e6180",remove:"m_ae386778",group:"m_1dcfd90b"};const Mt={},At=ee((e,{gap:t},{size:s})=>({group:{"--pg-gap":t!==void 0?z(t):z(s,"pg-gap")}})),re=E((e,t)=>{const s=V("PillGroup",Mt,e),{classNames:a,className:r,style:o,styles:u,unstyled:h,vars:I,size:c,disabled:f,...y}=s,g=ne(),d=(g==null?void 0:g.size)||c||void 0,b=H({name:"PillGroup",classes:U,props:s,className:r,style:o,classNames:a,styles:u,unstyled:h,vars:I,varsResolver:At,stylesCtx:{size:d},rootSelector:"group"});return n.jsx(vt,{value:{size:d,disabled:f},children:n.jsx(G,{ref:t,size:d,...b("group"),...y})})});re.classes=U;re.displayName="@mantine/core/PillGroup";const Yt={variant:"default"},_t=ee((e,{radius:t},{size:s})=>({root:{"--pill-fz":z(s,"pill-fz"),"--pill-height":z(s,"pill-height"),"--pill-radius":t===void 0?void 0:Ie(t)}})),$=E((e,t)=>{const s=V("Pill",Yt,e),{classNames:a,className:r,style:o,styles:u,unstyled:h,vars:I,variant:c,children:f,withRemoveButton:y,onRemove:g,removeButtonProps:d,radius:b,size:D,disabled:S,mod:P,...l}=s,i=kt(),m=ne(),j=D||(i==null?void 0:i.size)||void 0,v=(m==null?void 0:m.variant)==="filled"?"contrast":c||"default",k=H({name:"Pill",classes:U,props:s,className:r,style:o,classNames:a,styles:u,unstyled:h,vars:I,varsResolver:_t,stylesCtx:{size:j}});return n.jsxs(G,{component:"span",ref:t,variant:v,size:j,...k("root",{variant:v}),mod:[{"with-remove":y&&!S,disabled:S||(i==null?void 0:i.disabled)},P],...l,children:[n.jsx("span",{...k("label"),children:f}),y&&n.jsx(De,{variant:"transparent",radius:b,tabIndex:-1,"aria-hidden":!0,unstyled:h,...d,...k("remove",{className:d==null?void 0:d.className,style:d==null?void 0:d.style}),onMouseDown:p=>{var x;p.preventDefault(),p.stopPropagation(),(x=d==null?void 0:d.onMouseDown)==null||x.call(d,p)},onClick:p=>{var x;p.stopPropagation(),g==null||g(),(x=d==null?void 0:d.onClick)==null||x.call(d,p)}})]})});$.classes=U;$.displayName="@mantine/core/Pill";$.Group=re;var Ve={field:"m_45c4369d"};const zt={type:"visible"},oe=E((e,t)=>{const s=V("PillsInputField",zt,e),{classNames:a,className:r,style:o,styles:u,unstyled:h,vars:I,type:c,disabled:f,id:y,pointer:g,mod:d,...b}=s,D=ne(),S=it(),P=H({name:"PillsInputField",classes:Ve,props:s,className:r,style:o,classNames:a,styles:u,unstyled:h,rootSelector:"field"}),l=f||(D==null?void 0:D.disabled);return n.jsx(G,{component:"input",ref:$e(t,D==null?void 0:D.fieldRef),"data-type":c,disabled:l,mod:[{disabled:l,pointer:g},d],...P("field"),...b,id:(S==null?void 0:S.inputId)||y,"aria-invalid":D==null?void 0:D.hasError,"aria-describedby":S==null?void 0:S.describedBy,type:"text",onMouseDown:i=>!g&&i.stopPropagation()})});oe.classes=Ve;oe.displayName="@mantine/core/PillsInputField";const Nt={},R=E((e,t)=>{const s=V("PillsInput",Nt,e),{children:a,onMouseDown:r,onClick:o,size:u,disabled:h,__staticSelector:I,error:c,variant:f,...y}=s,g=C.useRef();return n.jsx(Pt,{value:{fieldRef:g,size:u,disabled:h,hasError:!!c,variant:f},children:n.jsx(lt,{size:u,error:c,variant:f,component:"div",ref:t,onMouseDown:d=>{var b;d.preventDefault(),r==null||r(d),(b=g.current)==null||b.focus()},onClick:d=>{var b;d.preventDefault(),o==null||o(d),(b=g.current)==null||b.focus()},...y,multiline:!0,disabled:h,__staticSelector:I||"PillsInput",withAria:!1,children:a})})});R.displayName="@mantine/core/PillsInput";R.Field=oe;const Oe=C.createContext(null),Tt=Oe.Provider,wt=()=>C.useContext(Oe),Ft={},ie=E((e,t)=>{const{value:s,defaultValue:a,onChange:r,size:o,wrapperProps:u,children:h,readOnly:I,...c}=V("SwitchGroup",Ft,e),[f,y]=ye({value:s,defaultValue:a,finalValue:[],onChange:r}),g=d=>{const b=d.currentTarget.value;!I&&y(f.includes(b)?f.filter(D=>D!==b):[...f,b])};return n.jsx(Tt,{value:{value:f,onChange:g,size:o},children:n.jsx(_e.Wrapper,{size:o,ref:t,...u,...c,labelElement:"div",__staticSelector:"SwitchGroup",children:n.jsx(Ze,{role:"group",children:h})})})});ie.classes=_e.Wrapper.classes;ie.displayName="@mantine/core/SwitchGroup";var Le={root:"m_5f93f3bb",input:"m_926b4011",track:"m_9307d992",thumb:"m_93039a1d",trackLabel:"m_8277e082"};const Et={labelPosition:"right"},Vt=ee((e,{radius:t,color:s,size:a})=>({root:{"--switch-radius":t===void 0?void 0:Ie(t),"--switch-height":z(a,"switch-height"),"--switch-width":z(a,"switch-width"),"--switch-thumb-size":z(a,"switch-thumb-size"),"--switch-label-font-size":z(a,"switch-label-font-size"),"--switch-track-label-padding":z(a,"switch-track-label-padding"),"--switch-color":s?We(s,e):void 0}})),q=E((e,t)=>{const s=V("Switch",Et,e),{classNames:a,className:r,style:o,styles:u,unstyled:h,vars:I,color:c,label:f,offLabel:y,onLabel:g,id:d,size:b,radius:D,wrapperProps:S,thumbIcon:P,checked:l,defaultChecked:i,onChange:m,labelPosition:j,description:v,error:k,disabled:p,variant:x,rootRef:A,mod:O,...N}=s,Y=wt(),B=b||(Y==null?void 0:Y.size),T=H({name:"Switch",props:s,classes:Le,className:r,style:o,classNames:a,styles:u,unstyled:h,vars:I,varsResolver:Vt}),{styleProps:Q,rest:K}=qe(N),W=Ke(d),w=Y?{checked:Y.value.includes(K.value),onChange:Y.onChange}:{},[L,Ge]=ye({value:w.checked??l,defaultValue:i,finalValue:!1});return n.jsxs(Je,{...T("root"),__staticSelector:"Switch",__stylesApiProps:s,id:W,size:B,labelPosition:j,label:f,description:v,error:k,disabled:p,bodyElement:"label",labelElement:"span",classNames:a,styles:u,unstyled:h,"data-checked":w.checked||void 0,variant:x,ref:A,mod:O,...Q,...S,children:[n.jsx("input",{...K,disabled:p,checked:L,onChange:X=>{var de;Y?(de=w.onChange)==null||de.call(w,X):m==null||m(X),Ge(X.currentTarget.checked)},id:W,ref:t,type:"checkbox",role:"switch",...T("input")}),n.jsxs(G,{"aria-hidden":"true",mod:{error:k,"label-position":j,"without-labels":!g&&!y},...T("track"),children:[n.jsx(G,{component:"span",mod:"reduce-motion",...T("thumb"),children:P}),n.jsx("span",{...T("trackLabel"),children:L?g:y})]})]})});q.classes={...Le,...et};q.displayName="@mantine/core/Switch";q.Group=ie;/**
 * @license @tabler/icons-react v3.21.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var le=Re("outline","check","IconCheck",[["path",{d:"M5 12l5 5l10 -10",key:"svg-0"}]]);function Ot({type:e,date:t,locale:s,format:a,labelSeparator:r}){const o=u=>M(u).locale(s).format(a);return e==="default"?t===null?"":o(t):e==="multiple"?t.map(o).join(", "):e==="range"&&Array.isArray(t)?t[0]&&t[1]?`${o(t[0])} ${r} ${o(t[1])}`:t[0]?`${o(t[0])} ${r} `:"":""}function Lt({formatter:e,...t}){return(e||Ot)(t)}function Gt({minDate:e,maxDate:t,timezone:s}){const a=Te("add",new Date,s);return!e&&!t?a:e&&M(a).isBefore(e)?e:t&&M(a).isAfter(t)?t:a}function $t({type:e,value:t,defaultValue:s,onChange:a,locale:r,format:o,closeOnChange:u,sortDates:h,labelSeparator:I,valueFormatter:c}){const f=we(),[y,g]=te(!1),[d,b]=ft({type:e,value:t,defaultValue:s,onChange:a}),D=Lt({type:e,date:d,locale:f.getLocale(r),format:o,labelSeparator:f.getLabelSeparator(I),formatter:c}),S=i=>{u&&(e==="default"&&g.close(),e==="range"&&i[0]&&i[1]&&g.close()),b(h&&e==="multiple"?[...i].sort((m,j)=>m.getTime()-j.getTime()):i)},P=()=>S(e==="range"?[null,null]:e==="multiple"?[]:null),l=e==="range"?!!d[0]:e==="multiple"?d.length>0:d!==null;return{_value:d,setValue:S,onClear:P,shouldClear:l,formattedValue:D,dropdownOpened:y,dropdownHandlers:g}}const qt={type:"default",valueFormat:"MMMM D, YYYY",closeOnChange:!0,sortDates:!0,dropdownType:"popover"},ce=E((e,t)=>{const s=V("DatePickerInput",qt,e),{type:a,value:r,defaultValue:o,onChange:u,valueFormat:h,labelSeparator:I,locale:c,classNames:f,styles:y,unstyled:g,closeOnChange:d,size:b,variant:D,dropdownType:S,sortDates:P,minDate:l,maxDate:i,vars:m,defaultDate:j,valueFormatter:v,...k}=s,{resolvedClassNames:p,resolvedStyles:x}=ct({classNames:f,styles:y,props:s}),{calendarProps:A,others:O}=gt(k),{_value:N,setValue:Y,formattedValue:B,dropdownHandlers:T,dropdownOpened:Q,onClear:K,shouldClear:W}=$t({type:a,value:r,defaultValue:o,onChange:u,locale:c,format:h,labelSeparator:I,closeOnChange:d,sortDates:P,valueFormatter:v}),w=Array.isArray(N)?N[0]||j:N||j,L=we();return n.jsx(Fe,{formattedValue:B,dropdownOpened:Q,dropdownHandlers:T,classNames:p,styles:x,unstyled:g,ref:t,onClear:K,shouldClear:W,value:N,size:b,variant:D,dropdownType:S,...O,type:a,__staticSelector:"DatePickerInput",children:n.jsx(Ee,{...A,size:b,variant:D,type:a,value:N,defaultDate:w||Gt({maxDate:i,minDate:l,timezone:L.getTimezone()}),onChange:Y,locale:c,classNames:p,styles:x,unstyled:g,__staticSelector:"DatePickerInput",__stopPropagation:S==="popover",minDate:l,maxDate:i,date:Te("add",A.date,L.getTimezone()),__timezoneApplied:!0})})});ce.classes={...Fe.classes,...Ee.classes};ce.displayName="@mantine/dates/DatePickerInput";const Kt=e=>{var a;let t={};const s=["fromDate","toDate","createdAt"];return(a=e==null?void 0:e.filter(r=>!(s!=null&&s.includes(r.id))))==null||a.forEach(r=>{var o;Array.isArray(r.value)?t[r.id]=(o=r.value)==null?void 0:o.join(","):r.id==="merchantId"?t.merchantIds=r.value:t[r.id]=r.value}),t},Wt=e=>{var r,o;let t="";const s=(r=e==null?void 0:e[0])==null?void 0:r.id,a=(o=e==null?void 0:e[0])==null?void 0:o.desc;if(s==="createdAt"&&!a?t="asc":s==="createdAt"&&a&&(t="desc"),t)return{sort:t}};function ge(e){return M(e,"DD MMM YYYY").format("YYYY-MM-DDTHH:mm:ss.SSS[Z]")}const Rt=e=>{let t="",s="";const a=e==null?void 0:e.find(o=>o.id==="fromDate"),r=e==null?void 0:e.find(o=>o.id==="toDate");if(a&&(t=a!=null&&a.value?ge(a==null?void 0:a.value):""),r&&(s=r!=null&&r.value?ge(r==null?void 0:r.value):""),a&&s)return{startDate:t,endDate:s};if(r)return{endDate:s};if(a)return{startDate:t}};function Ht(e,t,s){const a={pageNo:s.pageIndex+1,limit:s.pageSize,...Wt(t),...Kt(e),...Rt(e)};return ae.GET(se.GET_ALL_INVOICES_DETAILS(),{params:a})}const Ut=e=>{const{columnFilters:t,EnableQuery:s,sorting:a,pagination:r}=e,[o,u]=C.useState([]);return C.useEffect(()=>{s&&u(t)},[t,s]),Ae({queryKey:["All_Invoices-Grid-data",o,a,r],queryFn:()=>Ht(o,a,r),placeholderData:Se,refetchOnMount:!1,refetchOnWindowFocus:!1,retry:2})},Bt=()=>{var S,P;const[e,t]=C.useState([]),[s,a]=C.useState([]),[r,o]=C.useState({pageIndex:0,pageSize:10}),[u,{open:h,close:I}]=te(!1),{data:c,isError:f,isLoading:y}=Ut({columnFilters:e,EnableQuery:!u,sorting:s,pagination:r}),{mutateAsync:g,isPending:d,variables:b}=rt(),D=C.useMemo(()=>[{accessorKey:"merchantId",header:"Merchant ID",enableColumnFilter:!0,enableSorting:!1,maxSize:100,Cell:({row:l})=>{var i,m;return`${((i=l==null?void 0:l.original)==null?void 0:i.merchantName)??""} (${(m=l==null?void 0:l.original)==null?void 0:m.merchantId})`}},{accessorKey:"invoiceParameters.bankTransfer",header:"To be paid",enableSorting:!1,enableColumnFilter:!1},{accessorKey:"createdAt",header:"Created At",accessorFn:l=>new Date(l==null?void 0:l.createdAt),Cell:({cell:l})=>{const i=l.getValue();return M(i).format("DD MMM YYYY")},enableColumnFilter:!1,maxSize:150},{accessorKey:"fromDate",header:"From Date",accessorFn:l=>new Date(l==null?void 0:l.fromDate),enableSorting:!1,filterVariant:"date",muiFilterDatePickerProps:{label:"From Date",format:"DD MMM YYYY"},Cell:({cell:l})=>{const i=l.getValue();return M(i).format("DD MMM YYYY")},maxSize:150},{accessorKey:"toDate",header:"To Date",maxSize:150,enableSorting:!1,accessorFn:l=>new Date(l==null?void 0:l.toDate),Cell:({cell:l})=>{const i=l.getValue();return M(i).format("DD MMM YYYY")},filterVariant:"date",muiFilterDatePickerProps:{label:"To Date",format:"DD MMM YYYY"}},{accessorKey:"invoiceId",header:"Invoice ID",enableSorting:!1},{accessorKey:"status",header:"Status",maxSize:100,Cell:({cell:l,row:i})=>{var m,j;if(l.getValue())return n.jsx(ve,{children:d&&((m=b==null?void 0:b.updates)==null?void 0:m.invoiceId)===i.original.invoiceId?n.jsx(Ce,{size:"sm"}):n.jsx(q,{disabled:!((j=i==null?void 0:i.original)!=null&&j.isEditable),size:"lg",checked:l.getValue()==="PAID",onLabel:"PAID",offLabel:"UNPAID",thumbIcon:l.getValue()==="PAID"?n.jsx(le,{size:12,color:"var(--mantine-color-teal-6)",stroke:3}):n.jsx(Ne,{size:12,color:"var(--mantine-color-red-6)",stroke:3}),styles:{trackLabel:{width:"40px",fontSize:"xl"}},onChange:v=>{g({updates:{...i==null?void 0:i.original,status:v.currentTarget.checked?"PAID":"UNPAID"}})}})})},enableColumnFilter:!0,filterVariant:"autocomplete",filterSelectOptions:[{value:"PAID",label:"PAID"},{value:"UNPAID",label:"UNPAID"}],enableSorting:!1},{accessorKey:"isSentToMerchant",header:"Sent",Cell:({cell:l})=>n.jsx(tt,{children:l.getValue()?"Yes":"No"}),enableSorting:!1,enableColumnFilter:!0,filterVariant:"autocomplete",maxSize:100,filterSelectOptions:[{value:!0,label:"YES"},{value:!1,label:"No"}]},{accessorKey:"downloadLink",header:"View Invoice",enableSorting:!1,enableColumnFilter:!1,maxSize:100,Cell:({cell:l})=>{const i=l.getValue();return i?n.jsx("a",{href:`${i}`,target:"_blank",download:`${i}`,children:n.jsx(je,{color:"green",cursor:"pointer"})}):"Not Available"}}],[d]);return n.jsx(ke,{children:n.jsx(C.Suspense,{fallback:n.jsx(Pe,{height:300,width:"100%"}),children:n.jsx(Me,{data:((S=c==null?void 0:c.data)==null?void 0:S.invoices)??[],columnFilters:e,columns:D,pagination:r,sorting:s,totalRowCount:((P=c==null?void 0:c.data)==null?void 0:P.totalCount)??0,onColumnFiltersChange:t,onPaginationChange:o,onSortingChange:a,isLoading:y,OnFilterButtonClicked:()=>h(),OnApplyFiltersClicked:()=>I(),filterDrawerIsOpen:u,enableRowSelection:!0,isError:f,tableName:"AllInvoicesDisplay",crudOperationHeader:"Invoices",columnPinning:{left:["mrt-row-select"]},uniqueIDForRows:"invoiceId",enableRowActions:!1,muiExpandButtonProps:({row:l,table:i})=>({onClick:()=>i.setExpanded({[l.id]:!l.getIsExpanded()}),sx:{transform:l.getIsExpanded()?"rotate(180deg)":"rotate(-90deg)",transition:"transform 0.2s"}}),renderDetailPanel:({row:l})=>{var i;return(i=l.original)!=null&&i.invoiceParameters?n.jsx(ot,{row:l}):void 0}})})})},Qt=({name:e,label:t,disabled:s})=>{const{values:a,errors:r,touched:o,setFieldValue:u}=ze(),h={touched:o[e],error:r[e]},I=a[e],c=h.touched&&h.error&&typeof h.error=="string"?h.error:void 0;return n.jsx(dt,{name:e,children:({field:f})=>n.jsx("div",{children:n.jsx(ce,{...f,type:"range",label:t,value:I,onChange:y=>u(e,y),disabled:s,error:c,placeholder:"Pick dates range",valueFormat:"DD MMM YYYY",maxDate:new Date})})})};function Xt(e){var m,j,v,k;const{name:t}=e,s=bt({onDropdownClose:()=>s.resetSelectedOption(),onDropdownOpen:()=>s.updateSelectedOptionIndex("active")}),[a,r]=C.useState(""),{data:o,isLoading:u,isError:h,isFetching:I}=at(a,s.dropdownOpened,1,100),{values:c,setFieldValue:f,errors:y,touched:g}=ze(),d={touched:g[t],error:y[t]},b=p=>{const x=c==null?void 0:c[t],A=x?x!=null&&x.includes(p)?x==null?void 0:x.filter(O=>O!==p):[...x,p]:[p];f(t,A),r("")},D=p=>f(t,c==null?void 0:c[t].filter(x=>x!==p)),S=C.useCallback(()=>{f(t,[])},[]),P=(m=c==null?void 0:c[t])==null?void 0:m.map(p=>n.jsx($,{withRemoveButton:!0,onRemove:()=>D(p),styles:{root:{backgroundColor:"#12b886",color:"white",fontWeight:"normal"}},children:p},p)),l=(v=(j=o==null?void 0:o.data)==null?void 0:j.merchants)==null?void 0:v.map(p=>{var A;const x=p.merchantName+" ("+p.merchantId.toString()+")";return n.jsx(_.Option,{value:x,children:n.jsxs(Z,{gap:"sm",children:[(A=c==null?void 0:c[t])!=null&&A.includes(x)?n.jsx(xt,{size:12}):null,n.jsx("span",{children:x})]})},x)}),i=C.useMemo(()=>{var p;return u||I?"Loading Merchants...":h?"No Merchants Found":(p=o==null?void 0:o.data)!=null&&p.totalCount&&o.data.totalCount>100?"More than 100 Merchants found, Please refine your search":null},[u,I,h,o]);return n.jsxs(_,{store:s,onOptionSubmit:b,children:[n.jsx(_.Header,{styles:{header:{borderBottom:0,paddingBottom:0}},children:n.jsx(J,{size:"sm",fw:500,children:"Select Merchants"})}),n.jsx(_.DropdownTarget,{children:n.jsx(R,{onClick:()=>s.openDropdown(),size:"md",rightSection:((k=c==null?void 0:c[t])==null?void 0:k.length)!==0&&n.jsx(De,{size:"sm",onMouseDown:p=>p.preventDefault(),onClick:()=>{S()},"aria-label":"Clear value"}),children:n.jsxs($.Group,{children:[P,n.jsx(_.EventsTarget,{children:n.jsx(R.Field,{onFocus:()=>s.openDropdown(),onBlur:()=>s.closeDropdown(),value:a,placeholder:"Search Merchants",onChange:p=>{s.updateSelectedOptionIndex(),r(p.currentTarget.value)},onKeyDown:p=>{var x;p.key==="Backspace"&&a.length===0&&(p.preventDefault(),D(c==null?void 0:c[t][((x=c==null?void 0:c[t])==null?void 0:x.length)-1]))}})})]})})}),n.jsx(_.Dropdown,{children:n.jsx(_.Options,{mah:300,style:{overflowY:"auto"},children:l&&l.length>0?l:n.jsx(_.Empty,{children:i})})}),d.error&&typeof d.error=="string"&&n.jsx(_.Footer,{styles:{footer:{borderTop:0}},children:n.jsx(J,{c:"red",size:"xs",children:d.error})})]})}const Zt=async e=>{if(!e.merchantIds||e.lastWeek===null)throw new Error("Missing required fields");if(!e.lastWeek&&(!e.startDate||!e.endDate))throw new Error("Start date and End date are required when 'lastWeek' is false");return ae.POST(se.GENERATE_INVOICE_BY_MERCHANTID_AND_DATE_RANGE(),e)},Jt=()=>{const e=He();return Dt({mutationFn:async t=>await Zt(t),onSuccess:t=>{var s,a;(a=(s=t==null?void 0:t.data)==null?void 0:s.invoices)!=null&&a.some(r=>r.status==="success")&&e.invalidateQueries({queryKey:["All_Invoices-Grid-data"]})},onError:t=>{var s,a;t instanceof It?ue.show({title:((a=(s=t==null?void 0:t.response)==null?void 0:s.data)==null?void 0:a.message)??"Request Failed",message:"There was an error processing the invoice request.",color:"red",autoClose:5e3}):ue.show({title:"Invoice Creation Failed",message:"Something went wrong.",color:"red",autoClose:5e3})}})};function ea({data:e,headers:t,columnsMapping:s,uniqueKeyInRows:a}){const r=e==null?void 0:e.map((o,u)=>n.jsx(F.Tr,{children:t.map(h=>n.jsx(F.Td,{styles:{td:{textAlign:"center"}},children:h==="Status"?n.jsx(St,{value:o[s[h]]??""}):n.jsx(J,{children:o[s[h]]??""})},h))},a&&a in o?o[a]:u));return n.jsxs(F,{verticalSpacing:"sm",stickyHeader:!0,children:[n.jsx(F.Thead,{children:n.jsx(F.Tr,{children:t.map(o=>n.jsx(F.Th,{styles:{th:{textAlign:"center"}},children:o},o))})}),n.jsx(F.Tbody,{children:r})]})}const ta=ut({merchantIds:pe().of(ht().required("Merchant ID is required")).min(1,"At least one Merchant ID must be selected").required("Merchant IDs are required"),dateRange:pe().min(2,"Date Range is Required").max(2,"Date Range is Required").when("isLastWeek",{is:!0,then:e=>e.nullable("Should be Null"),otherwise:e=>e.required("required").nonNullable("Should not be Null ")})});function be(e){var t;return(t=e.map(s=>{const a=RegExp(/\((\d+)\)/).exec(s);return a?a[1]:null}).filter(s=>s!==null))==null?void 0:t.join(",")}const aa=e=>e!=null&&e.isLastWeek?{merchantIds:be(e==null?void 0:e.merchantIds),lastWeek:e==null?void 0:e.isLastWeek}:{merchantIds:be(e==null?void 0:e.merchantIds),lastWeek:e==null?void 0:e.isLastWeek,startDate:e!=null&&e.dateRange[0]?e==null?void 0:e.dateRange[0]:null,endDate:e!=null&&e.dateRange[1]?e==null?void 0:e.dateRange[1]:null},sa={"Merchant ID":"merchantId",Message:"message",Status:"status"},na=()=>{const{mutate:e,isPending:t,isSuccess:s,data:a}=Jt(),r=C.useRef(null);C.useEffect(()=>{var u,h;return s&&(a!=null&&a.data)&&he.open({title:n.jsx(Ue,{icon:n.jsx(le,{}),color:"teal",title:((u=a==null?void 0:a.data)==null?void 0:u.message)??"Details",mt:"md",withCloseButton:!1,styles:{root:{boxShadow:"none"}}}),children:n.jsx(ea,{data:(h=a==null?void 0:a.data)==null?void 0:h.invoices,headers:["Merchant ID","Message","Status"],columnsMapping:sa,uniqueKeyInRows:"merchantId"}),size:"lg"}),()=>{he.closeAll()}},[s]);const o=u=>{e(aa(u))};return n.jsx(Ct,{size:"sm",mt:30,children:n.jsxs(Be,{p:"xl",shadow:"sm",withBorder:!0,pos:"relative",children:[n.jsx(jt,{order:5,ta:"center",mb:20,c:"grey",children:"Select Merchant Id and Date Range to generate Invoice"}),n.jsx(mt,{initialValues:{merchantIds:[],isLastWeek:!1,dateRange:[]},validationSchema:ta,onSubmit:u=>{o(u)},innerRef:r,children:({setFieldValue:u,values:h})=>n.jsx(pt,{children:n.jsxs(fe,{children:[n.jsx(fe,{gap:"xs",children:n.jsx(Xt,{name:"merchantIds"})}),n.jsxs(Z,{gap:"lg",grow:!0,align:"flex-start",children:[n.jsx(Qt,{name:"dateRange",label:"Select Date Range",disabled:h==null?void 0:h.isLastWeek}),n.jsx(st,{name:"isLastWeek",label:"Last Week",OnChangeHandler:I=>{u("isLastWeek",I.target.checked),I.target.checked&&u("dateRange",[null,null])}})]}),n.jsxs(Z,{grow:!0,gap:"md",mt:20,children:[n.jsx(me,{type:"submit",disabled:t,loading:t,children:"Submit"}),n.jsx(me,{type:"reset",variant:"outline",children:"Reset"})]})]})})}),n.jsx(yt,{visible:t,zIndex:1e3,overlayProps:{radius:"sm",blur:2}})]})})},ra=e=>{var a;let t={};const s=["fromDate","toDate","createdAt"];return(a=e==null?void 0:e.filter(r=>!(s!=null&&s.includes(r.id))))==null||a.forEach(r=>{var o;Array.isArray(r.value)?t[r.id]=(o=r.value)==null?void 0:o.join(","):t[r.id]=r.value}),t},oa=e=>{var r,o;let t="";const s=(r=e==null?void 0:e[0])==null?void 0:r.id,a=(o=e==null?void 0:e[0])==null?void 0:o.desc;if(s==="createdAt"&&!a?t="asc":s==="createdAt"&&a&&(t="desc"),t)return{sort:t}};function xe(e){return M(e,"DD MMM YYYY").format("YYYY-MM-DDTHH:mm:ss.SSS[Z]")}const ia=e=>{let t="",s="";const a=e==null?void 0:e.find(o=>o.id==="fromDate"),r=e==null?void 0:e.find(o=>o.id==="toDate");if(a&&(t=a!=null&&a.value?xe(a==null?void 0:a.value):""),r&&(s=r!=null&&r.value?xe(r==null?void 0:r.value):""),a&&s)return{startDate:t,endDate:s};if(r)return{endDate:s};if(a)return{startDate:t}};function la(e,t,s){const a={pageNo:s.pageIndex+1,limit:s.pageSize,...oa(t),...ra(e),...ia(e),isManualCreate:!0};return ae.GET(se.GET_ALL_INVOICES_DETAILS(),{params:a})}const ca=e=>{const{columnFilters:t,EnableQuery:s,sorting:a,pagination:r}=e;return Ae({queryKey:["All_Manual_Invoices-Grid-data",t,s,a,r],queryFn:()=>la(t,a,r),placeholderData:Se,refetchOnMount:!1,refetchOnWindowFocus:!1,retry:2})},da=()=>{var P,l;const[e,t]=C.useState([]),[s,a]=C.useState([]),[r,o]=C.useState({pageIndex:0,pageSize:10}),[u,{open:h,close:I}]=te(!1),{search:c}=Qe(),{data:f,isError:y,isLoading:g}=ca({columnFilters:e,EnableQuery:!u&&(c==null?void 0:c.includes("Other_Invoices")),sorting:s,pagination:r}),{mutateAsync:d,isPending:b,variables:D}=nt(),S=C.useMemo(()=>[{accessorKey:"merchantName",header:"Name",enableColumnFilter:!0,enableSorting:!1,maxSize:100},{accessorKey:"createdAt",header:"Created At",accessorFn:i=>new Date(i==null?void 0:i.createdAt),Cell:({cell:i})=>{const m=i.getValue();return M(m).format("DD MMM YYYY")},enableColumnFilter:!1,maxSize:150},{accessorKey:"fromDate",header:"From Date",accessorFn:i=>new Date(i==null?void 0:i.fromDate),enableSorting:!1,filterVariant:"date",muiFilterDatePickerProps:{label:"From Date",format:"DD MMM YYYY"},Cell:({cell:i})=>{const m=i.getValue();return M(m).format("DD MMM YYYY")},maxSize:150},{accessorKey:"toDate",header:"To Date",maxSize:150,enableSorting:!1,accessorFn:i=>new Date(i==null?void 0:i.toDate),Cell:({cell:i})=>{const m=i.getValue();return M(m).format("DD MMM YYYY")},filterVariant:"date",muiFilterDatePickerProps:{label:"To Date",format:"DD MMM YYYY"}},{accessorKey:"invoiceId",header:"Invoice ID",enableSorting:!1},{accessorKey:"status",header:"Status",maxSize:100,Cell:({cell:i,row:m})=>{var j;if(i.getValue())return n.jsx(ve,{children:b&&(D==null?void 0:D.invoiceId)===m.original.invoiceId?n.jsx(Ce,{size:"sm"}):n.jsx(q,{disabled:!((j=m==null?void 0:m.original)!=null&&j.isEditable),size:"lg",checked:i.getValue()==="PAID",onLabel:"PAID",offLabel:"UNPAID",thumbIcon:i.getValue()==="PAID"?n.jsx(le,{size:12,color:"var(--mantine-color-teal-6)",stroke:3}):n.jsx(Ne,{size:12,color:"var(--mantine-color-red-6)",stroke:3}),styles:{trackLabel:{width:"40px",fontSize:"xl"}},onChange:v=>{d({...m==null?void 0:m.original,status:v.currentTarget.checked?"PAID":"UNPAID"})}})})},enableColumnFilter:!0,filterVariant:"autocomplete",filterSelectOptions:[{value:"PAID",label:"PAID"},{value:"UNPAID",label:"UNPAID"}],enableSorting:!1},{accessorKey:"downloadLink",header:"View Invoice",enableSorting:!1,enableColumnFilter:!1,maxSize:100,Cell:({cell:i})=>{const m=i.getValue();return m?n.jsx("a",{href:`${m}`,target:"_blank",download:`${m}`,children:n.jsx(je,{color:"green",cursor:"pointer"})}):"Not Available"}}],[b]);return n.jsx(ke,{children:n.jsx(C.Suspense,{fallback:n.jsx(Pe,{height:300,width:"100%"}),children:n.jsx(Me,{data:((P=f==null?void 0:f.data)==null?void 0:P.invoices)??[],columnFilters:e,columns:S,pagination:r,sorting:s,totalRowCount:((l=f==null?void 0:f.data)==null?void 0:l.totalCount)??0,onColumnFiltersChange:t,onPaginationChange:o,onSortingChange:a,isLoading:g,OnFilterButtonClicked:()=>h(),OnApplyFiltersClicked:()=>I(),filterDrawerIsOpen:u,enableRowSelection:!0,isError:y,tableName:"AllManualInvoicesDisplay",crudOperationHeader:"Invoice",columnPinning:{left:["mrt-row-select"]},uniqueIDForRows:"invoiceId",enableRowActions:!0,ManualInvoiceTableCellForm:!0})})})};function va(){const e=[{label:"Generate Invoices",value:"Generate_Invoices",content:n.jsx(na,{})},{label:"View Invoices",value:"View_Invoices",content:n.jsx(Bt,{})},{label:"Other Invoices",value:"Other_Invoices",content:n.jsx(da,{})}];return n.jsx(Xe,{tabs:e})}export{va as default};
