import{Q as C,S as u,a8 as v,j as s,G as P,M as A,r as m,B as k,L as F,A as z,N as T,X as E}from"./index-CCoVnWjL.js";import{a as V,D as B}from"./MUIThemeProvider-DzvJUod3.js";import{u as N,A as O,a as G,D as K}from"./ApiConstants-Deh_3We-.js";import{u as L}from"./useGetMerchantDetailsbyId-C8J4euGv.js";import{C as H}from"./Container-B28VRWU2.js";import{T as Q}from"./Text-CZS4KpLy.js";import{B as x}from"./Badge-BCNezhuX.js";import{u as q,I as _}from"./InvoiceParameters-CAr-x-dm.js";import"./DateTimePicker-B8rljjvS.js";import"./index.esm-C1PbCTs-.js";import"./Alert-BEsKCH5d.js";import"./helperFuntions-Z0gwOzhH.js";import"./Title-DY7oMUnM.js";import"./List-BC4a4Dyd.js";function M(e){return u(e,"DD MMM YYYY").format("YYYY-MM-DDTHH:mm:ss.SSS[Z]")}const U=e=>{var n,i;let t="";const o=(n=e==null?void 0:e[0])==null?void 0:n.id,r=(i=e==null?void 0:e[0])==null?void 0:i.desc;if(o==="createdAt"&&!r?t="asc":o==="createdAt"&&r&&(t="desc"),t)return{sort:t}},w=e=>{let t="",o="";const r=e==null?void 0:e.find(i=>i.id==="fromDate"),n=e==null?void 0:e.find(i=>i.id==="toDate");if(r&&(t=r!=null&&r.value?M(r==null?void 0:r.value):"",n&&(o=n!=null&&n.value?M(n==null?void 0:n.value):"")),t||o)return{startDate:t,endDate:o}};function W(e,t,o,r){const n={merchantId:e==null?void 0:e.toString(),pageNo:r.pageIndex+1,limit:r.pageSize,...U(o),...w(t)};return O.GET(G.GET_MERCHANT_INVOICES_BY_ID(),{params:n})}const X=e=>{const{merchantId:t,columnFilters:o,EnableQuery:r,sorting:n,pagination:i}=e;return N({queryKey:["Invoices-of-Merchant",t,o,n,i],queryFn:()=>W(t,o,n,i),placeholderData:C,enabled:r,refetchOnMount:!1,refetchOnWindowFocus:!1,retry:2})};function Z(){var i,l;const{merchantId:e}=v(),{data:t,error:o,isLoading:r,isFetching:n}=L(e.toString()??"");return e?s.jsxs(s.Fragment,{children:[s.jsxs(P,{children:[s.jsxs(x,{size:"lg",variant:"dot",children:["Merchant ID : ",e]}),s.jsx(x,{size:"lg",children:(l=(i=t==null?void 0:t.data)==null?void 0:i.merchant)==null?void 0:l.merchantName})]}),s.jsx(K,{mb:"md",mt:"md"})]}):s.jsx(H,{size:"lg",mt:30,className:"fallback-ui",children:s.jsx(Q,{size:"xl",fw:500,children:"Merchant ID is not provided in the URL."})})}const me=()=>{var h,I;const{merchantId:e}=v(),[t,{open:o,close:r}]=A(!1),[n,i]=m.useState([]),[l,Y]=m.useState([]),[D,S]=m.useState({pageIndex:0,pageSize:10}),{data:d,isLoading:y,isError:g}=X({merchantId:e,columnFilters:n,EnableQuery:!t&&!!e,sorting:l,pagination:D}),{handleViewAndDownloadInvoice:b,isPending:p,variables:f}=q(),j=m.useMemo(()=>[{accessorKey:"invoiceId",header:"Invoice ID",enableSorting:!1,enableColumnFilter:!1,maxSize:30},{accessorKey:"fromDate",header:"From Date",enableSorting:!1,maxSize:50,accessorFn:a=>new Date(a==null?void 0:a.fromDate),Cell:({cell:a})=>{const c=a.getValue();return u(c).format("DD MMM YYYY")},filterVariant:"date",muiFilterDatePickerProps:{label:"From Date",format:"DD MMM YYYY"}},{accessorKey:"toDate",header:"To Date",enableSorting:!1,maxSize:50,accessorFn:a=>new Date(a==null?void 0:a.toDate),Cell:({cell:a})=>{const c=a.getValue();return u(c).format("DD MMM YYYY")},filterVariant:"date",muiFilterDatePickerProps:{format:"DD MMM YYYY",label:"To Date"}},{accessorKey:"downloadLink",header:"View Invoice",enableSorting:!1,enableColumnFilter:!1,maxSize:150,Cell:({cell:a,row:c})=>a.getValue()?s.jsx(k,{children:p&&(f==null?void 0:f.invoiceId)===c.original.invoiceId?s.jsx(F,{size:"sm"}):s.jsx(z,{variant:"transparent",onClick:()=>{b({invoiceId:c.original.invoiceId,downloadlink:a.getValue()})},children:s.jsx(T,{color:"green"})})}):"Not Available"},{accessorKey:"createdAt",header:"Created At",enableSorting:!0,enableColumnFilter:!1,maxSize:50,accessorFn:a=>new Date(a==null?void 0:a.createdAt),Cell:({cell:a})=>{const c=a.getValue();return u(c).format("DD MMM YYYY hh:mm A")},muiFilterDateTimePickerProps:{label:"Created At"},meta:{fieldType:"DateTimeRange"}}],[p]);return s.jsx(V,{children:s.jsxs(m.Suspense,{fallback:s.jsx(E,{height:300,width:"100%"}),children:[s.jsx(Z,{}),s.jsx(B,{data:((h=d==null?void 0:d.data)==null?void 0:h.invoices)??[],columnFilters:n,columns:j,pagination:D,sorting:l,totalRowCount:((I=d==null?void 0:d.data)==null?void 0:I.totalCount)??0,onColumnFiltersChange:i,onPaginationChange:S,onSortingChange:Y,isLoading:y,OnFilterButtonClicked:()=>o(),OnApplyFiltersClicked:()=>r(),filterDrawerIsOpen:t,isError:g,tableName:"MerchantInvoicesData",crudOperationHeader:"Invoices",columnPinning:{},uniqueIDForRows:"downloadLink",enableRowActions:!1,muiExpandButtonProps:({row:a,table:c})=>({onClick:()=>c.setExpanded({[a.id]:!a.getIsExpanded()}),sx:{transform:a.getIsExpanded()?"rotate(180deg)":"rotate(-90deg)",transition:"transform 0.2s"}}),renderDetailPanel:({row:a})=>{var c;return(c=a.original)!=null&&c.invoiceParameters?s.jsx(_,{row:a}):null}})]})})};export{me as default};
