import{Q as P,S as F,r as b,M as z,j as r,W as B,X as L,t as O,l as R,P as W,G as Y,k as M,F as U,D as A}from"./index-cq5hzz0D.js";import{A as K}from"./AppTabs-B1VXN0KH.js";import{u as G,A as E,a as N}from"./ApiConstants-Dtw084aJ.js";import{B as I,a as q,D as V,F as Q}from"./MUIThemeProvider-xnG46D3_.js";import{f as _}from"./helperFuntions-lPcVCZQ3.js";import{A as H}from"./Avatar-jrW9Iu3E.js";import{c as $,g as Z,F as X,h as J}from"./index.esm-CPFEyeFY.js";import{F as w,U as ee,I as ae}from"./UploadOrderErrorDisplay-BJvUO_xp.js";import{u as se,L as te}from"./DateTimePicker-CaOj6elI.js";import{S as re}from"./IconTrash-DB5oEuoR.js";import{T as j}from"./Text-0PoO59Pb.js";import"./IconX-cYJJk0kL.js";import"./Alert-oIgGFfnb.js";import"./index-BNxCzZh5.js";import"./Card-ppiDSSJU.js";import"./Title-bxlz7w_Z.js";function k(s){return F(s,"DD MMM YYYY hh:mm A").format("YYYY-MM-DDTHH:mm:ss.SSS[Z]")}const le=s=>{let a={};return s==null||s.forEach(t=>{var e;Array.isArray(t.value)?a[t.id]=(e=t.value)==null?void 0:e.join(","):a[t.id]=t.value}),a},ie=s=>{var o,f;let a="";const t=(o=s==null?void 0:s[0])==null?void 0:o.id,e=(f=s==null?void 0:s[0])==null?void 0:f.desc;if(t==="customerFirstName"&&!e?a="ascFirstName":t==="customerFirstName"&&e?a="descFirstName":t==="customerLastName"&&!e?a="ascLastName":t==="customerLastName"&&e?a="descLastName":t==="registrationDate"&&!e?a="ascRegistrationDate":t==="registrationDate"&&e&&(a="descRegistrationDate"),a)return{sort:a}},oe=s=>{let a="",t="";const e=s==null?void 0:s.find(o=>o.id==="registrationDate");if(e&&Array.isArray(e==null?void 0:e.value)&&(a=e!=null&&e.value[0]?k(e==null?void 0:e.value[0]):"",t=e!=null&&e.value[1]?k(e==null?void 0:e.value[1]):""),a||t)return{startDate:a,endDate:t}};function ne(s,a,t){const e={pageNo:t.pageIndex+1,limit:t.pageSize,...ie(a),...le(s),...oe(s)};return E.GET(N.GET_CUSTOMER_DETAILS(),{params:e})}const de=s=>{const{columnFilters:a,EnableQuery:t,sorting:e,pagination:o}=s;return G({queryKey:["Customers-Grid-data",a,e,o],queryFn:()=>ne(a,e,o),placeholderData:P,enabled:t,refetchOnMount:!1,refetchOnWindowFocus:!1,retry:2})},me=[{key:"customerId",name:"customerId",fieldType:"Number",label:"Customer ID",disabled:{disabledFieldForNew:!1,disableFieldForEdit:!0},hidden:{hideFieldForEDIT:!1,hideFieldForNEW:!0}},{key:"merchantId",name:"merchantId",fieldType:"Number",label:"Merchant ID"},{key:"customerFirstName",name:"customerFirstName",fieldType:"Text",label:"First Name"},{key:"customerLastName",name:"customerLastName",fieldType:"Text",label:"Last Name"},{key:"customerEmail",name:"customerEmail",fieldType:"Text",label:"Email"},{key:"customerMobile",name:"customerMobile",fieldType:"Text",label:"Mobile"},{key:"customerDOB",name:"customerDOB",fieldType:"Date",label:"Date of Birth"},{key:"registrationDate",name:"registrationDate",fieldType:"DateTimeRange",label:"Registration Date",disabled:{disabledFieldForNew:!1,disableFieldForEdit:!0}},{key:"registrationMethod",name:"registrationMethod",fieldType:"Select",label:"Registration Method",disabled:{disabledFieldForNew:!1,disableFieldForEdit:!0},meta:{options:[{label:"Web",value:"Web"}]}},{key:"zone",name:"zone",fieldType:"Select",label:"Zone",meta:{options:[{label:"Chester",value:"Chester"},{label:"Manchester",value:"Manchester"},{label:"Birmingham",value:"Birmingham"},{label:"Wrexham",value:"Wrexham"},{label:"Ellesmere Port",value:"Ellesmere Port"},{label:"Mold",value:"Mold"},{label:"London",value:"London"},{label:"Birkenhead",value:"Birkenhead"},{label:"Wirral",value:"Wirral"}]}},{key:"profileImg",name:"profileImg",fieldType:"imageInput",label:"Profile Image"},{key:"branchId",name:"branchId",fieldType:"Number",label:"Branch ID"},{key:"customerAddress",name:"customerAddress",fieldType:"Section",label:" Customer Address",fieldsInSection:[{key:"customerAddress.line1",name:"customerAddress.line1",fieldType:"Text",label:"Line 1"},{key:"customerAddress.line2",name:"customerAddress.line2",fieldType:"Text",label:"Line 2"},{key:"customerAddress.area",name:"customerAddress.area",fieldType:"Text",label:"Area"},{key:"customerAddress.city",name:"customerAddress.city",fieldType:"Text",label:"City"},{key:"customerAddress.post",name:"customerAddress.post",fieldType:"Text",label:"Postal Code"},{key:"customerAddress.country",name:"customerAddress.country",fieldType:"Text",label:"Country"}]}],ce=()=>{var d,m;const[s,a]=b.useState([]),[t,e]=b.useState([]),[o,f]=b.useState({pageIndex:0,pageSize:10}),[y,{open:v,close:D}]=z(!1),{data:c,isError:x,isLoading:p}=de({columnFilters:s,EnableQuery:!y,sorting:t,pagination:o}),n=b.useMemo(()=>[{accessorKey:"customerId",header:"Customer ID",enableSorting:!1,maxSize:30,Cell:({cell:l,row:i})=>{var h,u,g,S,T,C;return r.jsxs(I,{sx:{display:"flex",gap:"1rem",alignItems:"center",justifyContent:"center"},children:[r.jsx("p",{children:l.getValue()}),(h=i==null?void 0:i.original)!=null&&h.profileImg?r.jsx(B,{src:`${(u=i==null?void 0:i.original)==null?void 0:u.profileImg}`,alt:`profile ${l.getValue()}`,style:{width:40,height:40,borderRadius:"50%"}}):r.jsxs(H,{color:"cyan",radius:"xl",children:[(S=(g=i==null?void 0:i.original)==null?void 0:g.customerFirstName[0])==null?void 0:S.toUpperCase()," ",(C=(T=i==null?void 0:i.original)==null?void 0:T.customerLastName[0])==null?void 0:C.toUpperCase()]})]})}},{accessorKey:"merchantId",header:"Merchant ID",enableSorting:!1,maxSize:30,enableColumnFilter:!1},{accessorKey:"customerFirstName",header:"First Name",enableSorting:!0,maxSize:50},{accessorKey:"customerLastName",header:"Last Name",enableSorting:!0,maxSize:50},{accessorKey:"customerEmail",header:"Email",enableSorting:!1,maxSize:100},{accessorKey:"customerMobile",header:"Mobile",enableSorting:!1,maxSize:30},{accessorKey:"customerAddress",header:"Address",enableSorting:!1,enableColumnFilter:!1,maxSize:200,Cell:({row:l})=>{var i;return r.jsx(I,{sx:()=>({whiteSpace:"normal",wordWrap:"break-word",maxWidth:"200px",overflowWrap:"break-word"}),children:_((i=l==null?void 0:l.original)==null?void 0:i.customerAddress)})}},{accessorKey:"customerDOB",header:"Date of Birth",enableSorting:!1,Cell:({row:l})=>{var i,h;return(i=l==null?void 0:l.original)!=null&&i.customerDOB?F((h=l==null?void 0:l.original)==null?void 0:h.customerDOB).format("DD MMM YYYY"):"-"},enableColumnFilter:!1,maxSize:50},{accessorKey:"registrationDate",header:"Registration Date",enableSorting:!0,accessorFn:l=>new Date(l.registrationDate),filterVariant:"datetime-range",Cell:({cell:l})=>{const i=l.getValue();return F(i).format("DD MMM YYYY hh:mm A")},muiFilterDateTimePickerProps:{label:"Registration Date",timeSteps:{minutes:1}},maxSize:50},{accessorKey:"zone",header:"Zone",enableSorting:!1,maxSize:30,filterVariant:"multi-select",filterSelectOptions:[{label:"Chester",value:"Chester"},{label:"Manchester",value:"Manchester"},{label:"Birmingham",value:"Birmingham"},{label:"Wrexham",value:"Wrexham"},{label:"Ellesmere Port",value:"Ellesmere Port"},{label:"Mold",value:"Mold"},{label:"London",value:"London"},{label:"Birkenhead",value:"Birkenhead"},{label:"Wirral",value:"Wirral"}]},{accessorKey:"totalOrders",header:"Total Orders",enableSorting:!1,maxSize:30,enableColumnFilter:!1},{accessorKey:"branchId",header:"Branch ID",enableSorting:!1,maxSize:30,enableColumnFilter:!1}],[]);return r.jsx(q,{children:r.jsx(b.Suspense,{fallback:r.jsx(L,{height:300,width:"100%"}),children:r.jsx(V,{data:((d=c==null?void 0:c.data)==null?void 0:d.customer)??[],columnFilters:s,columns:n,pagination:o,sorting:t,totalRowCount:((m=c==null?void 0:c.data)==null?void 0:m.totalCount)??0,onColumnFiltersChange:a,onPaginationChange:f,onSortingChange:e,isLoading:p,OnFilterButtonClicked:()=>v(),OnApplyFiltersClicked:()=>D(),filterDrawerIsOpen:y,enableRowSelection:!0,isError:x,tableName:"CustomersDisplay",crudOperationHeader:"Customer",columnPinning:{left:["mrt-row-select","mrt-row-actions","customerId"]},uniqueIDForRows:"orderID",uiSchema:me})})})},ue=async s=>{const a=new FormData;return s.csvfile.forEach(t=>{a.append("files",t)}),await E.POST(N.UPLOAD_AND_PARSE_CUSTOMER(),a)},fe=()=>se({mutationFn:ue}),pe=$({csvfile:Z().min(1,"You must upload at least one file.").required("CSV file is required.")}),he=()=>{var c,x;const s={csvfile:[]},a=b.useRef(null),{mutate:t,error:e,reset:o,isPending:f}=fe(),y=O(),v=R(),D=p=>{t({csvfile:p.csvfile},{onSuccess:n=>{var d,m;(d=a.current)==null||d.resetForm(),v.invalidateQueries({queryKey:["Customers-Grid-data"]}),(m=U)==null||m.open({title:"File(s) Upload Successfully",children:r.jsxs(Q,{direction:"column",align:"center",mt:"10px",children:[r.jsx(ae,{stroke:2,size:40,color:y.colors.green[6]}),r.jsx(j,{size:"lg",style:{fontWeight:"600",color:y.colors.gray[7],textAlign:"center"},children:'Customers are saved successfully. You can see uploaded customers by switching tab to "All Customers".'})]}),onClose:()=>{var l;return(l=a.current)==null?void 0:l.resetForm()}})},onError:n=>{var d,m,l;A.show({title:"Error",message:((m=(d=n.response)==null?void 0:d.data)==null?void 0:m.message)||"Failed to upload files.",color:"red"}),(l=a.current)==null||l.setErrors(n)}})};return r.jsx(W,{shadow:"sm",p:20,children:r.jsxs(re,{gap:20,pos:"relative",children:[r.jsx(j,{size:"lg",style:{fontWeight:"600"},children:"Upload Excel or CSV file to store customer details. (Multiple files can be uploaded)"}),r.jsx(X,{initialValues:s,validationSchema:pe,onSubmit:D,innerRef:a,onReset:()=>o(),children:({values:p,errors:n,touched:d,setFieldValue:m})=>{const l=u=>{m("csvfile",[...p.csvfile,...u])},i=u=>{A.show({title:"Invalid Files",message:"Some files were rejected due to invalid format.",color:"red"}),console.error("Rejected files:",u)},h=u=>{const g=p.csvfile.filter(S=>S.name!==u);m("csvfile",g),o()};return r.jsxs(J,{children:[r.jsx(w,{onDrop:l,onReject:i,uploadedFiles:p.csvfile,onDeleteFile:h,dropzoneText:{title:"Upload files with relevant data",description:"You can upload at max 10 files with size not exceeding 5 MB",rejectMessage:"Invalid file type. Only CSV files are allowed."},maxFiles:10}),(n==null?void 0:n.csvfile)&&(d==null?void 0:d.csvfile)&&r.jsx("div",{style:{color:"red",marginTop:"10px"},children:n==null?void 0:n.csvfile}),r.jsxs(Y,{mt:"md",justify:"center",children:[r.jsx(M,{type:"submit",loading:!1,children:"Submit"}),r.jsx(M,{type:"reset",variant:"outline",children:"Reset"})]})]})}}),r.jsx(te,{visible:f,zIndex:1e3,overlayProps:{radius:"sm",blur:2}}),((c=a.current)==null?void 0:c.errors)&&r.jsx(ee,{response:(x=e==null?void 0:e.response)==null?void 0:x.data})]})})};function Ne(){const s=[{label:"All Customers",value:"All_Customers",content:r.jsx(ce,{})},{label:"Upload Customers",value:"Upload_Customers",content:r.jsx(he,{})}];return r.jsx(K,{tabs:s})}export{Ne as default};
