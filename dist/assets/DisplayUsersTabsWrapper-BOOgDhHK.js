import{i as V,r as u,y as K,z as W,A as E,F as L,j as t,S as z,b as P,M as H,a as Q,n as J,a2 as X,a3 as O,B as D,G as k,P as Y,T as $,C as Z,e as A}from"./index-QDmumIP4.js";import{A as ee}from"./AppTabs-BRBMgSeL.js";import{b as R,d as se,S as te,c as ae}from"./useUpdateUser-0zO8fXV7.js";import{a as re,D as ne,g as f}from"./MUIThemeProvider-Hl_UDlpR.js";import{c as F,h as ie}from"./helperFuntions-DGMK7A4e.js";import{f as le,g as U,h as oe,F as ce,b as de}from"./index.esm-DIYcYUZE.js";import{S as ue}from"./Switch-9j6WD3wf.js";import{T as he}from"./Title-C0NKl79D.js";import{D as N}from"./Rating-CyDkRCVj.js";import{L as me}from"./LoadingOverlay-C-xxoboR.js";import"./index-BObyytyr.js";import"./FormikInputField-Bd876Pl6.js";import"./TextInput-DaGPfqTM.js";import"./Alert-3nYhnQfH.js";/**
 * @license @tabler/icons-react v3.21.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var pe=V("outline","chevron-left","IconChevronLeft",[["path",{d:"M15 6l-6 6l6 6",key:"svg-0"}]]);const fe=e=>({admin:"api/auth/getAllAdminUsers",merchant:"api/auth/getAllMerchantUsers",staff:"api/auth/getAllStaffUsers",support:"api/auth/getAllSupportUsers",affiliate:"api/auth/getAllAffiliateUsers",driver:"api/auth/getAllDriverUsers"})[e],be=e=>e!=null&&e.length?{sort:e[0].desc?`desc${e[0].id}`:`asc${e[0].id}`}:{},ye=e=>{let s={};return e==null||e.forEach(a=>{s[a.id]=Array.isArray(a.value)?a.value.join(","):a.value}),s},ge=(e,s,a,r)=>{const o={pageNo:r.pageIndex+1,limit:r.pageSize,...be(a),...ye(s)};return E.GET(fe(e),{params:o})},Se=({role:e,columnFilters:s,enableQuery:a,sorting:r,pagination:o})=>{const[c,m]=u.useState([]);return u.useEffect(()=>{a&&m(s)},[s,a]),K({queryKey:[`Users-Grid-${e}-data`,c,r,o],queryFn:()=>ge(e,c,r,o),enabled:a,placeholderData:W,refetchOnWindowFocus:!1,retry:2})};var B;const xe=(B=R)==null?void 0:B.filter(e=>e.value!=="superAdmin"),S=[{key:"firstName",name:"firstName",fieldType:"Text",label:"First Name"},{key:"lastName",name:"lastName",fieldType:"Text",label:"Last Name"},{key:"userName",name:"userName",fieldType:"Text",label:"Username",disabled:{disableFieldForEdit:!0}},{key:"email",name:"email",fieldType:"Text",label:"Email",disabled:{disableFieldForEdit:!0}},{key:"role",name:"role",fieldType:"Select",label:"Role",meta:{options:xe},disabled:{disabledFieldForNew:!0,disableFieldForEdit:!0}},{key:"status",name:"status",fieldType:"Select",label:"Status",hidden:{hideFieldForNEW:!0},meta:{options:se}}],ve={merchant:[...S,{key:"merchantIds",name:"merchantIds",fieldType:"MerchantIDs",label:"Select Merchant ID(s)"}],affiliate:[...S,{key:"affiliateId",name:"affiliateId",fieldType:"Text",label:"Affiliate ID"}],admin:[...S],staff:[...S],support:[...S,{key:"supportLevel",name:"supportLevel",fieldType:"Select",label:"Support Level",meta:{options:[{label:"L1",value:"L1"},{label:"L2",value:"L2"}]}}],driver:[...S,{key:"licenseNumber",name:"licenseNumber",fieldType:"Text",label:"Driver License Number"},{key:"vehicleType",name:"vehicleType",fieldType:"Select",label:"Vehicle Type",meta:{options:[{label:"Car",value:"car"},{label:"Bike",value:"bike"}]}}]},x=[{accessorKey:"firstName",header:"First Name",enableSorting:!0},{accessorKey:"lastName",header:"Last Name",enableSorting:!0},{accessorKey:"email",header:"Email",enableSorting:!1},{accessorKey:"userName",header:"UserName",enableSorting:!1},{accessorKey:"phone",header:"Phone",enableSorting:!1},{accessorKey:"lastLogin",header:"Last Login",enableSorting:!1,Cell:({cell:e})=>F(e.getValue())},{accessorKey:"lastActive",header:"Last Active",enableSorting:!1,Cell:({cell:e})=>F(e.getValue())},{accessorKey:"userId",header:"User ID",enableSorting:!1},{accessorKey:"activatedOn",header:"Activated On",enableSorting:!1,Cell:({cell:e})=>F(e.getValue())}],je={admin:[...x,{accessorKey:"merchantId",header:"Merchant ID",enableSorting:!1}],affiliate:[...x,{accessorKey:"referralCode",header:"Referral Code",enableSorting:!1},{accessorKey:"merchantId",header:"Merchant ID",enableSorting:!1}],staff:[...x,{accessorKey:"department",header:"Department",enableSorting:!1},{accessorKey:"merchantId",header:"Merchant ID",enableSorting:!1}],support:[...x,{accessorKey:"ticketCount",header:"Ticket Count",enableSorting:!0},{accessorKey:"merchantId",header:"Merchant ID",enableSorting:!1}],driver:[...x,{accessorKey:"licenseNumber",header:"License Number",enableSorting:!1},{accessorKey:"vehicleType",header:"Vehicle Type",enableSorting:!1},{accessorKey:"merchantId",header:"Merchant ID",enableSorting:!1}],merchant:[...x,{accessorKey:"merchantIds",header:"Merchant IDs",enableSorting:!1,accessorFn:e=>{var s;return(s=e==null?void 0:e.merchantIds)==null?void 0:s.join(", ")}}]},Te=({role:e})=>{var p,b;const[s,a]=u.useState([]),[r,o]=u.useState([]),[c,m]=u.useState({pageIndex:0,pageSize:50}),[n,{open:v,close:l}]=L(!1),{data:i,isError:y,isLoading:h}=Se({role:e,columnFilters:s,enableQuery:!n,sorting:r,pagination:c}),d=u.useMemo(()=>je[e],[e]);return t.jsx(re,{children:t.jsx(u.Suspense,{fallback:t.jsx(z,{height:300,width:"100%"}),children:t.jsx(ne,{data:((p=i==null?void 0:i.data)==null?void 0:p.users)??[],columnFilters:s,columns:d,pagination:c,sorting:r,totalRowCount:((b=i==null?void 0:i.data)==null?void 0:b.totalCount)??0,onColumnFiltersChange:a,onPaginationChange:m,onSortingChange:o,isLoading:h,OnFilterButtonClicked:v,OnApplyFiltersClicked:l,filterDrawerIsOpen:n,enableRowSelection:!0,isError:y,tableName:"UsersDisplay",crudOperationHeader:`${e.charAt(0).toUpperCase()+e.slice(1)} User`,columnPinning:{left:["mrt-row-select","mrt-row-actions","firstName"]},uniqueIDForRows:"userId",uiSchema:ve[e]})})})},w=({name:e,label:s,disabled:a,handleExternally:r=!1,onChange:o})=>{const{values:c,errors:m,touched:n,setFieldValue:v}=le(),l=U(c,e)??!1,i=U(m,e),y=U(n,e),h=u.useCallback((d,p)=>{if(r){o(p);return}v(d,p.currentTarget.checked)},[r,o]);return t.jsx(oe,{name:e,children:({field:d})=>t.jsx(ue,{name:e,label:s,checked:l,disabled:a,error:y&&i?i:void 0,onChange:p=>h(e,p)})})},Ce=e=>{if(e)return E.GET(P.GET_ROLE_BASED_CONFIG_MENUS(e));throw new Error("Role or Token Unavailable")},Ae=e=>K({queryKey:["roleBasedMenus",e],queryFn:()=>Ce(e),refetchOnWindowFocus:!1,enabled:!!e,retry:1,select:s=>{var a;return(a=s==null?void 0:s.data)==null?void 0:a.menu}}),Ie=()=>{};class G extends u.PureComponent{constructor(...s){super(...s),this.i=!1,this.h=null,this.o=Ie,this.state={t:!0}}componentWillUnmount(){this.o()}u(s){s!==this.h&&(this.o(),this.h=null,s&&(this.h=s,this.o=s.on("updated",()=>this.setState({t:!this.state.t}))))}get allowed(){return this.i}l(){const s=this.props,a=s.of||s.a||s.an||s.this||s.on,r=s.not?"cannot":"can";return s.ability[r](s.I||s.do,a,s.field)}render(){return this.u(this.props.ability),this.i=this.l(),this.props.passThrough||this.i?this.p():null}p(){const{children:s,ability:a}=this.props;return typeof s=="function"?s(this.i,a):s}}async function ke({role:e,menus:s}){const a=P.EDIT_ROLE_BASED_CONFIG_MENUS();return E.PUT(a,{role:e,menus:s})}const Fe=()=>{const e=H();return Q({mutationFn:({role:s,menus:a})=>ke({role:s,menus:a}),onSuccess:s=>{var a,r;J.show({title:"Success",message:"Role-based menu configuration updated successfully",color:"green",autoClose:2e3,position:"top-center"}),e.invalidateQueries({queryKey:["roleBasedMenus",(r=(a=s==null?void 0:s.data)==null?void 0:a.menu)==null?void 0:r.role]})},onError:s=>{X.isAxiosError(s)?ie(s):console.error("Non-Axios error:",s)}})},Ue=()=>{const[e,s]=u.useState(null),{data:a,isLoading:r}=Ae(e),{mutateAsync:o,isPending:c}=Fe(),m=u.useCallback(l=>{o(l)},[]),{ability:n}=O(),v=u.useMemo(()=>{var l;return(l=R)==null?void 0:l.filter(i=>(i==null?void 0:i.value)!=="superAdmin")},[]);return t.jsx(D,{children:t.jsxs(G,{I:"view",a:"RoleBasedConfiguration",ability:n,children:[t.jsxs(k,{children:[t.jsx(he,{order:4,mb:"md",children:"Role-Based Menu Settings"}),t.jsx(te,{value:e,onChange:s,data:v,placeholder:"Choose Role",mb:"md"})]}),t.jsx(N,{my:"md"}),t.jsxs(Y,{shadow:"md",p:"md",radius:"md",children:[t.jsx(me,{visible:r||c}),!e&&t.jsx($,{children:"Select the role to configure the menu settings for that role."}),!r&&a&&t.jsx(ce,{initialValues:a,enableReinitialize:!0,onSubmit:l=>m(l),children:({values:l,setFieldValue:i})=>{var y;return t.jsxs(de,{children:[t.jsx(f.ScrollContainer,{minWidth:100,type:"native",mah:430,p:0,children:t.jsxs(f,{withTableBorder:!0,withColumnBorders:!0,stickyHeaderOffset:0,stickyHeader:!0,children:[t.jsx(f.Thead,{children:t.jsxs(f.Tr,{children:[t.jsx(f.Th,{style:{width:"25%"},children:"Main Menu"}),t.jsx(f.Th,{children:"Submenus"})]})}),t.jsx(f.Tbody,{children:(y=a==null?void 0:a.menus)==null?void 0:y.map((h,d)=>{var p;return t.jsxs(f.Tr,{children:[t.jsx(f.Td,{children:t.jsx(w,{name:`menus[${d}].isActive`,label:h.label,handleExternally:!0,onChange:async b=>{var T;const j=b.target.checked;i(`menus[${d}].isActive`,j);const I=(T=h.submenu)==null?void 0:T.map(g=>({...g,isActive:j}));i(`menus[${d}].submenu`,I)}})}),t.jsx(f.Td,{children:t.jsx(k,{gap:"lg",children:(p=h==null?void 0:h.submenu)==null?void 0:p.map((b,j)=>t.jsx(D,{w:"200px",children:t.jsx(w,{name:`menus[${d}].submenu[${j}].isActive`,label:b.label,handleExternally:!0,onChange:I=>{var M;const T=I.target.checked,g=(M=l==null?void 0:l.menus[d].submenu)==null?void 0:M.map((C,q)=>q===j?{...C,isActive:T}:C);i(`menus[${d}].submenu`,g);const _=g==null?void 0:g.some(C=>C.isActive);i(`menus[${d}].isActive`,_)}},`${h.label}_${b.label}`)},b.label))})})]},h.label+"index")})})]})}),t.jsx(N,{}),t.jsx(Z,{children:t.jsxs(k,{mt:"md",children:[t.jsx(A,{type:"submit",children:"Submit"}),t.jsx(A,{variant:"outline",type:"reset",children:"Reset"})]})})]})}})]})]})})},qe=()=>{var c,m;const{ability:e}=O(),[s,{open:a,close:r}]=L(!1),o=(m=(c=R)==null?void 0:c.filter(n=>n.value!=="superAdmin"&&e.can("access",`${n==null?void 0:n.value}UserTab`)))==null?void 0:m.map(n=>({label:n.label,value:n.value,hidden:!e.can("access",`${n.value}UserTab`),content:t.jsx(Te,{role:n==null?void 0:n.value})}));return t.jsxs(D,{children:[t.jsxs(G,{I:"view",a:"RoleBasedConfiguration",ability:e,children:[t.jsxs(ae,{justify:"space-between",align:"center",w:"100%",styles:{root:{border:"1px solid lightgrey",padding:"10px 20px",borderRadius:"1rem",background:"#f3f3f3",marginBottom:"1.5rem"}},children:[s&&t.jsx(A,{onClick:()=>r(),size:"sm",leftSection:t.jsx(pe,{}),variant:"gradient",children:"Go Back"}),!s&&t.jsxs(t.Fragment,{children:[t.jsx($,{style:{fontWeight:500},children:"Roles and Permissions : "}),t.jsx(A,{variant:"gradient",onClick:()=>a(),children:"Access & Permissions"})]})]}),t.jsx(N,{m:10})]}),s?t.jsx(Ue,{}):t.jsx(ee,{tabs:o})]})};export{qe as default};
