import{y as N,z as P,A as k,b as E,D as z,r as b,F as L,j as r,I as R,l as B,S as O,a as U,K as W,M as K,P as Y,T as C,G,e as I,H as V,n as j}from"./index-BocbaNEA.js";import{A as q}from"./AppTabs-BnFmm1yZ.js";import{B as A,a as _,D as Q}from"./MUIThemeProvider-CweUhTdT.js";import{f as w,a as H,c as $}from"./helperFuntions-CM2HUrvq.js";import{c as Z,i as J,F as X,b as ee}from"./index.esm-BJmHqlnb.js";import{F as ae,U as se,I as te}from"./UploadOrderErrorDisplay-DkL3rN_8.js";import{S as re}from"./FormikInputField-vBle5Dp0.js";import{L as le}from"./LoadingOverlay-pZ8X-IXh.js";import{c as ie}from"./useUpdateUser-J2CWGRqD.js";import"./Rating-puGU3s4J.js";import"./index-DBElLul9.js";import"./Alert-BlMm2AM-.js";import"./TextInput-WJD_G6xF.js";import"./Title-DvwRX8VF.js";import"./IconX-B_SrgMAt.js";import"./List-8a10eGoi.js";import"./Card-DpVFOUj9.js";function M(s){return z(s,"DD MMM YYYY hh:mm A").format("YYYY-MM-DDTHH:mm:ss.SSS[Z]")}const oe=s=>{let a={};return s==null||s.forEach(t=>{var e;Array.isArray(t.value)?a[t.id]=(e=t.value)==null?void 0:e.join(","):a[t.id]=t.value}),a},ne=s=>{var o,f;let a="";const t=(o=s==null?void 0:s[0])==null?void 0:o.id,e=(f=s==null?void 0:s[0])==null?void 0:f.desc;if(t==="customerFirstName"&&!e?a="ascFirstName":t==="customerFirstName"&&e?a="descFirstName":t==="customerLastName"&&!e?a="ascLastName":t==="customerLastName"&&e?a="descLastName":t==="registrationDate"&&!e?a="ascRegistrationDate":t==="registrationDate"&&e&&(a="descRegistrationDate"),a)return{sort:a}},de=s=>{let a="",t="";const e=s==null?void 0:s.find(o=>o.id==="registrationDate");if(e&&Array.isArray(e==null?void 0:e.value)&&(a=e!=null&&e.value[0]?M(e==null?void 0:e.value[0]):"",t=e!=null&&e.value[1]?M(e==null?void 0:e.value[1]):""),a||t)return{startDate:a,endDate:t}};function me(s,a,t){const e={pageNo:t.pageIndex+1,limit:t.pageSize,...ne(a),...oe(s),...de(s)};return k.GET(E.GET_CUSTOMER_DETAILS(),{params:e})}const ce=s=>{const{columnFilters:a,EnableQuery:t,sorting:e,pagination:o}=s;return N({queryKey:["Customers-Grid-data",a,e,o],queryFn:()=>me(a,e,o),placeholderData:P,enabled:t,refetchOnMount:!0,refetchOnWindowFocus:!1,retry:2})},ue=[{key:"customerId",name:"customerId",fieldType:"Number",label:"Customer ID",disabled:{disabledFieldForNew:!1,disableFieldForEdit:!0},hidden:{hideFieldForEDIT:!1,hideFieldForNEW:!0}},{key:"merchantId",name:"merchantId",fieldType:"Number",label:"Merchant ID"},{key:"customerFirstName",name:"customerFirstName",fieldType:"Text",label:"First Name"},{key:"customerLastName",name:"customerLastName",fieldType:"Text",label:"Last Name"},{key:"customerEmail",name:"customerEmail",fieldType:"Text",label:"Email"},{key:"customerMobile",name:"customerMobile",fieldType:"Text",label:"Mobile"},{key:"customerDOB",name:"customerDOB",fieldType:"Date",label:"Date of Birth"},{key:"registrationDate",name:"registrationDate",fieldType:"DateTimeRange",label:"Registration Date",disabled:{disabledFieldForNew:!1,disableFieldForEdit:!0}},{key:"registrationMethod",name:"registrationMethod",fieldType:"Select",label:"Registration Method",disabled:{disabledFieldForNew:!1,disableFieldForEdit:!0},meta:{options:[{label:"Web",value:"Web"}]}},{key:"zone",name:"zone",fieldType:"Select",label:"Zone",meta:{options:[{label:"Chester",value:"Chester"},{label:"Manchester",value:"Manchester"},{label:"Birmingham",value:"Birmingham"},{label:"Wrexham",value:"Wrexham"},{label:"Ellesmere Port",value:"Ellesmere Port"},{label:"Mold",value:"Mold"},{label:"London",value:"London"},{label:"Birkenhead",value:"Birkenhead"},{label:"Wirral",value:"Wirral"}]}},{key:"profileImg",name:"profileImg",fieldType:"imageInput",label:"Profile Image"},{key:"branchId",name:"branchId",fieldType:"Number",label:"Branch ID"},{key:"customerAddress",name:"customerAddress",fieldType:"Section",label:" Customer Address",fieldsInSection:[{key:"customerAddress.line1",name:"customerAddress.line1",fieldType:"Text",label:"Line 1"},{key:"customerAddress.line2",name:"customerAddress.line2",fieldType:"Text",label:"Line 2"},{key:"customerAddress.area",name:"customerAddress.area",fieldType:"Text",label:"Area"},{key:"customerAddress.city",name:"customerAddress.city",fieldType:"Text",label:"City"},{key:"customerAddress.post",name:"customerAddress.post",fieldType:"Text",label:"Postal Code"},{key:"customerAddress.country",name:"customerAddress.country",fieldType:"Text",label:"Country"}]}],fe=()=>{var d,m;const[s,a]=b.useState([]),[t,e]=b.useState([]),[o,f]=b.useState({pageIndex:0,pageSize:50}),[h,{open:v,close:F}]=L(!1),{data:c,isError:y,isLoading:p}=ce({columnFilters:s,EnableQuery:!h,sorting:t,pagination:o}),n=b.useMemo(()=>[{accessorKey:"customerId",header:"Customer ID",enableSorting:!1,maxSize:30,Cell:({cell:l,row:i})=>{var x,u,g,S,D,T;return r.jsxs(A,{sx:{display:"flex",gap:"1rem",alignItems:"center",justifyContent:"center"},children:[r.jsx("p",{children:l.getValue()}),(x=i==null?void 0:i.original)!=null&&x.profileImg?r.jsx(R,{src:`${(u=i==null?void 0:i.original)==null?void 0:u.profileImg}`,alt:`profile ${l.getValue()}`,style:{width:40,height:40,borderRadius:"50%"}}):r.jsxs(B,{color:"cyan",radius:"xl",children:[(S=(g=i==null?void 0:i.original)==null?void 0:g.customerFirstName[0])==null?void 0:S.toUpperCase()," ",(T=(D=i==null?void 0:i.original)==null?void 0:D.customerLastName[0])==null?void 0:T.toUpperCase()]})]})}},{accessorKey:"merchantId",header:"Merchant ID",enableSorting:!1,maxSize:30,enableColumnFilter:!1},{accessorKey:"customerFirstName",header:"First Name",enableSorting:!0,maxSize:50},{accessorKey:"customerLastName",header:"Last Name",enableSorting:!0,maxSize:50},{accessorKey:"customerEmail",header:"Email",enableSorting:!1,maxSize:100},{accessorKey:"customerMobile",header:"Mobile",enableSorting:!1,maxSize:30},{accessorKey:"customerAddress",header:"Address",enableSorting:!1,enableColumnFilter:!1,maxSize:200,Cell:({row:l})=>{var i;return r.jsx(A,{sx:()=>({whiteSpace:"normal",wordWrap:"break-word",maxWidth:"200px",overflowWrap:"break-word"}),children:w((i=l==null?void 0:l.original)==null?void 0:i.customerAddress)})}},{accessorKey:"customerDOB",header:"Date of Birth",enableSorting:!1,Cell:({cell:l})=>H(l.getValue()),enableColumnFilter:!1,maxSize:50},{accessorKey:"registrationDate",header:"Registration Date",enableSorting:!0,accessorFn:l=>new Date(l.registrationDate),filterVariant:"datetime-range",Cell:({cell:l})=>$(l.getValue()),muiFilterDateTimePickerProps:{label:"Registration Date",timeSteps:{minutes:1}},maxSize:50},{accessorKey:"zone",header:"Zone",enableSorting:!1,maxSize:30,filterVariant:"multi-select",filterSelectOptions:[{label:"Chester",value:"Chester"},{label:"Manchester",value:"Manchester"},{label:"Birmingham",value:"Birmingham"},{label:"Wrexham",value:"Wrexham"},{label:"Ellesmere Port",value:"Ellesmere Port"},{label:"Mold",value:"Mold"},{label:"London",value:"London"},{label:"Birkenhead",value:"Birkenhead"},{label:"Wirral",value:"Wirral"}]},{accessorKey:"totalOrders",header:"Total Orders",enableSorting:!1,maxSize:30,enableColumnFilter:!1},{accessorKey:"branchId",header:"Branch ID",enableSorting:!1,maxSize:30,enableColumnFilter:!1}],[]);return r.jsx(_,{children:r.jsx(b.Suspense,{fallback:r.jsx(O,{height:300,width:"100%"}),children:r.jsx(Q,{data:((d=c==null?void 0:c.data)==null?void 0:d.customer)??[],columnFilters:s,columns:n,pagination:o,sorting:t,totalRowCount:((m=c==null?void 0:c.data)==null?void 0:m.totalCount)??0,onColumnFiltersChange:a,onPaginationChange:f,onSortingChange:e,isLoading:p,OnFilterButtonClicked:()=>v(),OnApplyFiltersClicked:()=>F(),filterDrawerIsOpen:h,enableRowSelection:!0,isError:y,tableName:"CustomersDisplay",crudOperationHeader:"Customer",columnPinning:{left:["mrt-row-select","mrt-row-actions","customerId"]},uniqueIDForRows:"orderID",uiSchema:ue})})})},pe=async s=>{const a=new FormData;return s.csvfile.forEach(t=>{a.append("files",t)}),await k.POST(E.UPLOAD_AND_PARSE_CUSTOMER(),a)},be=()=>U({mutationFn:pe}),he=Z({csvfile:J().min(1,"You must upload at least one file.").required("CSV file is required.")}),ye=()=>{var c,y;const s={csvfile:[]},a=b.useRef(null),{mutate:t,error:e,reset:o,isPending:f}=be(),h=W(),v=K(),F=p=>{t({csvfile:p.csvfile},{onSuccess:n=>{var d,m;(d=a.current)==null||d.resetForm(),v.invalidateQueries({queryKey:["Customers-Grid-data"]}),(m=V)==null||m.open({title:"File(s) Upload Successfully",children:r.jsxs(ie,{direction:"column",align:"center",mt:"10px",children:[r.jsx(te,{stroke:2,size:40,color:h.colors.green[6]}),r.jsx(C,{size:"lg",style:{fontWeight:"600",color:h.colors.gray[7],textAlign:"center"},children:'Customers are saved successfully. You can see uploaded customers by switching tab to "All Customers".'})]}),onClose:()=>{var l;return(l=a.current)==null?void 0:l.resetForm()}})},onError:n=>{var d,m,l;j.show({title:"Error",message:((m=(d=n.response)==null?void 0:d.data)==null?void 0:m.message)||"Failed to upload files.",color:"red"}),(l=a.current)==null||l.setErrors(n)}})};return r.jsx(Y,{shadow:"sm",p:20,children:r.jsxs(re,{gap:20,pos:"relative",children:[r.jsx(C,{size:"lg",style:{fontWeight:"600"},children:"Upload Excel or CSV file to store customer details. (Multiple files can be uploaded)"}),r.jsx(X,{initialValues:s,validationSchema:he,onSubmit:F,innerRef:a,onReset:()=>o(),children:({values:p,errors:n,touched:d,setFieldValue:m})=>{const l=u=>{m("csvfile",[...p.csvfile,...u])},i=u=>{j.show({title:"Invalid Files",message:"Some files were rejected due to invalid format.",color:"red"}),console.error("Rejected files:",u)},x=u=>{const g=p.csvfile.filter(S=>S.name!==u);m("csvfile",g),o()};return r.jsxs(ee,{children:[r.jsx(ae,{onDrop:l,onReject:i,uploadedFiles:p.csvfile,onDeleteFile:x,dropzoneText:{title:"Upload files with relevant data",description:"You can upload at max 10 files with size not exceeding 5 MB",rejectMessage:"Invalid file type. Only CSV files are allowed."},maxFiles:10}),(n==null?void 0:n.csvfile)&&(d==null?void 0:d.csvfile)&&r.jsx("div",{style:{color:"red",marginTop:"10px"},children:n==null?void 0:n.csvfile}),r.jsxs(G,{mt:"md",justify:"center",children:[r.jsx(I,{type:"submit",loading:!1,children:"Submit"}),r.jsx(I,{type:"reset",variant:"outline",children:"Reset"})]})]})}}),r.jsx(le,{visible:f,zIndex:1e3,overlayProps:{radius:"sm",blur:2}}),((c=a.current)==null?void 0:c.errors)&&r.jsx(se,{response:(y=e==null?void 0:e.response)==null?void 0:y.data})]})})};function Le(){const s=[{label:"All Customers",value:"All_Customers",content:r.jsx(fe,{})},{label:"Upload Customers",value:"Upload_Customers",content:r.jsx(ye,{})}];return r.jsx(q,{tabs:s})}export{Le as default};
