import{r as l,Q as E,S as p,M as D,j as c,X as g}from"./index-BDS8Zh-4.js";import{u as A,A as I,a as M}from"./ApiConstants-CdfQ_uAX.js";import{a as O,D as P}from"./MUIThemeProvider-B4bX1qBk.js";import"./DateTimePicker-CE81UsHd.js";import"./index.esm-B_xLMHMf.js";import"./Alert-BUxpPlYV.js";import"./helperFuntions-BTpvtHBU.js";import"./Text-JJVpRIZE.js";function S(a){return p(a,"DD MMM YYYY hh:mm A").format("YYYY-MM-DDTHH:mm:ss.SSS[Z]")}const z=a=>{let t={};return a==null||a.forEach(r=>{var e;Array.isArray(r.value)?t[r.id]=(e=r.value)==null?void 0:e.join(","):t[r.id]=r.value}),t},K=a=>{var s,i;let t="";const r=(s=a==null?void 0:a[0])==null?void 0:s.id,e=(i=a==null?void 0:a[0])==null?void 0:i.desc;if(r==="createdAt"&&!e?t="ascDate":r==="createdAt"&&e&&(t="descDate"),t)return{sort:t}},Y=a=>{let t="",r="";const e=a==null?void 0:a.find(s=>s.id==="createdAt");if(e&&Array.isArray(e==null?void 0:e.value)&&(t=e!=null&&e.value[0]?S(e==null?void 0:e.value[0]):"",r=e!=null&&e.value[1]?S(e==null?void 0:e.value[1]):""),t||r)return{startDate:t,endDate:r}};function F(a,t,r){const e={pageNo:r.pageIndex+1,limit:r.pageSize,...K(t),...z(a),...Y(a)};return I.GET(M.GET_EMAIL_REPORT(),{params:e})}const T=a=>{const{columnFilters:t,EnableQuery:r,sorting:e,pagination:s}=a,[i,o]=l.useState([]);return l.useEffect(()=>{r&&o(t)},[t,r]),A({queryKey:["Email-Logs-Grid-data",i,e,s],queryFn:()=>F(i,e,s),placeholderData:E,refetchOnMount:!1,refetchOnWindowFocus:!1,retry:2})},V=()=>{var u,f;const[a,t]=l.useState([]),[r,e]=l.useState([]),[s,i]=l.useState({pageIndex:0,pageSize:10}),[o,{open:m,close:y}]=D(!1),{data:n,isError:h,isLoading:b}=T({columnFilters:a,EnableQuery:!o,sorting:r,pagination:s}),v=l.useMemo(()=>[{accessorKey:"receiverId",header:"Receiver Id",enableSorting:!1,maxSize:50},{accessorKey:"receiverName",header:"Receiver Name",enableSorting:!1,maxSize:100},{accessorKey:"orderId",header:"Order Id",enableSorting:!1,maxSize:200},{accessorKey:"emailId",header:"Email Id",enableSorting:!1,maxSize:300},{accessorKey:"emailType",header:"Email Type",enableSorting:!1,maxSize:100,filterVariant:"multi-select",filterSelectOptions:[{label:"Order Feedback",value:"orderFeedback"},{label:"Invoice",value:"invoice"}]},{accessorKey:"sendTo",header:"Receiver Type",enableSorting:!1,maxSize:50,filterVariant:"multi-select",filterSelectOptions:[{label:"Customer",value:"customer"},{label:"Merchant",value:"merchant"}]},{accessorKey:"createdAt",header:"Sent On",enableSorting:!0,accessorFn:d=>new Date(d.createdAt),filterVariant:"datetime-range",Cell:({cell:d})=>{const x=d.getValue();return p(x).format("DD MMM YYYY hh:mm A")},muiFilterDateTimePickerProps:{label:"Sent On",timeSteps:{minutes:1}},maxSize:100},{accessorKey:"error",header:"Error(if any)",enableSorting:!1,maxSize:300,enableColumnFilter:!1},{accessorKey:"sendBy",header:"Send By",enableSorting:!1,maxSize:50,enableColumnFilter:!1},{accessorKey:"status",header:"Status",enableSorting:!1,maxSize:100,filterVariant:"multi-select",filterSelectOptions:[{label:"Processing",value:"processing"},{label:"Sent",value:"sent"},{label:"Failed",value:"falied"}]}],[]);return c.jsx(O,{children:c.jsx(l.Suspense,{fallback:c.jsx(g,{height:300,width:"100%"}),children:c.jsx(P,{data:((u=n==null?void 0:n.data)==null?void 0:u.logs)??[],columnFilters:a,columns:v,pagination:s,sorting:r,totalRowCount:((f=n==null?void 0:n.data)==null?void 0:f.totalCount)??0,onColumnFiltersChange:t,onPaginationChange:i,onSortingChange:e,isLoading:b,OnFilterButtonClicked:()=>m(),OnApplyFiltersClicked:()=>y(),filterDrawerIsOpen:o,isError:h,tableName:"EmailDisplay",crudOperationHeader:"Email",columnPinning:{left:["mrt-row-select","mrt-row-actions","receiverName"],right:["status"]},uniqueIDForRows:"_id"})})})};export{V as default};
