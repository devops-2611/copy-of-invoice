import{f as V,u as O,c as H,j as n,B as G,g as ee,h as z,aa as De,s as Ie,ab as Ke,r as j,b as Se,e as qe,a as We,v as Be,z as He,S as M,M as te,Q as ye,L as Ce,N as je,X as Pe,G as Z,l as Ue,D as ue,F as he,V as Qe,P as Re,k as me,ac as Xe}from"./index-CCoVnWjL.js";import{A as Ze}from"./AppTabs-Bdo32PgV.js";import{I as Je,b as et,d as tt,C as ve,e as ke,a as Me,D as Ye,f as at,g as st,h as nt}from"./MUIThemeProvider-DzvJUod3.js";import{u as _e,A as ae,a as se}from"./ApiConstants-Deh_3We-.js";import{a as rt,I as ot}from"./InvoiceParameters-CAr-x-dm.js";import{i as lt}from"./helperFuntions-Z0gwOzhH.js";import{i as Ae,j as it,I as ct,a as ze,u as dt,e as Te,k as ut,c as ht,g as fe,b as mt,F as ft,h as pt}from"./index.esm-C1PbCTs-.js";import{I as Ne}from"./IconX-AIzjQoR6.js";import{B as gt}from"./Badge-BCNezhuX.js";import{s as Fe,d as Ee,e as bt,f as Ve,h as Oe,p as xt,i as Dt,j as A,C as It,u as St,A as yt,T as E,S as pe,L as Ct}from"./DateTimePicker-B8rljjvS.js";import{T as J}from"./Text-CZS4KpLy.js";import{A as jt}from"./AppChipComponent-BDPCUO0m.js";import{C as Pt}from"./Container-B28VRWU2.js";import{T as vt}from"./Title-DY7oMUnM.js";import"./Alert-BEsKCH5d.js";import"./List-BC4a4Dyd.js";const[kt,ne]=Ae(),[Mt,Yt]=Ae();var U={root:"m_7cda1cd6","root--default":"m_44da308b","root--contrast":"m_e3a01f8",label:"m_1e0e6180",remove:"m_ae386778",group:"m_1dcfd90b"};const _t={},At=ee((e,{gap:t},{size:s})=>({group:{"--pg-gap":t!==void 0?z(t):z(s,"pg-gap")}})),re=V((e,t)=>{const s=O("PillGroup",_t,e),{classNames:a,className:r,style:l,styles:u,unstyled:h,vars:I,size:c,disabled:p,...S}=s,g=ne(),d=(g==null?void 0:g.size)||c||void 0,b=H({name:"PillGroup",classes:U,props:s,className:r,style:l,classNames:a,styles:u,unstyled:h,vars:I,varsResolver:At,stylesCtx:{size:d},rootSelector:"group"});return n.jsx(Mt,{value:{size:d,disabled:p},children:n.jsx(G,{ref:t,size:d,...b("group"),...S})})});re.classes=U;re.displayName="@mantine/core/PillGroup";const zt={variant:"default"},Tt=ee((e,{radius:t},{size:s})=>({root:{"--pill-fz":z(s,"pill-fz"),"--pill-height":z(s,"pill-height"),"--pill-radius":t===void 0?void 0:Ie(t)}})),$=V((e,t)=>{const s=O("Pill",zt,e),{classNames:a,className:r,style:l,styles:u,unstyled:h,vars:I,variant:c,children:p,withRemoveButton:S,onRemove:g,removeButtonProps:d,radius:b,size:D,disabled:y,mod:P,...i}=s,o=Yt(),m=ne(),C=D||(o==null?void 0:o.size)||void 0,v=(m==null?void 0:m.variant)==="filled"?"contrast":c||"default",k=H({name:"Pill",classes:U,props:s,className:r,style:l,classNames:a,styles:u,unstyled:h,vars:I,varsResolver:Tt,stylesCtx:{size:C}});return n.jsxs(G,{component:"span",ref:t,variant:v,size:C,...k("root",{variant:v}),mod:[{"with-remove":S&&!y,disabled:y||(o==null?void 0:o.disabled)},P],...i,children:[n.jsx("span",{...k("label"),children:p}),S&&n.jsx(De,{variant:"transparent",radius:b,tabIndex:-1,"aria-hidden":!0,unstyled:h,...d,...k("remove",{className:d==null?void 0:d.className,style:d==null?void 0:d.style}),onMouseDown:f=>{var x;f.preventDefault(),f.stopPropagation(),(x=d==null?void 0:d.onMouseDown)==null||x.call(d,f)},onClick:f=>{var x;f.stopPropagation(),g==null||g(),(x=d==null?void 0:d.onClick)==null||x.call(d,f)}})]})});$.classes=U;$.displayName="@mantine/core/Pill";$.Group=re;var we={field:"m_45c4369d"};const Nt={type:"visible"},oe=V((e,t)=>{const s=O("PillsInputField",Nt,e),{classNames:a,className:r,style:l,styles:u,unstyled:h,vars:I,type:c,disabled:p,id:S,pointer:g,mod:d,...b}=s,D=ne(),y=it(),P=H({name:"PillsInputField",classes:we,props:s,className:r,style:l,classNames:a,styles:u,unstyled:h,rootSelector:"field"}),i=p||(D==null?void 0:D.disabled);return n.jsx(G,{component:"input",ref:Ke(t,D==null?void 0:D.fieldRef),"data-type":c,disabled:i,mod:[{disabled:i,pointer:g},d],...P("field"),...b,id:(y==null?void 0:y.inputId)||S,"aria-invalid":D==null?void 0:D.hasError,"aria-describedby":y==null?void 0:y.describedBy,type:"text",onMouseDown:o=>!g&&o.stopPropagation()})});oe.classes=we;oe.displayName="@mantine/core/PillsInputField";const Ft={},B=V((e,t)=>{const s=O("PillsInput",Ft,e),{children:a,onMouseDown:r,onClick:l,size:u,disabled:h,__staticSelector:I,error:c,variant:p,...S}=s,g=j.useRef();return n.jsx(kt,{value:{fieldRef:g,size:u,disabled:h,hasError:!!c,variant:p},children:n.jsx(ct,{size:u,error:c,variant:p,component:"div",ref:t,onMouseDown:d=>{var b;d.preventDefault(),r==null||r(d),(b=g.current)==null||b.focus()},onClick:d=>{var b;d.preventDefault(),l==null||l(d),(b=g.current)==null||b.focus()},...S,multiline:!0,disabled:h,__staticSelector:I||"PillsInput",withAria:!1,children:a})})});B.displayName="@mantine/core/PillsInput";B.Field=oe;const Le=j.createContext(null),Et=Le.Provider,Vt=()=>j.useContext(Le),Ot={},le=V((e,t)=>{const{value:s,defaultValue:a,onChange:r,size:l,wrapperProps:u,children:h,readOnly:I,...c}=O("SwitchGroup",Ot,e),[p,S]=Se({value:s,defaultValue:a,finalValue:[],onChange:r}),g=d=>{const b=d.currentTarget.value;!I&&S(p.includes(b)?p.filter(D=>D!==b):[...p,b])};return n.jsx(Et,{value:{value:p,onChange:g,size:l},children:n.jsx(ze.Wrapper,{size:l,ref:t,...u,...c,labelElement:"div",__staticSelector:"SwitchGroup",children:n.jsx(Je,{role:"group",children:h})})})});le.classes=ze.Wrapper.classes;le.displayName="@mantine/core/SwitchGroup";var Ge={root:"m_5f93f3bb",input:"m_926b4011",track:"m_9307d992",thumb:"m_93039a1d",trackLabel:"m_8277e082"};const wt={labelPosition:"right"},Lt=ee((e,{radius:t,color:s,size:a})=>({root:{"--switch-radius":t===void 0?void 0:Ie(t),"--switch-height":z(a,"switch-height"),"--switch-width":z(a,"switch-width"),"--switch-thumb-size":z(a,"switch-thumb-size"),"--switch-label-font-size":z(a,"switch-label-font-size"),"--switch-track-label-padding":z(a,"switch-track-label-padding"),"--switch-color":s?Be(s,e):void 0}})),K=V((e,t)=>{const s=O("Switch",wt,e),{classNames:a,className:r,style:l,styles:u,unstyled:h,vars:I,color:c,label:p,offLabel:S,onLabel:g,id:d,size:b,radius:D,wrapperProps:y,thumbIcon:P,checked:i,defaultChecked:o,onChange:m,labelPosition:C,description:v,error:k,disabled:f,variant:x,rootRef:Y,mod:w,...T}=s,_=Vt(),Q=b||(_==null?void 0:_.size),N=H({name:"Switch",props:s,classes:Ge,className:r,style:l,classNames:a,styles:u,unstyled:h,vars:I,varsResolver:Lt}),{styleProps:R,rest:q}=qe(T),W=We(d),F=_?{checked:_.value.includes(q.value),onChange:_.onChange}:{},[L,$e]=Se({value:F.checked??i,defaultValue:o,finalValue:!1});return n.jsxs(et,{...N("root"),__staticSelector:"Switch",__stylesApiProps:s,id:W,size:Q,labelPosition:C,label:p,description:v,error:k,disabled:f,bodyElement:"label",labelElement:"span",classNames:a,styles:u,unstyled:h,"data-checked":F.checked||void 0,variant:x,ref:Y,mod:w,...R,...y,children:[n.jsx("input",{...q,disabled:f,checked:L,onChange:X=>{var de;_?(de=F.onChange)==null||de.call(F,X):m==null||m(X),$e(X.currentTarget.checked)},id:W,ref:t,type:"checkbox",role:"switch",...N("input")}),n.jsxs(G,{"aria-hidden":"true",mod:{error:k,"label-position":C,"without-labels":!g&&!S},...N("track"),children:[n.jsx(G,{component:"span",mod:"reduce-motion",...N("thumb"),children:P}),n.jsx("span",{...N("trackLabel"),children:L?g:S})]})]})});K.classes={...Ge,...tt};K.displayName="@mantine/core/Switch";K.Group=le;/**
 * @license @tabler/icons-react v3.21.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var ie=He("outline","check","IconCheck",[["path",{d:"M5 12l5 5l10 -10",key:"svg-0"}]]);function Gt({type:e,date:t,locale:s,format:a,labelSeparator:r}){const l=u=>M(u).locale(s).format(a);return e==="default"?t===null?"":l(t):e==="multiple"?t.map(l).join(", "):e==="range"&&Array.isArray(t)?t[0]&&t[1]?`${l(t[0])} ${r} ${l(t[1])}`:t[0]?`${l(t[0])} ${r} `:"":""}function $t({formatter:e,...t}){return(e||Gt)(t)}function Kt({minDate:e,maxDate:t,timezone:s}){const a=Fe("add",new Date,s);return!e&&!t?a:e&&M(a).isBefore(e)?e:t&&M(a).isAfter(t)?t:a}function qt({type:e,value:t,defaultValue:s,onChange:a,locale:r,format:l,closeOnChange:u,sortDates:h,labelSeparator:I,valueFormatter:c}){const p=Ee(),[S,g]=te(!1),[d,b]=bt({type:e,value:t,defaultValue:s,onChange:a}),D=$t({type:e,date:d,locale:p.getLocale(r),format:l,labelSeparator:p.getLabelSeparator(I),formatter:c}),y=o=>{u&&(e==="default"&&g.close(),e==="range"&&o[0]&&o[1]&&g.close()),b(h&&e==="multiple"?[...o].sort((m,C)=>m.getTime()-C.getTime()):o)},P=()=>y(e==="range"?[null,null]:e==="multiple"?[]:null),i=e==="range"?!!d[0]:e==="multiple"?d.length>0:d!==null;return{_value:d,setValue:y,onClear:P,shouldClear:i,formattedValue:D,dropdownOpened:S,dropdownHandlers:g}}const Wt={type:"default",valueFormat:"MMMM D, YYYY",closeOnChange:!0,sortDates:!0,dropdownType:"popover"},ce=V((e,t)=>{const s=O("DatePickerInput",Wt,e),{type:a,value:r,defaultValue:l,onChange:u,valueFormat:h,labelSeparator:I,locale:c,classNames:p,styles:S,unstyled:g,closeOnChange:d,size:b,variant:D,dropdownType:y,sortDates:P,minDate:i,maxDate:o,vars:m,defaultDate:C,valueFormatter:v,...k}=s,{resolvedClassNames:f,resolvedStyles:x}=dt({classNames:p,styles:S,props:s}),{calendarProps:Y,others:w}=xt(k),{_value:T,setValue:_,formattedValue:Q,dropdownHandlers:N,dropdownOpened:R,onClear:q,shouldClear:W}=qt({type:a,value:r,defaultValue:l,onChange:u,locale:c,format:h,labelSeparator:I,closeOnChange:d,sortDates:P,valueFormatter:v}),F=Array.isArray(T)?T[0]||C:T||C,L=Ee();return n.jsx(Ve,{formattedValue:Q,dropdownOpened:R,dropdownHandlers:N,classNames:f,styles:x,unstyled:g,ref:t,onClear:q,shouldClear:W,value:T,size:b,variant:D,dropdownType:y,...w,type:a,__staticSelector:"DatePickerInput",children:n.jsx(Oe,{...Y,size:b,variant:D,type:a,value:T,defaultDate:F||Kt({maxDate:o,minDate:i,timezone:L.getTimezone()}),onChange:_,locale:c,classNames:f,styles:x,unstyled:g,__staticSelector:"DatePickerInput",__stopPropagation:y==="popover",minDate:i,maxDate:o,date:Fe("add",Y.date,L.getTimezone()),__timezoneApplied:!0})})});ce.classes={...Ve.classes,...Oe.classes};ce.displayName="@mantine/dates/DatePickerInput";const Bt=e=>{var a;let t={};const s=["fromDate","toDate","createdAt"];return(a=e==null?void 0:e.filter(r=>!(s!=null&&s.includes(r.id))))==null||a.forEach(r=>{var l;Array.isArray(r.value)?t[r.id]=(l=r.value)==null?void 0:l.join(","):r.id==="merchantId"?t.merchantIds=r.value:t[r.id]=r.value}),t},Ht=e=>{var r,l;let t="";const s=(r=e==null?void 0:e[0])==null?void 0:r.id,a=(l=e==null?void 0:e[0])==null?void 0:l.desc;if(s==="createdAt"&&!a?t="asc":s==="createdAt"&&a&&(t="desc"),t)return{sort:t}};function ge(e){return M(e,"DD MMM YYYY").format("YYYY-MM-DDTHH:mm:ss.SSS[Z]")}const Ut=e=>{let t="",s="";const a=e==null?void 0:e.find(l=>l.id==="fromDate"),r=e==null?void 0:e.find(l=>l.id==="toDate");if(a&&(t=a!=null&&a.value?ge(a==null?void 0:a.value):""),r&&(s=r!=null&&r.value?ge(r==null?void 0:r.value):""),a&&s)return{startDate:t,endDate:s};if(r)return{endDate:s};if(a)return{startDate:t}};function Qt(e,t,s){const a={pageNo:s.pageIndex+1,limit:s.pageSize,...Ht(t),...Bt(e),...Ut(e)};return ae.GET(se.GET_ALL_INVOICES_DETAILS(),{params:a})}const Rt=e=>{const{columnFilters:t,EnableQuery:s,sorting:a,pagination:r}=e,[l,u]=j.useState([]);return j.useEffect(()=>{s&&u(t)},[t,s]),_e({queryKey:["All_Invoices-Grid-data",l,a,r],queryFn:()=>Qt(l,a,r),placeholderData:ye,refetchOnMount:!1,refetchOnWindowFocus:!1,retry:2})},Xt=()=>{var y,P;const[e,t]=j.useState([]),[s,a]=j.useState([]),[r,l]=j.useState({pageIndex:0,pageSize:10}),[u,{open:h,close:I}]=te(!1),{data:c,isError:p,isLoading:S}=Rt({columnFilters:e,EnableQuery:!u,sorting:s,pagination:r}),{mutateAsync:g,isPending:d,variables:b}=rt(),D=j.useMemo(()=>[{accessorKey:"merchantId",header:"Merchant",enableColumnFilter:!0,enableSorting:!1,maxSize:100,Cell:({row:i})=>{var o,m;return`${((o=i==null?void 0:i.original)==null?void 0:o.merchantName)??""} (${(m=i==null?void 0:i.original)==null?void 0:m.merchantId})`}},{accessorKey:"invoiceParameters.bankTransfer",header:"To be paid",enableSorting:!1,enableColumnFilter:!1},{accessorKey:"createdAt",header:"Created At",accessorFn:i=>new Date(i==null?void 0:i.createdAt),Cell:({cell:i})=>{const o=i.getValue();return M(o).format("DD MMM YYYY")},enableColumnFilter:!1,maxSize:150},{accessorKey:"fromDate",header:"From Date",accessorFn:i=>new Date(i==null?void 0:i.fromDate),enableSorting:!1,filterVariant:"date",muiFilterDatePickerProps:{label:"From Date",format:"DD MMM YYYY"},Cell:({cell:i})=>{const o=i.getValue();return M(o).format("DD MMM YYYY")},maxSize:150},{accessorKey:"toDate",header:"To Date",maxSize:150,enableSorting:!1,accessorFn:i=>new Date(i==null?void 0:i.toDate),Cell:({cell:i})=>{const o=i.getValue();return M(o).format("DD MMM YYYY")},filterVariant:"date",muiFilterDatePickerProps:{label:"To Date",format:"DD MMM YYYY"}},{accessorKey:"invoiceId",header:"Invoice ID",enableSorting:!1},{accessorKey:"status",header:"Status",maxSize:100,Cell:({cell:i,row:o})=>{var m,C;if(i.getValue())return n.jsx(ve,{children:d&&((m=b==null?void 0:b.updates)==null?void 0:m.invoiceId)===o.original.invoiceId?n.jsx(Ce,{size:"sm"}):n.jsx(K,{disabled:!((C=o==null?void 0:o.original)!=null&&C.isEditable),size:"lg",checked:i.getValue()==="PAID",onLabel:"PAID",offLabel:"UNPAID",thumbIcon:i.getValue()==="PAID"?n.jsx(ie,{size:12,color:"var(--mantine-color-teal-6)",stroke:3}):n.jsx(Ne,{size:12,color:"var(--mantine-color-red-6)",stroke:3}),styles:{trackLabel:{width:"40px",fontSize:"xl"}},onChange:v=>{g({updates:{...o==null?void 0:o.original,status:v.currentTarget.checked?"PAID":"UNPAID"}})}})})},enableColumnFilter:!0,filterVariant:"autocomplete",filterSelectOptions:[{value:"PAID",label:"PAID"},{value:"UNPAID",label:"UNPAID"}],enableSorting:!1},{accessorKey:"isSentToMerchant",header:"Sent to Merchant",Cell:({cell:i})=>n.jsx(ke,{children:i.getValue()?"Yes":"No"}),enableSorting:!1,enableColumnFilter:!0,filterVariant:"autocomplete",maxSize:100,filterSelectOptions:[{value:"true",label:"YES"},{value:"false",label:"NO"}]},{accessorKey:"downloadLink",header:"View Invoice",enableSorting:!1,enableColumnFilter:!1,maxSize:100,Cell:({cell:i})=>{const o=i.getValue();return o?n.jsx("a",{href:`${o}`,target:"_blank",download:`${o}`,children:n.jsx(je,{color:"green",cursor:"pointer"})}):"Not Available"}}],[d]);return n.jsx(Me,{children:n.jsx(j.Suspense,{fallback:n.jsx(Pe,{height:300,width:"100%"}),children:n.jsx(Ye,{data:((y=c==null?void 0:c.data)==null?void 0:y.invoices)??[],columnFilters:e,columns:D,pagination:r,sorting:s,totalRowCount:((P=c==null?void 0:c.data)==null?void 0:P.totalCount)??0,onColumnFiltersChange:t,onPaginationChange:l,onSortingChange:a,isLoading:S,OnFilterButtonClicked:()=>h(),OnApplyFiltersClicked:()=>I(),filterDrawerIsOpen:u,enableRowSelection:!0,isError:p,tableName:"AllInvoicesDisplay",crudOperationHeader:"Invoices",columnPinning:{left:["mrt-row-select"]},uniqueIDForRows:"invoiceId",enableRowActions:!1,muiExpandButtonProps:({row:i,table:o})=>({onClick:()=>o.setExpanded({[i.id]:!i.getIsExpanded()}),sx:{transform:i.getIsExpanded()?"rotate(180deg)":"rotate(-90deg)",transition:"transform 0.2s"}}),renderDetailPanel:({row:i})=>{var o;return(o=i.original)!=null&&o.invoiceParameters?n.jsx(ot,{row:i}):void 0},renderCaption:({table:i})=>{var o,m;return lt((o=c==null?void 0:c.data)==null?void 0:o.totalToBePaid)?n.jsx(gt,{size:"lg",styles:{label:{textTransform:"none"}},children:`Total To be Paid: £
                ${((m=c==null?void 0:c.data)==null?void 0:m.totalToBePaid)??"0"}`}):void 0}})})})},Zt=({name:e,label:t,disabled:s})=>{const{values:a,errors:r,touched:l,setFieldValue:u}=Te(),h={touched:l[e],error:r[e]},I=a[e],c=h.touched&&h.error&&typeof h.error=="string"?h.error:void 0;return n.jsx(ut,{name:e,children:({field:p})=>n.jsx("div",{children:n.jsx(ce,{...p,type:"range",label:t,value:I,onChange:S=>u(e,S),disabled:s,error:c,placeholder:"Pick dates range",valueFormat:"DD MMM YYYY",maxDate:new Date})})})};function Jt(e){var m,C,v,k;const{name:t}=e,s=Dt({onDropdownClose:()=>s.resetSelectedOption(),onDropdownOpen:()=>s.updateSelectedOptionIndex("active")}),[a,r]=j.useState(""),{data:l,isLoading:u,isError:h,isFetching:I}=at(a,s.dropdownOpened,1,100),{values:c,setFieldValue:p,errors:S,touched:g}=Te(),d={touched:g[t],error:S[t]},b=f=>{const x=c==null?void 0:c[t],Y=x?x!=null&&x.includes(f)?x==null?void 0:x.filter(w=>w!==f):[...x,f]:[f];p(t,Y),r("")},D=f=>p(t,c==null?void 0:c[t].filter(x=>x!==f)),y=j.useCallback(()=>{p(t,[])},[]),P=(m=c==null?void 0:c[t])==null?void 0:m.map(f=>n.jsx($,{withRemoveButton:!0,onRemove:()=>D(f),styles:{root:{backgroundColor:"#12b886",color:"white",fontWeight:"normal"}},children:f},f)),i=(v=(C=l==null?void 0:l.data)==null?void 0:C.merchants)==null?void 0:v.map(f=>{var Y;const x=f.merchantName+" ("+f.merchantId.toString()+")";return n.jsx(A.Option,{value:x,children:n.jsxs(Z,{gap:"sm",children:[(Y=c==null?void 0:c[t])!=null&&Y.includes(x)?n.jsx(It,{size:12}):null,n.jsx("span",{children:x})]})},x)}),o=j.useMemo(()=>{var f;return u||I?"Loading Merchants...":h?"No Merchants Found":(f=l==null?void 0:l.data)!=null&&f.totalCount&&l.data.totalCount>100?"More than 100 Merchants found, Please refine your search":null},[u,I,h,l]);return n.jsxs(A,{store:s,onOptionSubmit:b,children:[n.jsx(A.Header,{styles:{header:{borderBottom:0,paddingBottom:0}},children:n.jsx(J,{size:"sm",fw:500,children:"Select Merchants"})}),n.jsx(A.DropdownTarget,{children:n.jsx(B,{onClick:()=>s.openDropdown(),size:"md",rightSection:((k=c==null?void 0:c[t])==null?void 0:k.length)!==0&&n.jsx(De,{size:"sm",onMouseDown:f=>f.preventDefault(),onClick:()=>{y()},"aria-label":"Clear value"}),children:n.jsxs($.Group,{children:[P,n.jsx(A.EventsTarget,{children:n.jsx(B.Field,{onFocus:()=>s.openDropdown(),onBlur:()=>s.closeDropdown(),value:a,placeholder:"Search Merchants",onChange:f=>{s.updateSelectedOptionIndex(),r(f.currentTarget.value)},onKeyDown:f=>{var x;f.key==="Backspace"&&a.length===0&&(f.preventDefault(),D(c==null?void 0:c[t][((x=c==null?void 0:c[t])==null?void 0:x.length)-1]))}})})]})})}),n.jsx(A.Dropdown,{children:n.jsx(A.Options,{mah:300,style:{overflowY:"auto"},children:i&&i.length>0?i:n.jsx(A.Empty,{children:o})})}),d.error&&typeof d.error=="string"&&n.jsx(A.Footer,{styles:{footer:{borderTop:0}},children:n.jsx(J,{c:"red",size:"xs",children:d.error})})]})}const ea=async e=>{if(!e.merchantIds||e.lastWeek===null)throw new Error("Missing required fields");if(!e.lastWeek&&(!e.startDate||!e.endDate))throw new Error("Start date and End date are required when 'lastWeek' is false");return ae.POST(se.GENERATE_INVOICE_BY_MERCHANTID_AND_DATE_RANGE(),e)},ta=()=>{const e=Ue();return St({mutationFn:async t=>await ea(t),onSuccess:t=>{var s,a;(a=(s=t==null?void 0:t.data)==null?void 0:s.invoices)!=null&&a.some(r=>r.status==="success")&&e.invalidateQueries({queryKey:["All_Invoices-Grid-data"]})},onError:t=>{var s,a;t instanceof yt?ue.show({title:((a=(s=t==null?void 0:t.response)==null?void 0:s.data)==null?void 0:a.message)??"Request Failed",message:"There was an error processing the invoice request.",color:"red",autoClose:5e3}):ue.show({title:"Invoice Creation Failed",message:"Something went wrong.",color:"red",autoClose:5e3})}})};function aa({data:e,headers:t,columnsMapping:s,uniqueKeyInRows:a}){const r=e==null?void 0:e.map((l,u)=>n.jsx(E.Tr,{children:t.map(h=>n.jsx(E.Td,{styles:{td:{textAlign:"center"}},children:h==="Status"?n.jsx(jt,{value:l[s[h]]??""}):n.jsx(J,{children:l[s[h]]??""})},h))},a&&a in l?l[a]:u));return n.jsxs(E,{verticalSpacing:"sm",stickyHeader:!0,children:[n.jsx(E.Thead,{children:n.jsx(E.Tr,{children:t.map(l=>n.jsx(E.Th,{styles:{th:{textAlign:"center"}},children:l},l))})}),n.jsx(E.Tbody,{children:r})]})}const sa=ht({merchantIds:fe().of(mt().required("Merchant ID is required")).min(1,"At least one Merchant ID must be selected").required("Merchant IDs are required"),dateRange:fe().min(2,"Date Range is Required").max(2,"Date Range is Required").when("isLastWeek",{is:!0,then:e=>e.nullable("Should be Null"),otherwise:e=>e.required("required").nonNullable("Should not be Null ")})});function be(e){var t;return(t=e.map(s=>{const a=RegExp(/\((\d+)\)/).exec(s);return a?a[1]:null}).filter(s=>s!==null))==null?void 0:t.join(",")}const na=e=>e!=null&&e.isLastWeek?{merchantIds:be(e==null?void 0:e.merchantIds),lastWeek:e==null?void 0:e.isLastWeek}:{merchantIds:be(e==null?void 0:e.merchantIds),lastWeek:e==null?void 0:e.isLastWeek,startDate:e!=null&&e.dateRange[0]?e==null?void 0:e.dateRange[0]:null,endDate:e!=null&&e.dateRange[1]?e==null?void 0:e.dateRange[1]:null},ra={"Merchant ID":"merchantId",Message:"message",Status:"status"},oa=()=>{const{mutate:e,isPending:t,isSuccess:s,data:a}=ta(),r=j.useRef(null);j.useEffect(()=>{var u,h;return s&&(a!=null&&a.data)&&he.open({title:n.jsx(Qe,{icon:n.jsx(ie,{}),color:"teal",title:((u=a==null?void 0:a.data)==null?void 0:u.message)??"Details",mt:"md",withCloseButton:!1,styles:{root:{boxShadow:"none"}}}),children:n.jsx(aa,{data:(h=a==null?void 0:a.data)==null?void 0:h.invoices,headers:["Merchant ID","Message","Status"],columnsMapping:ra,uniqueKeyInRows:"merchantId"}),size:"lg"}),()=>{he.closeAll()}},[s]);const l=u=>{e(na(u))};return n.jsx(Pt,{size:"sm",mt:30,children:n.jsxs(Re,{p:"xl",shadow:"sm",withBorder:!0,pos:"relative",children:[n.jsx(vt,{order:5,ta:"center",mb:20,c:"grey",children:"Select Merchant Id and Date Range to generate Invoice"}),n.jsx(ft,{initialValues:{merchantIds:[],isLastWeek:!1,dateRange:[]},validationSchema:sa,onSubmit:u=>{l(u)},innerRef:r,children:({setFieldValue:u,values:h})=>n.jsx(pt,{children:n.jsxs(pe,{children:[n.jsx(pe,{gap:"xs",children:n.jsx(Jt,{name:"merchantIds"})}),n.jsxs(Z,{gap:"lg",grow:!0,align:"flex-start",children:[n.jsx(Zt,{name:"dateRange",label:"Select Date Range",disabled:h==null?void 0:h.isLastWeek}),n.jsx(st,{name:"isLastWeek",label:"Last Week",OnChangeHandler:I=>{u("isLastWeek",I.target.checked),I.target.checked&&u("dateRange",[null,null])}})]}),n.jsxs(Z,{grow:!0,gap:"md",mt:20,children:[n.jsx(me,{type:"submit",disabled:t,loading:t,children:"Submit"}),n.jsx(me,{type:"reset",variant:"outline",children:"Reset"})]})]})})}),n.jsx(Ct,{visible:t,zIndex:1e3,overlayProps:{radius:"sm",blur:2}})]})})},la=e=>{var a;let t={};const s=["fromDate","toDate","createdAt"];return(a=e==null?void 0:e.filter(r=>!(s!=null&&s.includes(r.id))))==null||a.forEach(r=>{var l;Array.isArray(r.value)?t[r.id]=(l=r.value)==null?void 0:l.join(","):t[r.id]=r.value}),t},ia=e=>{var r,l;let t="";const s=(r=e==null?void 0:e[0])==null?void 0:r.id,a=(l=e==null?void 0:e[0])==null?void 0:l.desc;if(s==="createdAt"&&!a?t="asc":s==="createdAt"&&a&&(t="desc"),t)return{sort:t}};function xe(e){return M(e,"DD MMM YYYY").format("YYYY-MM-DDTHH:mm:ss.SSS[Z]")}const ca=e=>{let t="",s="";const a=e==null?void 0:e.find(l=>l.id==="fromDate"),r=e==null?void 0:e.find(l=>l.id==="toDate");if(a&&(t=a!=null&&a.value?xe(a==null?void 0:a.value):""),r&&(s=r!=null&&r.value?xe(r==null?void 0:r.value):""),a&&s)return{startDate:t,endDate:s};if(r)return{endDate:s};if(a)return{startDate:t}};function da(e,t,s){const a={pageNo:s.pageIndex+1,limit:s.pageSize,...ia(t),...la(e),...ca(e),isManualCreate:!0};return ae.GET(se.GET_ALL_INVOICES_DETAILS(),{params:a})}const ua=e=>{const{columnFilters:t,EnableQuery:s,sorting:a,pagination:r}=e,[l,u]=j.useState([]),h=["All_Manual_Invoices-Grid-data",l,s,a,r];return j.useEffect(()=>{s&&u(t)},[t,s]),_e({queryKey:h,queryFn:()=>da(l,a,r),placeholderData:ye,refetchOnMount:!1,refetchOnWindowFocus:!1,retry:2})},ha=()=>{var P,i;const[e,t]=j.useState([]),[s,a]=j.useState([]),[r,l]=j.useState({pageIndex:0,pageSize:10}),[u,{open:h,close:I}]=te(!1),{search:c}=Xe(),{data:p,isError:S,isLoading:g}=ua({columnFilters:e,EnableQuery:!u&&(c==null?void 0:c.includes("Other_Invoices")),sorting:s,pagination:r}),{mutateAsync:d,isPending:b,variables:D}=nt(),y=j.useMemo(()=>[{accessorKey:"merchantName",header:"Name",enableColumnFilter:!0,enableSorting:!1,maxSize:100,Cell:({row:o})=>{var m,C;return`${((m=o==null?void 0:o.original)==null?void 0:m.merchantName)??""} (${(C=o==null?void 0:o.original)==null?void 0:C.merchantId})`}},{accessorKey:"createdAt",header:"Created At",accessorFn:o=>o!=null&&o.createdAt?new Date(o==null?void 0:o.createdAt):"",Cell:({cell:o})=>{const m=o.getValue();return M(m).format("DD MMM YYYY")},enableColumnFilter:!1,maxSize:150},{accessorKey:"fromDate",header:"From Date",accessorFn:o=>new Date(o==null?void 0:o.fromDate),enableSorting:!1,filterVariant:"date",muiFilterDatePickerProps:{label:"From Date",format:"DD MMM YYYY"},Cell:({cell:o})=>{const m=o.getValue();return M(m).format("DD MMM YYYY")},maxSize:150},{accessorKey:"toDate",header:"To Date",maxSize:150,enableSorting:!1,accessorFn:o=>new Date(o==null?void 0:o.toDate),Cell:({cell:o})=>{const m=o.getValue();return M(m).format("DD MMM YYYY")},filterVariant:"date",muiFilterDatePickerProps:{label:"To Date",format:"DD MMM YYYY"}},{accessorKey:"invoiceId",header:"Invoice ID",enableSorting:!1},{accessorKey:"status",header:"Status",maxSize:100,Cell:({cell:o,row:m})=>{var C;if(o.getValue())return n.jsx(ve,{children:b&&(D==null?void 0:D.invoiceId)===m.original.invoiceId?n.jsx(Ce,{size:"sm"}):n.jsx(K,{disabled:!((C=m==null?void 0:m.original)!=null&&C.isEditable),size:"lg",checked:o.getValue()==="PAID",onLabel:"PAID",offLabel:"UNPAID",thumbIcon:o.getValue()==="PAID"?n.jsx(ie,{size:12,color:"var(--mantine-color-teal-6)",stroke:3}):n.jsx(Ne,{size:12,color:"var(--mantine-color-red-6)",stroke:3}),styles:{trackLabel:{width:"40px",fontSize:"xl"}},onChange:v=>{d({...m==null?void 0:m.original,status:v.currentTarget.checked?"PAID":"UNPAID"})}})})},enableColumnFilter:!0,filterVariant:"autocomplete",filterSelectOptions:[{value:"PAID",label:"PAID"},{value:"UNPAID",label:"UNPAID"}],enableSorting:!1},{accessorKey:"isSentToMerchant",header:"Sent to Customer",Cell:({cell:o})=>n.jsx(ke,{children:o.getValue()?"Yes":"No"}),enableSorting:!1,enableColumnFilter:!0,filterVariant:"autocomplete",maxSize:100,filterSelectOptions:[{value:"true",label:"YES"},{value:"false",label:"NO"}]},{accessorKey:"downloadLink",header:"View Invoice",enableSorting:!1,enableColumnFilter:!1,maxSize:100,Cell:({cell:o})=>{const m=o.getValue();return m?n.jsx("a",{href:`${m}`,target:"_blank",download:`${m}`,children:n.jsx(je,{color:"green",cursor:"pointer"})}):"Not Available"}}],[b]);return n.jsx(Me,{children:n.jsx(j.Suspense,{fallback:n.jsx(Pe,{height:300,width:"100%"}),children:n.jsx(Ye,{data:((P=p==null?void 0:p.data)==null?void 0:P.invoices)??[],columnFilters:e,columns:y,pagination:r,sorting:s,totalRowCount:((i=p==null?void 0:p.data)==null?void 0:i.totalCount)??0,onColumnFiltersChange:t,onPaginationChange:l,onSortingChange:a,isLoading:g,OnFilterButtonClicked:()=>h(),OnApplyFiltersClicked:()=>I(),filterDrawerIsOpen:u,enableRowSelection:!0,isError:S,tableName:"AllManualInvoicesDisplay",crudOperationHeader:"Invoice",columnPinning:{left:["mrt-row-select"]},uniqueIDForRows:"invoiceId",enableRowActions:!0,ManualInvoiceTableCellForm:!0})})})};function Ya(){const e=[{label:"Generate Invoices",value:"Generate_Invoices",content:n.jsx(oa,{})},{label:"View Invoices",value:"View_Invoices",content:n.jsx(Xt,{})},{label:"Other Invoices",value:"Other_Invoices",content:n.jsx(ha,{})}];return n.jsx(Ze,{tabs:e})}export{Ya as default};
