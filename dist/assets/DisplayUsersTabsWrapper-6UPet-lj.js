import{i as q,r as u,y as M,z as V,A as R,F as P,j as t,S as W,b as K,M as z,a as H,n as Q,a2 as J,a3 as X,B as N,G as F,P as Y,T as O,C as Z,e as A,a4 as ee}from"./index-BocbaNEA.js";import{A as se}from"./AppTabs-BnFmm1yZ.js";import{b as w,d as te,S as ae,c as re}from"./useUpdateUser-J2CWGRqD.js";import{a as ne,D as ie,g as f}from"./MUIThemeProvider-CweUhTdT.js";import{c as I,h as le}from"./helperFuntions-CM2HUrvq.js";import{f as oe,g as U,h as ce,F as de,b as ue}from"./index.esm-BJmHqlnb.js";import{S as he}from"./Switch-S7oiMSIF.js";import{T as me}from"./Title-DvwRX8VF.js";import{D as E}from"./Rating-puGU3s4J.js";import{L as pe}from"./LoadingOverlay-pZ8X-IXh.js";import"./index-DBElLul9.js";import"./FormikInputField-vBle5Dp0.js";import"./TextInput-WJD_G6xF.js";import"./Alert-BlMm2AM-.js";/**
 * @license @tabler/icons-react v3.21.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var fe=q("outline","chevron-left","IconChevronLeft",[["path",{d:"M15 6l-6 6l6 6",key:"svg-0"}]]);const be=e=>({admin:"api/auth/getAllAdminUsers",merchant:"api/auth/getAllMerchantUsers",staff:"api/auth/getAllStaffUsers",support:"api/auth/getAllSupportUsers",affiliate:"api/auth/getAllAffiliateUsers",driver:"api/auth/getAllDriverUsers"})[e],ye=e=>e!=null&&e.length?{sort:e[0].desc?`desc${e[0].id}`:`asc${e[0].id}`}:{},ge=e=>{let s={};return e==null||e.forEach(a=>{s[a.id]=Array.isArray(a.value)?a.value.join(","):a.value}),s},xe=(e,s,a,r)=>{const o={pageNo:r.pageIndex+1,limit:r.pageSize,...ye(a),...ge(s)};return R.GET(be(e),{params:o})},Se=({role:e,columnFilters:s,enableQuery:a,sorting:r,pagination:o})=>{const[c,m]=u.useState([]);return u.useEffect(()=>{a&&m(s)},[s,a]),M({queryKey:[`Users-Grid-${e}-data`,c,r,o],queryFn:()=>xe(e,c,r,o),enabled:a,placeholderData:V,refetchOnWindowFocus:!1,retry:2})};var L;const ve=(L=w)==null?void 0:L.filter(e=>e.value!=="superAdmin"),x=[{key:"firstName",name:"firstName",fieldType:"Text",label:"First Name"},{key:"lastName",name:"lastName",fieldType:"Text",label:"Last Name"},{key:"userName",name:"userName",fieldType:"Text",label:"Username",disabled:{disableFieldForEdit:!0}},{key:"email",name:"email",fieldType:"Text",label:"Email",disabled:{disableFieldForEdit:!0}},{key:"role",name:"role",fieldType:"Select",label:"Role",meta:{options:ve},disabled:{disabledFieldForNew:!0,disableFieldForEdit:!0}},{key:"status",name:"status",fieldType:"Select",label:"Status",hidden:{hideFieldForNEW:!0},meta:{options:te}}],je={merchant:[...x,{key:"merchantIds",name:"merchantIds",fieldType:"MerchantIDs",label:"Select Merchant ID(s)"}],affiliate:[...x,{key:"affiliateId",name:"affiliateId",fieldType:"Text",label:"Affiliate ID"}],admin:[...x],staff:[...x],support:[...x,{key:"supportLevel",name:"supportLevel",fieldType:"Select",label:"Support Level",meta:{options:[{label:"L1",value:"L1"},{label:"L2",value:"L2"}]}}],driver:[...x,{key:"licenseNumber",name:"licenseNumber",fieldType:"Text",label:"Driver License Number"},{key:"vehicleType",name:"vehicleType",fieldType:"Select",label:"Vehicle Type",meta:{options:[{label:"Car",value:"car"},{label:"Bike",value:"bike"}]}}]},S=[{accessorKey:"firstName",header:"First Name",enableSorting:!0},{accessorKey:"lastName",header:"Last Name",enableSorting:!0},{accessorKey:"email",header:"Email",enableSorting:!1},{accessorKey:"userName",header:"UserName",enableSorting:!1},{accessorKey:"phone",header:"Phone",enableSorting:!1},{accessorKey:"lastLogin",header:"Last Login",enableSorting:!1,Cell:({cell:e})=>I(e.getValue())},{accessorKey:"lastActive",header:"Last Active",enableSorting:!1,Cell:({cell:e})=>I(e.getValue())},{accessorKey:"userId",header:"User ID",enableSorting:!1},{accessorKey:"activatedOn",header:"Activated On",enableSorting:!1,Cell:({cell:e})=>I(e.getValue())}],Te={admin:[...S],affiliate:[...S,{accessorKey:"referralCode",header:"Referral Code",enableSorting:!1}],staff:[...S,{accessorKey:"department",header:"Department",enableSorting:!1}],support:[...S,{accessorKey:"ticketCount",header:"Ticket Count",enableSorting:!0}],driver:[...S,{accessorKey:"licenseNumber",header:"License Number",enableSorting:!1},{accessorKey:"vehicleType",header:"Vehicle Type",enableSorting:!1}],merchant:[...S,{accessorKey:"merchantIds",header:"Merchant IDs",enableSorting:!1,accessorFn:e=>{var s;return(s=e==null?void 0:e.merchantIds)==null?void 0:s.join(", ")}}]},Ce=({role:e})=>{var p,b;const[s,a]=u.useState([]),[r,o]=u.useState([]),[c,m]=u.useState({pageIndex:0,pageSize:50}),[n,{open:v,close:l}]=P(!1),{data:i,isError:y,isLoading:h}=Se({role:e,columnFilters:s,enableQuery:!n,sorting:r,pagination:c}),d=u.useMemo(()=>Te[e],[e]);return t.jsx(ne,{children:t.jsx(u.Suspense,{fallback:t.jsx(W,{height:300,width:"100%"}),children:t.jsx(ie,{data:((p=i==null?void 0:i.data)==null?void 0:p.users)??[],columnFilters:s,columns:d,pagination:c,sorting:r,totalRowCount:((b=i==null?void 0:i.data)==null?void 0:b.totalCount)??0,onColumnFiltersChange:a,onPaginationChange:m,onSortingChange:o,isLoading:h,OnFilterButtonClicked:v,OnApplyFiltersClicked:l,filterDrawerIsOpen:n,enableRowSelection:!0,isError:y,tableName:"UsersDisplay",crudOperationHeader:`${e.charAt(0).toUpperCase()+e.slice(1)} User`,columnPinning:{left:["mrt-row-select","mrt-row-actions","firstName"]},uniqueIDForRows:"userId",uiSchema:je[e]})})})},D=({name:e,label:s,disabled:a,handleExternally:r=!1,onChange:o})=>{const{values:c,errors:m,touched:n,setFieldValue:v}=oe(),l=U(c,e)??!1,i=U(m,e),y=U(n,e),h=u.useCallback((d,p)=>{if(r){o(p);return}v(d,p.currentTarget.checked)},[r,o]);return t.jsx(ce,{name:e,children:({field:d})=>t.jsx(he,{name:e,label:s,checked:l,disabled:a,error:y&&i?i:void 0,onChange:p=>h(e,p)})})},Ae=e=>{if(e)return R.GET(K.GET_ROLE_BASED_CONFIG_MENUS(e));throw new Error("Role or Token Unavailable")},ke=e=>M({queryKey:["roleBasedMenus",e],queryFn:()=>Ae(e),refetchOnWindowFocus:!1,enabled:!!e,retry:1,select:s=>{var a;return(a=s==null?void 0:s.data)==null?void 0:a.menu}}),Fe=()=>{};class $ extends u.PureComponent{constructor(...s){super(...s),this.i=!1,this.h=null,this.o=Fe,this.state={t:!0}}componentWillUnmount(){this.o()}u(s){s!==this.h&&(this.o(),this.h=null,s&&(this.h=s,this.o=s.on("updated",()=>this.setState({t:!this.state.t}))))}get allowed(){return this.i}l(){const s=this.props,a=s.of||s.a||s.an||s.this||s.on,r=s.not?"cannot":"can";return s.ability[r](s.I||s.do,a,s.field)}render(){return this.u(this.props.ability),this.i=this.l(),this.props.passThrough||this.i?this.p():null}p(){const{children:s,ability:a}=this.props;return typeof s=="function"?s(this.i,a):s}}async function Ie({role:e,menus:s}){const a=K.EDIT_ROLE_BASED_CONFIG_MENUS();return R.PUT(a,{role:e,menus:s})}const Ue=()=>{const e=z();return H({mutationFn:({role:s,menus:a})=>Ie({role:s,menus:a}),onSuccess:s=>{var a,r;Q.show({title:"Success",message:"Role-based menu configuration updated successfully",color:"green",autoClose:2e3,position:"top-center"}),e.invalidateQueries({queryKey:["roleBasedMenus",(r=(a=s==null?void 0:s.data)==null?void 0:a.menu)==null?void 0:r.role]})},onError:s=>{J.isAxiosError(s)?le(s):console.error("Non-Axios error:",s)}})},Ne=()=>{const[e,s]=u.useState(null),{data:a,isLoading:r}=ke(e),{mutateAsync:o,isPending:c}=Ue(),m=u.useCallback(l=>{o(l)},[]),{ability:n}=X(),v=u.useMemo(()=>{var l;return(l=w)==null?void 0:l.filter(i=>(i==null?void 0:i.value)!=="superAdmin")},[]);return t.jsx(N,{children:t.jsxs($,{I:"view",a:"RoleBasedConfiguration",ability:n,children:[t.jsxs(F,{children:[t.jsx(me,{order:4,mb:"md",children:"Role-Based Menu Settings"}),t.jsx(ae,{value:e,onChange:s,data:v,placeholder:"Choose Role",mb:"md"})]}),t.jsx(E,{my:"md"}),t.jsxs(Y,{shadow:"md",p:"md",radius:"md",children:[t.jsx(pe,{visible:r||c}),!e&&t.jsx(O,{children:"Select the role to configure the menu settings for that role."}),!r&&a&&t.jsx(de,{initialValues:a,enableReinitialize:!0,onSubmit:l=>m(l),children:({values:l,setFieldValue:i})=>{var y;return t.jsxs(ue,{children:[t.jsx(f.ScrollContainer,{minWidth:100,type:"native",mah:430,p:0,children:t.jsxs(f,{withTableBorder:!0,withColumnBorders:!0,stickyHeaderOffset:0,stickyHeader:!0,children:[t.jsx(f.Thead,{children:t.jsxs(f.Tr,{children:[t.jsx(f.Th,{style:{width:"25%"},children:"Main Menu"}),t.jsx(f.Th,{children:"Submenus"})]})}),t.jsx(f.Tbody,{children:(y=a==null?void 0:a.menus)==null?void 0:y.map((h,d)=>{var p;return t.jsxs(f.Tr,{children:[t.jsx(f.Td,{children:t.jsx(D,{name:`menus[${d}].isActive`,label:h.label,handleExternally:!0,onChange:async b=>{var T;const j=b.target.checked;i(`menus[${d}].isActive`,j);const k=(T=h.submenu)==null?void 0:T.map(g=>({...g,isActive:j}));i(`menus[${d}].submenu`,k)}})}),t.jsx(f.Td,{children:t.jsx(F,{gap:"lg",children:(p=h==null?void 0:h.submenu)==null?void 0:p.map((b,j)=>t.jsx(N,{w:"200px",children:t.jsx(D,{name:`menus[${d}].submenu[${j}].isActive`,label:b.label,handleExternally:!0,onChange:k=>{var B;const T=k.target.checked,g=(B=l==null?void 0:l.menus[d].submenu)==null?void 0:B.map((C,_)=>_===j?{...C,isActive:T}:C);i(`menus[${d}].submenu`,g);const G=g==null?void 0:g.some(C=>C.isActive);i(`menus[${d}].isActive`,G)}},`${h.label}_${b.label}`)},b.label))})})]},h.label+"index")})})]})}),t.jsx(E,{}),t.jsx(Z,{children:t.jsxs(F,{mt:"md",children:[t.jsx(A,{type:"submit",children:"Submit"}),t.jsx(A,{variant:"outline",type:"reset",children:"Reset"})]})})]})}})]})]})})},Ve=()=>{var c,m;const{ability:e}=ee(),[s,{open:a,close:r}]=P(!1),o=(m=(c=w)==null?void 0:c.filter(n=>n.value!=="superAdmin"&&e.can("access",`${n==null?void 0:n.value}UserTab`)))==null?void 0:m.map(n=>({label:n.label,value:n.value,hidden:!e.can("access",`${n.value}UserTab`),content:t.jsx(Ce,{role:n==null?void 0:n.value})}));return t.jsxs(N,{children:[t.jsxs($,{I:"view",a:"RoleBasedConfiguration",ability:e,children:[t.jsxs(re,{justify:"space-between",align:"center",w:"100%",styles:{root:{border:"1px solid lightgrey",padding:"10px 20px",borderRadius:"1rem",background:"#f3f3f3",marginBottom:"1.5rem"}},children:[s&&t.jsx(A,{onClick:()=>r(),size:"sm",leftSection:t.jsx(fe,{}),variant:"gradient",children:"Go Back"}),!s&&t.jsxs(t.Fragment,{children:[t.jsx(O,{style:{fontWeight:500},children:"Roles and Permissions : "}),t.jsx(A,{variant:"gradient",onClick:()=>a(),children:"Access & Permissions"})]})]}),t.jsx(E,{m:10})]}),s?t.jsx(Ne,{}):t.jsx(se,{tabs:o})]})};export{Ve as default};
