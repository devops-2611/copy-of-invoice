import{k as q,r as o,E as M,F as V,A as U,K as P,j as t,d as W,a9 as z,b as K,R as H,a as Q,af as J,n as X,B as N,G as F,P as Y,T as O,m as Z,e as A,a7 as ee}from"./index-BLIlmA3H.js";import{A as se}from"./AppTabs-C-8ZgSK-.js";import{b as w,c as te}from"./useUpdateUser-w8Owpn5w.js";import{a as ae,D as re,T as ne,i as f}from"./MUIThemeProvider-C19IRQrA.js";import{c as E,h as ie}from"./helperFuntions-DGUG679L.js";import{e as le,g as I,f as oe,F as ce,a as de}from"./index.esm-DfjObHCA.js";import{T as ue}from"./Title-DKWiMa_B.js";import{S as he,F as me}from"./Select-BzWorYtb.js";import{D as R}from"./index-BK5A5XBL.js";import{L as pe}from"./LoadingOverlay-C_GBlKZb.js";import"./Tabs-Dn3yYXdp.js";import"./InputBase-DX49xYkW.js";import"./FormikInputField-B2PJ7d2X.js";import"./TextInput-HlJqnerf.js";import"./Alert-D3dw1Im4.js";import"./Stack-C0tO9y16.js";/**
 * @license @tabler/icons-react v3.31.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var fe=q("outline","chevron-left","IconChevronLeft",[["path",{d:"M15 6l-6 6l6 6",key:"svg-0"}]]);const be=e=>({admin:"api/auth/getAllAdminUsers",merchant:"api/auth/getAllMerchantUsers",staff:"api/auth/getAllStaffUsers",support:"api/auth/getAllSupportUsers",affiliate:"api/auth/getAllAffiliateUsers",driver:"api/auth/getAllDriverUsers"})[e],ye=e=>e!=null&&e.length?{sort:e[0].desc?`desc${e[0].id}`:`asc${e[0].id}`}:{},ge=e=>{let s={};return e==null||e.forEach(a=>{s[a.id]=Array.isArray(a.value)?a.value.join(","):a.value}),s},xe=(e,s,a,r)=>{const c={pageNo:r.pageIndex+1,limit:r.pageSize,...ye(a),...ge(s)};return U.GET(be(e),{params:c})},Se=({role:e,columnFilters:s,enableQuery:a,sorting:r,pagination:c})=>{const[d,m]=o.useState([]);return o.useEffect(()=>{a&&m(s)},[s,a]),M({queryKey:[`Users-Grid-${e}-data`,d,r,c],queryFn:()=>xe(e,d,r,c),enabled:a,placeholderData:V,refetchOnWindowFocus:!1,retry:2})};var L;const ve=(L=w)==null?void 0:L.filter(e=>e.value!=="superAdmin"),S=[{key:"firstName",name:"firstName",fieldType:"Text",label:"First Name"},{key:"lastName",name:"lastName",fieldType:"Text",label:"Last Name"},{key:"userName",name:"userName",fieldType:"Text",label:"Username",disabled:{disableFieldForEdit:!0}},{key:"email",name:"email",fieldType:"Text",label:"Email",disabled:{disableFieldForEdit:!0}},{key:"role",name:"role",fieldType:"Select",label:"Role",meta:{options:ve},disabled:{disabledFieldForNew:!0,disableFieldForEdit:!0}},{key:"status",name:"status",fieldType:"Select",label:"Status",hidden:{hideFieldForNEW:!0},meta:{options:te}}],Te={merchant:[...S,{key:"merchantIds",name:"merchantIds",fieldType:"MerchantIDs",label:"Select Merchant ID(s)",meta:{conditionallyRender:!0}}],affiliate:[...S,{key:"affiliateId",name:"affiliateId",fieldType:"Text",label:"Affiliate ID"}],admin:[...S],staff:[...S],support:[...S,{key:"supportLevel",name:"supportLevel",fieldType:"Select",label:"Support Level",meta:{options:[{label:"L1",value:"L1"},{label:"L2",value:"L2"}]}}],driver:[...S,{key:"licenseNumber",name:"licenseNumber",fieldType:"Text",label:"Driver License Number"},{key:"vehicleType",name:"vehicleType",fieldType:"Select",label:"Vehicle Type",meta:{options:[{label:"Car",value:"car"},{label:"Bike",value:"bike"}]}}]},v=[{accessorKey:"firstName",header:"First Name",enableSorting:!0},{accessorKey:"lastName",header:"Last Name",enableSorting:!0},{accessorKey:"email",header:"Email",enableSorting:!1},{accessorKey:"userName",header:"UserName",enableSorting:!1},{accessorKey:"phone",header:"Phone",enableSorting:!1},{accessorKey:"lastLogin",header:"Last Login",enableSorting:!1,Cell:({cell:e})=>E(e.getValue())},{accessorKey:"lastActive",header:"Last Active",enableSorting:!1,Cell:({cell:e})=>E(e.getValue())},{accessorKey:"userId",header:"User ID",enableSorting:!1},{accessorKey:"activatedOn",header:"Activated On",enableSorting:!1,Cell:({cell:e})=>E(e.getValue())}],je={admin:[...v],affiliate:[...v,{accessorKey:"referralCode",header:"Referral Code",enableSorting:!1}],staff:[...v,{accessorKey:"department",header:"Department",enableSorting:!1}],support:[...v,{accessorKey:"ticketCount",header:"Ticket Count",enableSorting:!0}],driver:[...v,{accessorKey:"licenseNumber",header:"License Number",enableSorting:!1},{accessorKey:"vehicleType",header:"Vehicle Type",enableSorting:!1}],merchant:[...v,{accessorKey:"merchantIds",header:"Merchant IDs",enableSorting:!1,accessorFn:e=>{var s;return(s=e==null?void 0:e.merchantIds)==null?void 0:s.join(", ")}}]},Ce=({role:e})=>{var p,b,y;const[s,a]=o.useState([]),[r,c]=o.useState([]),[d,m]=o.useState({pageIndex:0,pageSize:50}),[n,{open:T,close:l}]=P(!1),{data:i,isError:g,isLoading:h}=Se({role:e,columnFilters:s,enableQuery:!n,sorting:r,pagination:d}),u=o.useMemo(()=>je[e],[e]);return t.jsx(ae,{children:t.jsx(o.Suspense,{fallback:t.jsx(W,{height:300,width:"100%"}),children:t.jsx(re,{data:((p=i==null?void 0:i.data)==null?void 0:p.users)??[],columnFilters:s,columns:u,pagination:d,sorting:r,totalRowCount:((b=i==null?void 0:i.data)==null?void 0:b.totalCount)??0,onColumnFiltersChange:a,onPaginationChange:m,onSortingChange:c,isLoading:h,OnFilterButtonClicked:T,OnApplyFiltersClicked:l,filterDrawerIsOpen:n,enableRowSelection:!0,isError:g,tableName:(y=ne)==null?void 0:y.UsersDisplay,crudOperationHeader:`${e.charAt(0).toUpperCase()+e.slice(1)} User`,columnPinning:{left:["mrt-row-select","mrt-row-actions","firstName"]},uniqueIDForRows:"userId",uiSchema:Te[e]})})})},D=({name:e,label:s,disabled:a,handleExternally:r=!1,onChange:c})=>{const{values:d,errors:m,touched:n,setFieldValue:T}=le(),l=I(d,e)??!1,i=I(m,e),g=I(n,e),h=o.useCallback((u,p)=>{if(r){c(p);return}T(u,p.currentTarget.checked)},[r,c]);return t.jsx(oe,{name:e,children:({field:u})=>t.jsx(z,{name:e,label:s,checked:l,disabled:a,error:g&&i?i:void 0,onChange:p=>h(e,p)})})},Ae=e=>{if(e)return U.GET(K.GET_ROLE_BASED_CONFIG_MENUS(e));throw new Error("Role or Token Unavailable")},ke=e=>M({queryKey:["roleBasedMenus",e],queryFn:()=>Ae(e),refetchOnWindowFocus:!1,enabled:!!e,retry:1,select:s=>{var a;return(a=s==null?void 0:s.data)==null?void 0:a.menu}}),Fe=()=>{};class $ extends o.PureComponent{constructor(...s){super(...s),this.i=!1,this.h=null,this.o=Fe,this.state={t:!0}}componentWillUnmount(){this.o()}u(s){s!==this.h&&(this.o(),this.h=null,s&&(this.h=s,this.o=s.on("updated",()=>this.setState({t:!this.state.t}))))}get allowed(){return this.i}l(){const s=this.props,a=s.of||s.a||s.an||s.this||s.on,r=s.not?"cannot":"can";return s.ability[r](s.I||s.do,a,s.field)}render(){return this.u(this.props.ability),this.i=this.l(),this.props.passThrough||this.i?this.p():null}p(){const{children:s,ability:a}=this.props;return typeof s=="function"?s(this.i,a):s}}const Ee=o.createContext(void 0),Ie=()=>{const e=o.useContext(Ee);if(!e)throw new Error("useAppAbility must be used within an AbilityProvider");return e};async function Ne({role:e,menus:s}){const a=K.EDIT_ROLE_BASED_CONFIG_MENUS();return U.PUT(a,{role:e,menus:s})}const Re=()=>{const e=H();return Q({mutationFn:({role:s,menus:a})=>Ne({role:s,menus:a}),onSuccess:s=>{var a,r;X.show({title:"Success",message:"Role-based menu configuration updated successfully",color:"green",autoClose:2e3,position:"top-center"}),e.invalidateQueries({queryKey:["roleBasedMenus",(r=(a=s==null?void 0:s.data)==null?void 0:a.menu)==null?void 0:r.role]})},onError:s=>{J.isAxiosError(s)?ie(s):console.error("Non-Axios error:",s)}})},Ue=()=>{const[e,s]=o.useState(null),{data:a,isLoading:r}=ke(e),{mutateAsync:c,isPending:d}=Re(),m=o.useCallback(l=>{c(l)},[]),{ability:n}=Ie(),T=o.useMemo(()=>{var l;return(l=w)==null?void 0:l.filter(i=>(i==null?void 0:i.value)!=="superAdmin")},[]);return t.jsx(N,{children:t.jsxs($,{I:"view",a:"RoleBasedConfiguration",ability:n,children:[t.jsxs(F,{children:[t.jsx(ue,{order:4,mb:"md",children:"Role-Based Menu Settings"}),t.jsx(he,{value:e,onChange:s,data:T,placeholder:"Choose Role",mb:"md"})]}),t.jsx(R,{my:"md"}),t.jsxs(Y,{shadow:"md",p:"md",radius:"md",children:[t.jsx(pe,{visible:r||d}),!e&&t.jsx(O,{children:"Select the role to configure the menu settings for that role."}),!r&&a&&t.jsx(ce,{initialValues:a,enableReinitialize:!0,onSubmit:l=>m(l),children:({values:l,setFieldValue:i})=>{var g;return t.jsxs(de,{children:[t.jsx(f.ScrollContainer,{minWidth:100,type:"native",mah:430,p:0,children:t.jsxs(f,{withTableBorder:!0,withColumnBorders:!0,stickyHeaderOffset:0,stickyHeader:!0,children:[t.jsx(f.Thead,{children:t.jsxs(f.Tr,{children:[t.jsx(f.Th,{style:{width:"25%"},children:"Main Menu"}),t.jsx(f.Th,{children:"Submenus"})]})}),t.jsx(f.Tbody,{children:(g=a==null?void 0:a.menus)==null?void 0:g.map((h,u)=>{var p;return t.jsxs(f.Tr,{children:[t.jsx(f.Td,{children:t.jsx(D,{name:`menus[${u}].isActive`,label:h.label,handleExternally:!0,onChange:async b=>{var j;const y=b.target.checked;i(`menus[${u}].isActive`,y);const k=(j=h.submenu)==null?void 0:j.map(x=>({...x,isActive:y}));i(`menus[${u}].submenu`,k)}})}),t.jsx(f.Td,{children:t.jsx(F,{gap:"lg",children:(p=h==null?void 0:h.submenu)==null?void 0:p.map((b,y)=>t.jsx(N,{w:"200px",children:t.jsx(D,{name:`menus[${u}].submenu[${y}].isActive`,label:b.label,handleExternally:!0,onChange:k=>{var B;const j=k.target.checked,x=(B=l==null?void 0:l.menus[u].submenu)==null?void 0:B.map((C,_)=>_===y?{...C,isActive:j}:C);i(`menus[${u}].submenu`,x);const G=x==null?void 0:x.some(C=>C.isActive);i(`menus[${u}].isActive`,G)}},`${h.label}_${b.label}`)},b.label))})})]},h.label+"index")})})]})}),t.jsx(R,{}),t.jsx(Z,{children:t.jsxs(F,{mt:"md",children:[t.jsx(A,{type:"submit",children:"Submit"}),t.jsx(A,{variant:"outline",type:"reset",children:"Reset"})]})})]})}})]})]})})},Qe=()=>{var d,m;const{ability:e}=ee(),[s,{open:a,close:r}]=P(!1),c=(m=(d=w)==null?void 0:d.filter(n=>n.value!=="superAdmin"&&e.can("access",`${n==null?void 0:n.value}UserTab`)))==null?void 0:m.map(n=>({label:n.label,value:n.value,hidden:!e.can("access",`${n.value}UserTab`),content:t.jsx(Ce,{role:n==null?void 0:n.value})}));return t.jsxs(N,{children:[t.jsxs($,{I:"view",a:"RoleBasedConfiguration",ability:e,children:[t.jsxs(me,{justify:"space-between",align:"center",w:"100%",styles:{root:{border:"1px solid lightgrey",padding:"10px 20px",borderRadius:"1rem",background:"#f3f3f3",marginBottom:"1.5rem"}},children:[s&&t.jsx(A,{onClick:()=>r(),size:"sm",leftSection:t.jsx(fe,{}),variant:"gradient",children:"Go Back"}),!s&&t.jsxs(t.Fragment,{children:[t.jsx(O,{style:{fontWeight:500},children:"Roles and Permissions : "}),t.jsx(A,{variant:"gradient",onClick:()=>a(),children:"Access & Permissions"})]})]}),t.jsx(R,{m:10})]}),s?t.jsx(Ue,{}):t.jsx(se,{tabs:c})]})};export{Qe as default};
