import{a9 as Te,u as A,c as $,j as n,B as G,f as V,g as ee,h as N,aa as fe,s as ge,ab as Fe,r as j,b as xe,e as Ye,a as Ee,v as Ve,z as Ge,S as E,M as be,Q as Le,L as Oe,N as Re,X as $e,G as Z,l as qe,D as ie,F as ce,V as We,P as Ke,k as de}from"./index-cq5hzz0D.js";import{A as Be}from"./AppTabs-B1VXN0KH.js";import{I as He,b as Ue,d as Qe,e as Xe,a as Ze,D as Je,f as et,g as tt}from"./MUIThemeProvider-xnG46D3_.js";import{u as st,A as ye,a as Ie}from"./ApiConstants-Dtw084aJ.js";import{a as at,I as nt}from"./InvoiceParameters-Ix-mIXSU.js";import{i as Se,j as rt,I as ot,a as De,u as lt,e as Ce,k as it,c as ct,g as ue,b as dt,F as ut,h as ht}from"./index.esm-CPFEyeFY.js";import{I as pt}from"./IconX-cYJJk0kL.js";import{s as je,b as ke,d as mt,e as Pe,f as ve,p as ft,h as gt,i as _,C as xt,u as bt,A as yt,L as It}from"./DateTimePicker-CaOj6elI.js";import{T as J}from"./Text-0PoO59Pb.js";import{A as St}from"./AppChipComponent-BKSe92h4.js";import{T as Y,S as he}from"./IconTrash-DB5oEuoR.js";import{C as Dt}from"./Container-DdN2Uh0P.js";import{T as Ct}from"./Title-bxlz7w_Z.js";import"./Alert-oIgGFfnb.js";import"./helperFuntions-lPcVCZQ3.js";var we={root:"m_4451eb3a"};const jt={},te=Te((e,t)=>{const s=A("Center",jt,e),{classNames:a,className:o,style:r,styles:d,unstyled:u,vars:b,inline:i,mod:f,...y}=s,m=$({name:"Center",props:s,classes:we,className:o,style:r,classNames:a,styles:d,unstyled:u,vars:b});return n.jsx(G,{ref:t,mod:[{inline:i},f],...m("root"),...y})});te.classes=we;te.displayName="@mantine/core/Center";const[kt,se]=Se(),[Pt,vt]=Se();var B={root:"m_7cda1cd6","root--default":"m_44da308b","root--contrast":"m_e3a01f8",label:"m_1e0e6180",remove:"m_ae386778",group:"m_1dcfd90b"};const wt={},Mt=ee((e,{gap:t},{size:s})=>({group:{"--pg-gap":t!==void 0?N(t):N(s,"pg-gap")}})),ae=V((e,t)=>{const s=A("PillGroup",wt,e),{classNames:a,className:o,style:r,styles:d,unstyled:u,vars:b,size:i,disabled:f,...y}=s,m=se(),c=(m==null?void 0:m.size)||i||void 0,g=$({name:"PillGroup",classes:B,props:s,className:o,style:r,classNames:a,styles:d,unstyled:u,vars:b,varsResolver:Mt,stylesCtx:{size:c},rootSelector:"group"});return n.jsx(Pt,{value:{size:c,disabled:f},children:n.jsx(G,{ref:t,size:c,...g("group"),...y})})});ae.classes=B;ae.displayName="@mantine/core/PillGroup";const _t={variant:"default"},Nt=ee((e,{radius:t},{size:s})=>({root:{"--pill-fz":N(s,"pill-fz"),"--pill-height":N(s,"pill-height"),"--pill-radius":t===void 0?void 0:ge(t)}})),R=V((e,t)=>{const s=A("Pill",_t,e),{classNames:a,className:o,style:r,styles:d,unstyled:u,vars:b,variant:i,children:f,withRemoveButton:y,onRemove:m,removeButtonProps:c,radius:g,size:I,disabled:S,mod:k,...l}=s,h=vt(),D=se(),C=I||(h==null?void 0:h.size)||void 0,v=(D==null?void 0:D.variant)==="filled"?"contrast":i||"default",P=$({name:"Pill",classes:B,props:s,className:o,style:r,classNames:a,styles:d,unstyled:u,vars:b,varsResolver:Nt,stylesCtx:{size:C}});return n.jsxs(G,{component:"span",ref:t,variant:v,size:C,...P("root",{variant:v}),mod:[{"with-remove":y&&!S,disabled:S||(h==null?void 0:h.disabled)},k],...l,children:[n.jsx("span",{...P("label"),children:f}),y&&n.jsx(fe,{variant:"transparent",radius:g,tabIndex:-1,"aria-hidden":!0,unstyled:u,...c,...P("remove",{className:c==null?void 0:c.className,style:c==null?void 0:c.style}),onMouseDown:p=>{var x;p.preventDefault(),p.stopPropagation(),(x=c==null?void 0:c.onMouseDown)==null||x.call(c,p)},onClick:p=>{var x;p.stopPropagation(),m==null||m(),(x=c==null?void 0:c.onClick)==null||x.call(c,p)}})]})});R.classes=B;R.displayName="@mantine/core/Pill";R.Group=ae;var Me={field:"m_45c4369d"};const At={type:"visible"},ne=V((e,t)=>{const s=A("PillsInputField",At,e),{classNames:a,className:o,style:r,styles:d,unstyled:u,vars:b,type:i,disabled:f,id:y,pointer:m,mod:c,...g}=s,I=se(),S=rt(),k=$({name:"PillsInputField",classes:Me,props:s,className:o,style:r,classNames:a,styles:d,unstyled:u,rootSelector:"field"}),l=f||(I==null?void 0:I.disabled);return n.jsx(G,{component:"input",ref:Fe(t,I==null?void 0:I.fieldRef),"data-type":i,disabled:l,mod:[{disabled:l,pointer:m},c],...k("field"),...g,id:(S==null?void 0:S.inputId)||y,"aria-invalid":I==null?void 0:I.hasError,"aria-describedby":S==null?void 0:S.describedBy,type:"text",onMouseDown:h=>!m&&h.stopPropagation()})});ne.classes=Me;ne.displayName="@mantine/core/PillsInputField";const zt={},K=V((e,t)=>{const s=A("PillsInput",zt,e),{children:a,onMouseDown:o,onClick:r,size:d,disabled:u,__staticSelector:b,error:i,variant:f,...y}=s,m=j.useRef();return n.jsx(kt,{value:{fieldRef:m,size:d,disabled:u,hasError:!!i,variant:f},children:n.jsx(ot,{size:d,error:i,variant:f,component:"div",ref:t,onMouseDown:c=>{var g;c.preventDefault(),o==null||o(c),(g=m.current)==null||g.focus()},onClick:c=>{var g;c.preventDefault(),r==null||r(c),(g=m.current)==null||g.focus()},...y,multiline:!0,disabled:u,__staticSelector:b||"PillsInput",withAria:!1,children:a})})});K.displayName="@mantine/core/PillsInput";K.Field=ne;const _e=j.createContext(null),Tt=_e.Provider,Ft=()=>j.useContext(_e),Yt={},re=V((e,t)=>{const{value:s,defaultValue:a,onChange:o,size:r,wrapperProps:d,children:u,readOnly:b,...i}=A("SwitchGroup",Yt,e),[f,y]=xe({value:s,defaultValue:a,finalValue:[],onChange:o}),m=c=>{const g=c.currentTarget.value;!b&&y(f.includes(g)?f.filter(I=>I!==g):[...f,g])};return n.jsx(Tt,{value:{value:f,onChange:m,size:r},children:n.jsx(De.Wrapper,{size:r,ref:t,...d,...i,labelElement:"div",__staticSelector:"SwitchGroup",children:n.jsx(He,{role:"group",children:u})})})});re.classes=De.Wrapper.classes;re.displayName="@mantine/core/SwitchGroup";var Ne={root:"m_5f93f3bb",input:"m_926b4011",track:"m_9307d992",thumb:"m_93039a1d",trackLabel:"m_8277e082"};const Et={labelPosition:"right"},Vt=ee((e,{radius:t,color:s,size:a})=>({root:{"--switch-radius":t===void 0?void 0:ge(t),"--switch-height":N(a,"switch-height"),"--switch-width":N(a,"switch-width"),"--switch-thumb-size":N(a,"switch-thumb-size"),"--switch-label-font-size":N(a,"switch-label-font-size"),"--switch-track-label-padding":N(a,"switch-track-label-padding"),"--switch-color":s?Ve(s,e):void 0}})),H=V((e,t)=>{const s=A("Switch",Et,e),{classNames:a,className:o,style:r,styles:d,unstyled:u,vars:b,color:i,label:f,offLabel:y,onLabel:m,id:c,size:g,radius:I,wrapperProps:S,thumbIcon:k,checked:l,defaultChecked:h,onChange:D,labelPosition:C,description:v,error:P,disabled:p,variant:x,rootRef:w,mod:L,...z}=s,M=Ft(),U=g||(M==null?void 0:M.size),T=$({name:"Switch",props:s,classes:Ne,className:o,style:r,classNames:a,styles:d,unstyled:u,vars:b,varsResolver:Vt}),{styleProps:Q,rest:q}=Ye(z),W=Ee(c),F=M?{checked:M.value.includes(q.value),onChange:M.onChange}:{},[O,ze]=xe({value:F.checked??l,defaultValue:h,finalValue:!1});return n.jsxs(Ue,{...T("root"),__staticSelector:"Switch",__stylesApiProps:s,id:W,size:U,labelPosition:C,label:f,description:v,error:P,disabled:p,bodyElement:"label",labelElement:"span",classNames:a,styles:d,unstyled:u,"data-checked":F.checked||void 0,variant:x,ref:w,mod:L,...Q,...S,children:[n.jsx("input",{...q,disabled:p,checked:O,onChange:X=>{var le;M?(le=F.onChange)==null||le.call(F,X):D==null||D(X),ze(X.currentTarget.checked)},id:W,ref:t,type:"checkbox",role:"switch",...T("input")}),n.jsxs(G,{"aria-hidden":"true",mod:{error:P,"label-position":C,"without-labels":!m&&!y},...T("track"),children:[n.jsx(G,{component:"span",mod:"reduce-motion",...T("thumb"),children:k}),n.jsx("span",{...T("trackLabel"),children:O?m:y})]})]})});H.classes={...Ne,...Qe};H.displayName="@mantine/core/Switch";H.Group=re;/**
 * @license @tabler/icons-react v3.21.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Ae=Ge("outline","check","IconCheck",[["path",{d:"M5 12l5 5l10 -10",key:"svg-0"}]]);function Gt({type:e,date:t,locale:s,format:a,labelSeparator:o}){const r=d=>E(d).locale(s).format(a);return e==="default"?t===null?"":r(t):e==="multiple"?t.map(r).join(", "):e==="range"&&Array.isArray(t)?t[0]&&t[1]?`${r(t[0])} ${o} ${r(t[1])}`:t[0]?`${r(t[0])} ${o} `:"":""}function Lt({formatter:e,...t}){return(e||Gt)(t)}function Ot({minDate:e,maxDate:t,timezone:s}){const a=je("add",new Date,s);return!e&&!t?a:e&&E(a).isBefore(e)?e:t&&E(a).isAfter(t)?t:a}function Rt({type:e,value:t,defaultValue:s,onChange:a,locale:o,format:r,closeOnChange:d,sortDates:u,labelSeparator:b,valueFormatter:i}){const f=ke(),[y,m]=be(!1),[c,g]=mt({type:e,value:t,defaultValue:s,onChange:a}),I=Lt({type:e,date:c,locale:f.getLocale(o),format:r,labelSeparator:f.getLabelSeparator(b),formatter:i}),S=h=>{d&&(e==="default"&&m.close(),e==="range"&&h[0]&&h[1]&&m.close()),g(u&&e==="multiple"?[...h].sort((D,C)=>D.getTime()-C.getTime()):h)},k=()=>S(e==="range"?[null,null]:e==="multiple"?[]:null),l=e==="range"?!!c[0]:e==="multiple"?c.length>0:c!==null;return{_value:c,setValue:S,onClear:k,shouldClear:l,formattedValue:I,dropdownOpened:y,dropdownHandlers:m}}const $t={type:"default",valueFormat:"MMMM D, YYYY",closeOnChange:!0,sortDates:!0,dropdownType:"popover"},oe=V((e,t)=>{const s=A("DatePickerInput",$t,e),{type:a,value:o,defaultValue:r,onChange:d,valueFormat:u,labelSeparator:b,locale:i,classNames:f,styles:y,unstyled:m,closeOnChange:c,size:g,variant:I,dropdownType:S,sortDates:k,minDate:l,maxDate:h,vars:D,defaultDate:C,valueFormatter:v,...P}=s,{resolvedClassNames:p,resolvedStyles:x}=lt({classNames:f,styles:y,props:s}),{calendarProps:w,others:L}=ft(P),{_value:z,setValue:M,formattedValue:U,dropdownHandlers:T,dropdownOpened:Q,onClear:q,shouldClear:W}=Rt({type:a,value:o,defaultValue:r,onChange:d,locale:i,format:u,labelSeparator:b,closeOnChange:c,sortDates:k,valueFormatter:v}),F=Array.isArray(z)?z[0]||C:z||C,O=ke();return n.jsx(Pe,{formattedValue:U,dropdownOpened:Q,dropdownHandlers:T,classNames:p,styles:x,unstyled:m,ref:t,onClear:q,shouldClear:W,value:z,size:g,variant:I,dropdownType:S,...L,type:a,__staticSelector:"DatePickerInput",children:n.jsx(ve,{...w,size:g,variant:I,type:a,value:z,defaultDate:F||Ot({maxDate:h,minDate:l,timezone:O.getTimezone()}),onChange:M,locale:i,classNames:p,styles:x,unstyled:m,__staticSelector:"DatePickerInput",__stopPropagation:S==="popover",minDate:l,maxDate:h,date:je("add",w.date,O.getTimezone()),__timezoneApplied:!0})})});oe.classes={...Pe.classes,...ve.classes};oe.displayName="@mantine/dates/DatePickerInput";const qt=e=>{var a;let t={};const s=["fromDate","toDate","createdAt"];return(a=e==null?void 0:e.filter(o=>!(s!=null&&s.includes(o.id))))==null||a.forEach(o=>{var r;Array.isArray(o.value)?t[o.id]=(r=o.value)==null?void 0:r.join(","):o.id==="merchantId"?t.merchantIds=o.value:t[o.id]=o.value}),t},Wt=e=>{var o,r;let t="";const s=(o=e==null?void 0:e[0])==null?void 0:o.id,a=(r=e==null?void 0:e[0])==null?void 0:r.desc;if(s==="createdAt"&&!a?t="asc":s==="createdAt"&&a&&(t="desc"),t)return{sort:t}};function pe(e){return E(e,"DD MMM YYYY").format("YYYY-MM-DDTHH:mm:ss.SSS[Z]")}const Kt=e=>{let t="",s="";const a=e==null?void 0:e.find(r=>r.id==="fromDate"),o=e==null?void 0:e.find(r=>r.id==="toDate");if(a&&(t=a!=null&&a.value?pe(a==null?void 0:a.value):""),o&&(s=o!=null&&o.value?pe(o==null?void 0:o.value):""),a&&s)return{startDate:t,endDate:s};if(o)return{endDate:s};if(a)return{startDate:t}};function Bt(e,t,s){const a={pageNo:s.pageIndex+1,limit:s.pageSize,...Wt(t),...qt(e),...Kt(e)};return ye.GET(Ie.GET_ALL_INVOICES_DETAILS(),{params:a})}const Ht=e=>{const{columnFilters:t,EnableQuery:s,sorting:a,pagination:o}=e,[r,d]=j.useState([]);return j.useEffect(()=>{s&&d(t)},[t,s]),st({queryKey:["All_Invoices-Grid-data",r,a,o],queryFn:()=>Bt(r,a,o),placeholderData:Le,refetchOnMount:!1,refetchOnWindowFocus:!1,retry:2})},Ut=()=>{var S,k;const[e,t]=j.useState([]),[s,a]=j.useState([]),[o,r]=j.useState({pageIndex:0,pageSize:10}),[d,{open:u,close:b}]=be(!1),{data:i,isError:f,isLoading:y}=Ht({columnFilters:e,EnableQuery:!d,sorting:s,pagination:o}),{mutateAsync:m,isPending:c,variables:g}=at(),I=j.useMemo(()=>[{accessorKey:"merchantId",header:"Merchant ID",enableColumnFilter:!0,enableSorting:!1,maxSize:100,Cell:({row:l})=>{var h,D;return`${((h=l==null?void 0:l.original)==null?void 0:h.merchantName)??""} (${(D=l==null?void 0:l.original)==null?void 0:D.merchantId})`}},{accessorKey:"invoiceParameters.bankTransfer",header:"To be paid",enableSorting:!1,enableColumnFilter:!1},{accessorKey:"createdAt",header:"Created At",accessorFn:l=>new Date(l==null?void 0:l.createdAt),Cell:({cell:l})=>{const h=l.getValue();return E(h).format("DD MMM YYYY")},enableColumnFilter:!1,maxSize:150},{accessorKey:"fromDate",header:"From Date",accessorFn:l=>new Date(l==null?void 0:l.fromDate),enableSorting:!1,filterVariant:"date",muiFilterDatePickerProps:{label:"From Date",format:"DD MMM YYYY"},Cell:({cell:l})=>{const h=l.getValue();return E(h).format("DD MMM YYYY")},maxSize:150},{accessorKey:"toDate",header:"To Date",maxSize:150,enableSorting:!1,accessorFn:l=>new Date(l==null?void 0:l.toDate),Cell:({cell:l})=>{const h=l.getValue();return E(h).format("DD MMM YYYY")},filterVariant:"date",muiFilterDatePickerProps:{label:"To Date",format:"DD MMM YYYY"}},{accessorKey:"invoiceId",header:"Invoice ID",enableSorting:!1},{accessorKey:"status",header:"Status",maxSize:100,Cell:({cell:l,row:h})=>{var D;if(l.getValue())return n.jsx(te,{children:c&&((D=g==null?void 0:g.updates)==null?void 0:D.invoiceId)===h.original.invoiceId?n.jsx(Oe,{size:"sm"}):n.jsx(H,{size:"lg",checked:l.getValue()==="PAID",onLabel:"PAID",offLabel:"UNPAID",thumbIcon:l.getValue()==="PAID"?n.jsx(Ae,{size:12,color:"var(--mantine-color-teal-6)",stroke:3}):n.jsx(pt,{size:12,color:"var(--mantine-color-red-6)",stroke:3}),styles:{trackLabel:{width:"40px",fontSize:"xl"}},onChange:C=>{m({updates:{...h==null?void 0:h.original,status:C.currentTarget.checked?"PAID":"UNPAID"}})}})})},enableColumnFilter:!0,filterVariant:"autocomplete",filterSelectOptions:[{value:"PAID",label:"PAID"},{value:"UNPAID",label:"UNPAID"}],enableSorting:!1},{accessorKey:"isSentToMerchant",header:"Sent",Cell:({cell:l})=>n.jsx(Xe,{children:l.getValue()?"Yes":"No"}),enableSorting:!1,enableColumnFilter:!0,filterVariant:"autocomplete",maxSize:100,filterSelectOptions:[{value:!0,label:"YES"},{value:!1,label:"No"}]},{accessorKey:"downloadLink",header:"View Invoice",enableSorting:!1,enableColumnFilter:!1,maxSize:100,Cell:({cell:l})=>{const h=l.getValue();return h?n.jsx("a",{href:`${h}`,target:"_blank",download:`${h}`,children:n.jsx(Re,{color:"green",cursor:"pointer"})}):"Not Available"}}],[c]);return n.jsx(Ze,{children:n.jsx(j.Suspense,{fallback:n.jsx($e,{height:300,width:"100%"}),children:n.jsx(Je,{data:((S=i==null?void 0:i.data)==null?void 0:S.invoices)??[],columnFilters:e,columns:I,pagination:o,sorting:s,totalRowCount:((k=i==null?void 0:i.data)==null?void 0:k.totalCount)??0,onColumnFiltersChange:t,onPaginationChange:r,onSortingChange:a,isLoading:y,OnFilterButtonClicked:()=>u(),OnApplyFiltersClicked:()=>b(),filterDrawerIsOpen:d,enableRowSelection:!0,isError:f,tableName:"AllInvoicesDisplay",crudOperationHeader:"Invoices",columnPinning:{left:["mrt-row-select"]},uniqueIDForRows:"invoiceId",enableRowActions:!1,muiExpandButtonProps:({row:l,table:h})=>({onClick:()=>h.setExpanded({[l.id]:!l.getIsExpanded()}),sx:{transform:l.getIsExpanded()?"rotate(180deg)":"rotate(-90deg)",transition:"transform 0.2s"}}),renderDetailPanel:({row:l})=>{var h;return(h=l.original)!=null&&h.invoiceParameters?n.jsx(nt,{row:l}):void 0}})})})},Qt=({name:e,label:t,disabled:s})=>{const{values:a,errors:o,touched:r,setFieldValue:d}=Ce(),u={touched:r[e],error:o[e]},b=a[e],i=u.touched&&u.error&&typeof u.error=="string"?u.error:void 0;return n.jsx(it,{name:e,children:({field:f})=>n.jsx("div",{children:n.jsx(oe,{...f,type:"range",label:t,value:b,onChange:y=>d(e,y),disabled:s,error:i,placeholder:"Pick dates range",valueFormat:"DD MMM YYYY",maxDate:new Date})})})};function Xt(e){var D,C,v,P;const{name:t}=e,s=gt({onDropdownClose:()=>s.resetSelectedOption(),onDropdownOpen:()=>s.updateSelectedOptionIndex("active")}),[a,o]=j.useState(""),{data:r,isLoading:d,isError:u,isFetching:b}=et(a,s.dropdownOpened,1,100),{values:i,setFieldValue:f,errors:y,touched:m}=Ce(),c={touched:m[t],error:y[t]},g=p=>{const x=i==null?void 0:i[t],w=x?x!=null&&x.includes(p)?x==null?void 0:x.filter(L=>L!==p):[...x,p]:[p];f(t,w),o("")},I=p=>f(t,i==null?void 0:i[t].filter(x=>x!==p)),S=j.useCallback(()=>{f(t,[])},[]),k=(D=i==null?void 0:i[t])==null?void 0:D.map(p=>n.jsx(R,{withRemoveButton:!0,onRemove:()=>I(p),styles:{root:{backgroundColor:"#12b886",color:"white",fontWeight:"normal"}},children:p},p)),l=(v=(C=r==null?void 0:r.data)==null?void 0:C.merchants)==null?void 0:v.map(p=>{var w;const x=p.merchantName+" ("+p.merchantId.toString()+")";return n.jsx(_.Option,{value:x,children:n.jsxs(Z,{gap:"sm",children:[(w=i==null?void 0:i[t])!=null&&w.includes(x)?n.jsx(xt,{size:12}):null,n.jsx("span",{children:x})]})},x)}),h=j.useMemo(()=>{var p;return d||b?"Loading Merchants...":u?"No Merchants Found":(p=r==null?void 0:r.data)!=null&&p.totalCount&&r.data.totalCount>100?"More than 100 Merchants found, Please refine your search":null},[d,b,u,r]);return n.jsxs(_,{store:s,onOptionSubmit:g,children:[n.jsx(_.Header,{styles:{header:{borderBottom:0,paddingBottom:0}},children:n.jsx(J,{size:"sm",fw:500,children:"Select Merchants"})}),n.jsx(_.DropdownTarget,{children:n.jsx(K,{onClick:()=>s.openDropdown(),size:"md",rightSection:((P=i==null?void 0:i[t])==null?void 0:P.length)!==0&&n.jsx(fe,{size:"sm",onMouseDown:p=>p.preventDefault(),onClick:()=>{S()},"aria-label":"Clear value"}),children:n.jsxs(R.Group,{children:[k,n.jsx(_.EventsTarget,{children:n.jsx(K.Field,{onFocus:()=>s.openDropdown(),onBlur:()=>s.closeDropdown(),value:a,placeholder:"Search Merchants",onChange:p=>{s.updateSelectedOptionIndex(),o(p.currentTarget.value)},onKeyDown:p=>{var x;p.key==="Backspace"&&a.length===0&&(p.preventDefault(),I(i==null?void 0:i[t][((x=i==null?void 0:i[t])==null?void 0:x.length)-1]))}})})]})})}),n.jsx(_.Dropdown,{children:n.jsx(_.Options,{mah:300,style:{overflowY:"auto"},children:l&&l.length>0?l:n.jsx(_.Empty,{children:h})})}),c.error&&typeof c.error=="string"&&n.jsx(_.Footer,{styles:{footer:{borderTop:0}},children:n.jsx(J,{c:"red",size:"xs",children:c.error})})]})}const Zt=async e=>{if(!e.merchantIds||e.lastWeek===null)throw new Error("Missing required fields");if(!e.lastWeek&&(!e.startDate||!e.endDate))throw new Error("Start date and End date are required when 'lastWeek' is false");return ye.POST(Ie.GENERATE_INVOICE_BY_MERCHANTID_AND_DATE_RANGE(),e)},Jt=()=>{const e=qe();return bt({mutationFn:async t=>await Zt(t),onSuccess:t=>{var s,a;(a=(s=t==null?void 0:t.data)==null?void 0:s.invoices)!=null&&a.some(o=>o.status==="success")&&e.invalidateQueries({queryKey:["All_Invoices-Grid-data"]})},onError:t=>{var s,a;t instanceof yt?ie.show({title:((a=(s=t==null?void 0:t.response)==null?void 0:s.data)==null?void 0:a.message)??"Request Failed",message:"There was an error processing the invoice request.",color:"red",autoClose:5e3}):ie.show({title:"Invoice Creation Failed",message:"Something went wrong.",color:"red",autoClose:5e3})}})};function es({data:e,headers:t,columnsMapping:s,uniqueKeyInRows:a}){const o=e==null?void 0:e.map((r,d)=>n.jsx(Y.Tr,{children:t.map(u=>n.jsx(Y.Td,{styles:{td:{textAlign:"center"}},children:u==="Status"?n.jsx(St,{value:r[s[u]]??""}):n.jsx(J,{children:r[s[u]]??""})},u))},a&&a in r?r[a]:d));return n.jsxs(Y,{verticalSpacing:"sm",stickyHeader:!0,children:[n.jsx(Y.Thead,{children:n.jsx(Y.Tr,{children:t.map(r=>n.jsx(Y.Th,{styles:{th:{textAlign:"center"}},children:r},r))})}),n.jsx(Y.Tbody,{children:o})]})}const ts=ct({merchantIds:ue().of(dt().required("Merchant ID is required")).min(1,"At least one Merchant ID must be selected").required("Merchant IDs are required"),dateRange:ue().min(2,"Date Range is Required").max(2,"Date Range is Required").when("isLastWeek",{is:!0,then:e=>e.nullable("Should be Null"),otherwise:e=>e.required("required").nonNullable("Should not be Null ")})});function me(e){var t;return(t=e.map(s=>{const a=RegExp(/\((\d+)\)/).exec(s);return a?a[1]:null}).filter(s=>s!==null))==null?void 0:t.join(",")}const ss=e=>e!=null&&e.isLastWeek?{merchantIds:me(e==null?void 0:e.merchantIds),lastWeek:e==null?void 0:e.isLastWeek}:{merchantIds:me(e==null?void 0:e.merchantIds),lastWeek:e==null?void 0:e.isLastWeek,startDate:e!=null&&e.dateRange[0]?e==null?void 0:e.dateRange[0]:null,endDate:e!=null&&e.dateRange[1]?e==null?void 0:e.dateRange[1]:null},as={"Merchant ID":"merchantId",Message:"message",Status:"status"},ns=()=>{const{mutate:e,isPending:t,isSuccess:s,data:a}=Jt(),o=j.useRef(null);j.useEffect(()=>{var d,u;return s&&(a!=null&&a.data)&&ce.open({title:n.jsx(We,{icon:n.jsx(Ae,{}),color:"teal",title:((d=a==null?void 0:a.data)==null?void 0:d.message)??"Details",mt:"md",withCloseButton:!1,styles:{root:{boxShadow:"none"}}}),children:n.jsx(es,{data:(u=a==null?void 0:a.data)==null?void 0:u.invoices,headers:["Merchant ID","Message","Status"],columnsMapping:as,uniqueKeyInRows:"merchantId"}),size:"lg"}),()=>{ce.closeAll()}},[s]);const r=d=>{e(ss(d))};return n.jsx(Dt,{size:"sm",mt:30,children:n.jsxs(Ke,{p:"xl",shadow:"sm",withBorder:!0,pos:"relative",children:[n.jsx(Ct,{order:5,ta:"center",mb:20,c:"grey",children:"Select Merchant Id and Date Range to generate Invoice"}),n.jsx(ut,{initialValues:{merchantIds:[],isLastWeek:!1,dateRange:[]},validationSchema:ts,onSubmit:d=>{r(d)},innerRef:o,children:({setFieldValue:d,values:u})=>n.jsx(ht,{children:n.jsxs(he,{children:[n.jsx(he,{gap:"xs",children:n.jsx(Xt,{name:"merchantIds"})}),n.jsxs(Z,{gap:"lg",grow:!0,align:"flex-start",children:[n.jsx(Qt,{name:"dateRange",label:"Select Date Range",disabled:u==null?void 0:u.isLastWeek}),n.jsx(tt,{name:"isLastWeek",label:"Last Week",OnChangeHandler:b=>{d("isLastWeek",b.target.checked),b.target.checked&&d("dateRange",[null,null])}})]}),n.jsxs(Z,{grow:!0,gap:"md",mt:20,children:[n.jsx(de,{type:"submit",disabled:t,loading:t,children:"Submit"}),n.jsx(de,{type:"reset",variant:"outline",children:"Reset"})]})]})})}),n.jsx(It,{visible:t,zIndex:1e3,overlayProps:{radius:"sm",blur:2}})]})})};function Is(){const e=[{label:"Generate Invoices",value:"Generate_Invoices",content:n.jsx(ns,{})},{label:"View Invoices",value:"View_Invoices",content:n.jsx(Ut,{})}];return n.jsx(Be,{tabs:e})}export{Is as default};
