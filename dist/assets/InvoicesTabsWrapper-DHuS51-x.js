import{H as v,K as T,o as De,g as Ie,v as ge,j as o,r as f,E as H,F as U,A as Y,b as F,m as Q,L as Z,a9 as X,aa as V,ab as J,a6 as xe,d as R,R as Se,a as be,f as ye,n as O,T as Ce,M as $,N as Pe,C as je,P as ke,G as K,e as q,ac as Ae}from"./index-BLIlmA3H.js";import{A as Me}from"./AppTabs-C-8ZgSK-.js";import{s as w,e as ee,f as ve,p as Te,P as te,g as ae,h as re,a as ne,D as se,T as oe,i as j,j as Ye,F as Fe,k as Ve}from"./MUIThemeProvider-C19IRQrA.js";import{a as Ee,I as Ne}from"./InvoiceParameters-D92NvBtj.js";import{a as k,i as ze}from"./helperFuntions-DGUG679L.js";import{I as ie}from"./useUpdateUser-w8Owpn5w.js";import{e as _e,f as Le,F as Oe,c as $e,a as Ke,h as G,b as qe}from"./index.esm-DfjObHCA.js";import{A as Ge}from"./AppChipComponent-g1lGA8RZ.js";import{T as We}from"./Title-DKWiMa_B.js";import{S as Be}from"./Stack-C0tO9y16.js";import{L as He}from"./LoadingOverlay-C_GBlKZb.js";import"./Tabs-Dn3yYXdp.js";import"./Select-BzWorYtb.js";import"./InputBase-DX49xYkW.js";import"./index-BK5A5XBL.js";import"./FormikInputField-B2PJ7d2X.js";import"./TextInput-HlJqnerf.js";import"./Alert-D3dw1Im4.js";import"./List-C2rtPsw9.js";function Ue({type:e,date:t,locale:n,format:a,labelSeparator:r}){const l=c=>v(c).locale(n).format(a);return e==="default"?t===null?"":l(t):e==="multiple"?t.map(l).join(", "):e==="range"&&Array.isArray(t)?t[0]&&t[1]?`${l(t[0])} ${r} ${l(t[1])}`:t[0]?`${l(t[0])} ${r} `:"":""}function Qe({formatter:e,...t}){return(e||Ue)(t)}function Ze({minDate:e,maxDate:t,timezone:n}){const a=w("add",new Date,n);return!e&&!t?a:e&&v(a).isBefore(e)?e:t&&v(a).isAfter(t)?t:a}function Xe({type:e,value:t,defaultValue:n,onChange:a,locale:r,format:l,closeOnChange:c,sortDates:u,labelSeparator:p,valueFormatter:m}){const h=ee(),[C,g]=T(!1),[D,I]=ve({type:e,value:t,defaultValue:n,onChange:a}),x=Qe({type:e,date:D,locale:h.getLocale(r),format:l,labelSeparator:h.getLabelSeparator(p),formatter:m}),S=i=>{c&&(e==="default"&&g.close(),e==="range"&&i[0]&&i[1]&&g.close()),I(u&&e==="multiple"?[...i].sort((s,d)=>s.getTime()-d.getTime()):i)},P=()=>S(e==="range"?[null,null]:e==="multiple"?[]:null),b=e==="range"?!!D[0]:e==="multiple"?D.length>0:D!==null;return{_value:D,setValue:S,onClear:P,shouldClear:b,formattedValue:x,dropdownOpened:C,dropdownHandlers:g}}const Je={type:"default",valueFormat:"MMMM D, YYYY",closeOnChange:!0,sortDates:!0,dropdownType:"popover"},E=De((e,t)=>{const n=Ie("DatePickerInput",Je,e),{type:a,value:r,defaultValue:l,onChange:c,valueFormat:u,labelSeparator:p,locale:m,classNames:h,styles:C,unstyled:g,closeOnChange:D,size:I,variant:x,dropdownType:S,sortDates:P,minDate:b,maxDate:i,vars:s,defaultDate:d,valueFormatter:y,...A}=n,{resolvedClassNames:N,resolvedStyles:z}=ge({classNames:h,styles:C,props:n}),{calendarProps:_,others:le}=Te(A),{_value:M,setValue:ce,formattedValue:de,dropdownHandlers:ue,dropdownOpened:me,onClear:fe,shouldClear:he}=Xe({type:a,value:r,defaultValue:l,onChange:c,locale:m,format:u,labelSeparator:p,closeOnChange:D,sortDates:P,valueFormatter:y}),pe=Array.isArray(M)?M[0]||d:M||d,L=ee();return o.jsx(te,{formattedValue:de,dropdownOpened:me,dropdownHandlers:ue,classNames:N,styles:z,unstyled:g,ref:t,onClear:fe,shouldClear:he,value:M,size:I,variant:x,dropdownType:S,...le,type:a,__staticSelector:"DatePickerInput",children:o.jsx(ae,{..._,size:I,variant:x,type:a,value:M,defaultDate:pe||Ze({maxDate:i,minDate:b,timezone:L.getTimezone()}),onChange:ce,locale:m,classNames:N,styles:z,unstyled:g,__staticSelector:"DatePickerInput",__stopPropagation:S==="popover",minDate:b,maxDate:i,date:w("add",_.date,L.getTimezone()),__timezoneApplied:!0})})});E.classes={...te.classes,...ae.classes};E.displayName="@mantine/dates/DatePickerInput";const Re=e=>{var a;let t={};const n=["fromDate","toDate","createdAt"];return(a=e==null?void 0:e.filter(r=>!(n!=null&&n.includes(r.id))))==null||a.forEach(r=>{var l;Array.isArray(r.value)?t[r.id]=(l=r.value)==null?void 0:l.join(","):r.id==="merchantId"?t.merchantIds=r.value:t[r.id]=r.value}),t},we=e=>{var r,l;let t="";const n=(r=e==null?void 0:e[0])==null?void 0:r.id,a=(l=e==null?void 0:e[0])==null?void 0:l.desc;if(n==="createdAt"&&!a?t="asc":n==="createdAt"&&a&&(t="desc"),t)return{sort:t}};function W(e){return v(e,"DD MMM YYYY").format("YYYY-MM-DDTHH:mm:ss.SSS[Z]")}const et=e=>{let t="",n="";const a=e==null?void 0:e.find(l=>l.id==="fromDate"),r=e==null?void 0:e.find(l=>l.id==="toDate");if(a&&(t=a!=null&&a.value?W(a==null?void 0:a.value):""),r&&(n=r!=null&&r.value?W(r==null?void 0:r.value):""),a&&n)return{startDate:t,endDate:n};if(r)return{endDate:n};if(a)return{startDate:t}};function tt(e,t,n){const a={pageNo:n.pageIndex+1,limit:n.pageSize,...we(t),...Re(e),...et(e)};return Y.GET(F.GET_ALL_INVOICES_DETAILS(),{params:a})}const at=e=>{const{columnFilters:t,EnableQuery:n,sorting:a,pagination:r}=e,[l,c]=f.useState([]);return f.useEffect(()=>{n&&c(t)},[t,n]),H({queryKey:["All_Invoices-Grid-data",l,a,r],queryFn:()=>tt(l,a,r),placeholderData:U,refetchOnMount:!0,refetchOnWindowFocus:!1,retry:2})},rt=()=>{var S,P,b;const[e,t]=f.useState([]),[n,a]=f.useState([]),[r,l]=f.useState({pageIndex:0,pageSize:50}),[c,{open:u,close:p}]=T(!1),{data:m,isError:h,isLoading:C}=at({columnFilters:e,EnableQuery:!c,sorting:n,pagination:r}),{mutateAsync:g,isPending:D,variables:I}=Ee(),x=f.useMemo(()=>[{accessorKey:"merchantId",header:"Merchant",enableColumnFilter:!0,enableSorting:!1,maxSize:100,Cell:({row:i})=>{var s,d;return`${((s=i==null?void 0:i.original)==null?void 0:s.merchantName)??""} (${(d=i==null?void 0:i.original)==null?void 0:d.merchantId})`}},{accessorKey:"invoiceParameters.bankTransfer",header:"To be paid",enableSorting:!1,enableColumnFilter:!1,Cell:({cell:i})=>`${i.getValue()?i.getValue():""}`},{accessorKey:"createdAt",header:"Created At",accessorFn:i=>new Date(i==null?void 0:i.createdAt),Cell:({cell:i})=>k(i.getValue()),enableColumnFilter:!1,maxSize:150},{accessorKey:"fromDate",header:"From Date",accessorFn:i=>new Date(i==null?void 0:i.fromDate),enableSorting:!1,filterVariant:"date",muiFilterDatePickerProps:{label:"From Date",format:"DD MMM YYYY"},Cell:({cell:i})=>k(i.getValue()),maxSize:150},{accessorKey:"toDate",header:"To Date",maxSize:150,enableSorting:!1,accessorFn:i=>new Date(i==null?void 0:i.toDate),Cell:({cell:i})=>k(i.getValue()),filterVariant:"date",muiFilterDatePickerProps:{label:"To Date",format:"DD MMM YYYY"}},{accessorKey:"invoiceId",header:"Invoice ID",enableSorting:!1},{accessorKey:"status",header:"Status",maxSize:100,Cell:({cell:i,row:s})=>{var d,y;if(i.getValue())return o.jsx(Q,{children:D&&((d=I==null?void 0:I.updates)==null?void 0:d.invoiceId)===s.original.invoiceId?o.jsx(Z,{size:"sm"}):o.jsx(X,{disabled:(y=s==null?void 0:s.original)==null?void 0:y.isPaidDisable,size:"lg",checked:i.getValue()==="PAID",onLabel:"PAID",offLabel:"UNPAID",thumbIcon:i.getValue()==="PAID"?o.jsx(V,{size:12,color:"var(--mantine-color-teal-6)",stroke:3}):o.jsx(J,{size:12,color:"var(--mantine-color-red-6)",stroke:3}),styles:{trackLabel:{width:"40px",fontSize:"xl"}},onChange:A=>{g({updates:{...s==null?void 0:s.original,status:A.currentTarget.checked?"PAID":"UNPAID"}})}})})},enableColumnFilter:!0,filterVariant:"autocomplete",filterSelectOptions:[{value:"PAID",label:"PAID"},{value:"UNPAID",label:"UNPAID"}],enableSorting:!1},{accessorKey:"isSentToMerchant",header:"Sent to Merchant",Cell:({cell:i})=>o.jsx(re,{children:i.getValue()?"Yes":"No"}),enableSorting:!1,enableColumnFilter:!0,filterVariant:"autocomplete",maxSize:100,filterSelectOptions:[{value:"true",label:"YES"},{value:"false",label:"NO"}]},{accessorKey:"downloadLink",header:"View Invoice",enableSorting:!1,enableColumnFilter:!1,maxSize:100,Cell:({cell:i})=>{const s=i.getValue();return s?o.jsx("a",{href:`${s}`,target:"_blank",download:`${s}`,children:o.jsx(ie,{color:"green",cursor:"pointer"})}):"Not Available"}}],[D]);return o.jsx(ne,{children:o.jsx(f.Suspense,{fallback:o.jsx(R,{height:300,width:"100%"}),children:o.jsx(se,{data:((S=m==null?void 0:m.data)==null?void 0:S.invoices)??[],columnFilters:e,columns:x,pagination:r,sorting:n,totalRowCount:((P=m==null?void 0:m.data)==null?void 0:P.totalCount)??0,onColumnFiltersChange:t,onPaginationChange:l,onSortingChange:a,isLoading:C,OnFilterButtonClicked:()=>u(),OnApplyFiltersClicked:()=>p(),filterDrawerIsOpen:c,enableRowSelection:!0,isError:h,tableName:(b=oe)==null?void 0:b.AllInvoicesDisplay,crudOperationHeader:"Invoices",columnPinning:{left:["mrt-row-select"]},uniqueIDForRows:"invoiceId",enableRowActions:!1,muiExpandButtonProps:({row:i,table:s})=>({onClick:()=>s.setExpanded({[i.id]:!i.getIsExpanded()}),sx:{transform:i.getIsExpanded()?"rotate(180deg)":"rotate(-90deg)",transition:"transform 0.2s"}}),renderDetailPanel:({row:i})=>{var s;return(s=i.original)!=null&&s.invoiceParameters?o.jsx(Ne,{row:i}):void 0},renderCaption:({table:i})=>{var s,d;return ze((s=m==null?void 0:m.data)==null?void 0:s.totalToBePaid)?o.jsx(xe,{size:"lg",styles:{label:{textTransform:"none"}},children:`Total To be Paid: Â£
                ${((d=m==null?void 0:m.data)==null?void 0:d.totalToBePaid)??"0"}`}):void 0}})})})},nt=({name:e,label:t,disabled:n})=>{const{values:a,errors:r,touched:l,setFieldValue:c}=_e(),u={touched:l[e],error:r[e]},p=a[e],m=u.touched&&u.error&&typeof u.error=="string"?u.error:void 0;return o.jsx(Le,{name:e,children:({field:h})=>o.jsx("div",{children:o.jsx(E,{...h,type:"range",label:t,value:p,onChange:C=>c(e,C),disabled:n,error:m,placeholder:"Pick dates range",valueFormat:"DD MMM YYYY",maxDate:new Date})})})},st=async e=>{if(!e.merchantIds||e.lastWeek===null)throw new Error("Missing required fields");if(!e.lastWeek&&(!e.startDate||!e.endDate))throw new Error("Start date and End date are required when 'lastWeek' is false");return Y.POST(F.GENERATE_INVOICE_BY_MERCHANTID_AND_DATE_RANGE(),e)},ot=()=>{const e=Se();return be({mutationFn:async t=>await st(t),onSuccess:t=>{var n,a;(a=(n=t==null?void 0:t.data)==null?void 0:n.invoices)!=null&&a.some(r=>r.status==="success")&&e.invalidateQueries({queryKey:["All_Invoices-Grid-data"]})},onError:t=>{var n,a;t instanceof ye?O.show({title:((a=(n=t==null?void 0:t.response)==null?void 0:n.data)==null?void 0:a.message)??"Request Failed",message:"There was an error processing the invoice request.",color:"red",autoClose:5e3}):O.show({title:"Invoice Creation Failed",message:"Something went wrong.",color:"red",autoClose:5e3})}})};function it({data:e,headers:t,columnsMapping:n,uniqueKeyInRows:a}){const r=e==null?void 0:e.map((l,c)=>o.jsx(j.Tr,{children:t.map(u=>o.jsx(j.Td,{styles:{td:{textAlign:"center"}},children:u==="Status"?o.jsx(Ge,{value:l[n[u]]??""}):o.jsx(Ce,{children:l[n[u]]??""})},u))},a&&a in l?l[a]:c));return o.jsxs(j,{verticalSpacing:"sm",stickyHeader:!0,children:[o.jsx(j.Thead,{children:o.jsx(j.Tr,{children:t.map(l=>o.jsx(j.Th,{styles:{th:{textAlign:"center"}},children:l},l))})}),o.jsx(j.Tbody,{children:r})]})}const lt=$e({merchantIds:G().of(qe().required("Merchant ID is required")).min(1,"At least one Merchant ID must be selected").required("Merchant IDs are required"),dateRange:G().min(2,"Date Range is Required").max(2,"Date Range is Required").when("isLastWeek",{is:!0,then:e=>e.nullable("Should be Null"),otherwise:e=>e.required("required").nonNullable("Should not be Null ")})}),ct=e=>e!=null&&e.isLastWeek?{merchantIds:e==null?void 0:e.merchantIds,lastWeek:e==null?void 0:e.isLastWeek}:{merchantIds:e==null?void 0:e.merchantIds,lastWeek:e==null?void 0:e.isLastWeek,startDate:e!=null&&e.dateRange[0]?e==null?void 0:e.dateRange[0]:null,endDate:e!=null&&e.dateRange[1]?e==null?void 0:e.dateRange[1]:null},dt={"Merchant ID":"merchantId",Message:"message",Status:"status"},ut=()=>{const{mutate:e,isPending:t,isSuccess:n,data:a}=ot(),r=f.useRef(null);f.useEffect(()=>{var c,u;return n&&(a!=null&&a.data)&&$.open({title:o.jsx(Pe,{icon:o.jsx(V,{}),color:"teal",title:((c=a==null?void 0:a.data)==null?void 0:c.message)??"Details",mt:"md",withCloseButton:!1,styles:{root:{boxShadow:"none"}}}),children:o.jsx(it,{data:(u=a==null?void 0:a.data)==null?void 0:u.invoices,headers:["Merchant ID","Message","Status"],columnsMapping:dt,uniqueKeyInRows:"merchantId"}),size:"lg"}),()=>{$.closeAll()}},[n]);const l=c=>{e(ct(c))};return o.jsx(je,{size:"sm",mt:30,children:o.jsxs(ke,{p:"xl",shadow:"sm",withBorder:!0,pos:"relative",children:[o.jsx(We,{order:5,ta:"center",mb:20,c:"grey",children:"Select Merchant Id and Date Range to generate Invoice"}),o.jsx(Oe,{initialValues:{merchantIds:[],isLastWeek:!1,dateRange:[]},validationSchema:lt,onSubmit:c=>{l(c)},innerRef:r,children:({setFieldValue:c,values:u})=>o.jsx(Ke,{children:o.jsxs(Be,{children:[o.jsx(Ye,{name:"merchantIds"}),o.jsxs(K,{gap:"lg",grow:!0,align:"flex-start",children:[o.jsx(nt,{name:"dateRange",label:"Select Date Range",disabled:u==null?void 0:u.isLastWeek}),o.jsx(Fe,{name:"isLastWeek",label:"Last Week",OnChangeHandler:p=>{c("isLastWeek",p.target.checked),p.target.checked&&c("dateRange",[null,null])}})]}),o.jsxs(K,{grow:!0,gap:"md",mt:20,children:[o.jsx(q,{type:"submit",disabled:t,loading:t,children:"Submit"}),o.jsx(q,{type:"reset",variant:"outline",children:"Reset"})]})]})})}),o.jsx(He,{visible:t,zIndex:1e3,overlayProps:{radius:"sm",blur:2}})]})})},mt=e=>{var a;let t={};const n=["fromDate","toDate","createdAt"];return(a=e==null?void 0:e.filter(r=>!(n!=null&&n.includes(r.id))))==null||a.forEach(r=>{var l;Array.isArray(r.value)?t[r.id]=(l=r.value)==null?void 0:l.join(","):t[r.id]=r.value}),t},ft=e=>{var r,l;let t="";const n=(r=e==null?void 0:e[0])==null?void 0:r.id,a=(l=e==null?void 0:e[0])==null?void 0:l.desc;if(n==="createdAt"&&!a?t="asc":n==="createdAt"&&a&&(t="desc"),t)return{sort:t}};function B(e){return v(e,"DD MMM YYYY").format("YYYY-MM-DDTHH:mm:ss.SSS[Z]")}const ht=e=>{let t="",n="";const a=e==null?void 0:e.find(l=>l.id==="fromDate"),r=e==null?void 0:e.find(l=>l.id==="toDate");if(a&&(t=a!=null&&a.value?B(a==null?void 0:a.value):""),r&&(n=r!=null&&r.value?B(r==null?void 0:r.value):""),a&&n)return{startDate:t,endDate:n};if(r)return{endDate:n};if(a)return{startDate:t}};function pt(e,t,n){const a={pageNo:n.pageIndex+1,limit:n.pageSize,...ft(t),...mt(e),...ht(e),isManualCreate:!0};return Y.GET(F.GET_ALL_INVOICES_DETAILS(),{params:a})}const Dt=e=>{const{columnFilters:t,EnableQuery:n,sorting:a,pagination:r}=e,[l,c]=f.useState([]),u=["All_Manual_Invoices-Grid-data",l,n,a,r];return f.useEffect(()=>{n&&c(t)},[t,n]),H({queryKey:u,queryFn:()=>pt(l,a,r),placeholderData:U,refetchOnMount:!0,refetchOnWindowFocus:!1,retry:2})},It=()=>{var P,b,i;const[e,t]=f.useState([]),[n,a]=f.useState([]),[r,l]=f.useState({pageIndex:0,pageSize:50}),[c,{open:u,close:p}]=T(!1),{search:m}=Ae(),{data:h,isError:C,isLoading:g}=Dt({columnFilters:e,EnableQuery:!c&&(m==null?void 0:m.includes("Other_Invoices")),sorting:n,pagination:r}),{mutateAsync:D,isPending:I,variables:x}=Ve(),S=f.useMemo(()=>[{accessorKey:"merchantName",header:"Name",enableColumnFilter:!0,enableSorting:!1,maxSize:100,Cell:({row:s})=>{var d,y;return`${((d=s==null?void 0:s.original)==null?void 0:d.merchantName)??""} (${(y=s==null?void 0:s.original)==null?void 0:y.merchantId})`}},{accessorKey:"createdAt",header:"Created At",accessorFn:s=>s!=null&&s.createdAt?new Date(s==null?void 0:s.createdAt):"",Cell:({cell:s})=>k(s.getValue()),enableColumnFilter:!1,maxSize:150},{accessorKey:"fromDate",header:"From Date",accessorFn:s=>new Date(s==null?void 0:s.fromDate),enableSorting:!1,filterVariant:"date",muiFilterDatePickerProps:{label:"From Date",format:"DD MMM YYYY"},Cell:({cell:s})=>k(s.getValue()),maxSize:150},{accessorKey:"toDate",header:"To Date",maxSize:150,enableSorting:!1,accessorFn:s=>new Date(s==null?void 0:s.toDate),Cell:({cell:s})=>k(s.getValue()),filterVariant:"date",muiFilterDatePickerProps:{label:"To Date",format:"DD MMM YYYY"}},{accessorKey:"invoiceId",header:"Invoice ID",enableSorting:!1},{accessorKey:"status",header:"Status",maxSize:100,Cell:({cell:s,row:d})=>{var y;if(s.getValue())return o.jsx(Q,{children:I&&(x==null?void 0:x.invoiceId)===d.original.invoiceId?o.jsx(Z,{size:"sm"}):o.jsx(X,{disabled:!((y=d==null?void 0:d.original)!=null&&y.isPaidDisable),size:"lg",checked:s.getValue()==="PAID",onLabel:"PAID",offLabel:"UNPAID",thumbIcon:s.getValue()==="PAID"?o.jsx(V,{size:12,color:"var(--mantine-color-teal-6)",stroke:3}):o.jsx(J,{size:12,color:"var(--mantine-color-red-6)",stroke:3}),styles:{trackLabel:{width:"40px",fontSize:"xl"}},onChange:A=>{D({...d==null?void 0:d.original,status:A.currentTarget.checked?"PAID":"UNPAID"})}})})},enableColumnFilter:!0,filterVariant:"autocomplete",filterSelectOptions:[{value:"PAID",label:"PAID"},{value:"UNPAID",label:"UNPAID"}],enableSorting:!1},{accessorKey:"isSentToMerchant",header:"Sent to Customer",Cell:({cell:s})=>o.jsx(re,{children:s.getValue()?"Yes":"No"}),enableSorting:!1,enableColumnFilter:!0,filterVariant:"autocomplete",maxSize:100,filterSelectOptions:[{value:"true",label:"YES"},{value:"false",label:"NO"}]},{accessorKey:"downloadLink",header:"View Invoice",enableSorting:!1,enableColumnFilter:!1,maxSize:100,Cell:({cell:s})=>{const d=s.getValue();return d?o.jsx("a",{href:`${d}`,target:"_blank",download:`${d}`,children:o.jsx(ie,{color:"green",cursor:"pointer"})}):"Not Available"}}],[I]);return o.jsx(ne,{children:o.jsx(f.Suspense,{fallback:o.jsx(R,{height:300,width:"100%"}),children:o.jsx(se,{data:((P=h==null?void 0:h.data)==null?void 0:P.invoices)??[],columnFilters:e,columns:S,pagination:r,sorting:n,totalRowCount:((b=h==null?void 0:h.data)==null?void 0:b.totalCount)??0,onColumnFiltersChange:t,onPaginationChange:l,onSortingChange:a,isLoading:g,OnFilterButtonClicked:()=>u(),OnApplyFiltersClicked:()=>p(),filterDrawerIsOpen:c,enableRowSelection:!0,isError:C,tableName:(i=oe)==null?void 0:i.AllManualInvoicesDisplay,crudOperationHeader:"Invoice",columnPinning:{left:["mrt-row-select"]},uniqueIDForRows:"invoiceId",enableRowActions:!0,ManualInvoiceTableCellForm:!0})})})};function _t(){const e=[{label:"Generate Invoices",value:"Generate_Invoices",content:o.jsx(ut,{})},{label:"View Invoices",value:"View_Invoices",content:o.jsx(rt,{})},{label:"Other Invoices",value:"Other_Invoices",content:o.jsx(It,{})}];return o.jsx(Me,{tabs:e})}export{_t as default};
