import{Q as E,S as u,a8 as y,j as s,G as k,l as F,M as T,r as m,B as V,L as z,A as B,N,a1 as O,D as _}from"./index-BGPQORr6.js";import{a as G,D as K}from"./MUIThemeProvider-DYjjTKgw.js";import{u as H,A as S,a as Y,D as L}from"./ApiConstants-D1IcDG0W.js";import{u as Q}from"./useGetMerchantDetailsbyId-DjV4YOr4.js";import{C as q}from"./Container-CWVVR9kr.js";import{T as W}from"./Text-Bw2S6QYb.js";import{B as v}from"./Badge-3Z_Uu84r.js";import{I as U}from"./InvoiceParameters-DYZIpgsA.js";import{u as Z}from"./DateTimePicker-CSAYhhtV.js";import{d as J}from"./helperFuntions-IpEH5JRM.js";import"./index.esm-DYQ8eCU5.js";import"./Alert-B7aDEzum.js";import"./IconTrash-BdsgRmiH.js";import"./Title-DxxQha-n.js";function x(e){return u(e,"DD MMM YYYY").format("YYYY-MM-DDTHH:mm:ss.SSS[Z]")}const X=e=>{var r,c;let t="";const o=(r=e==null?void 0:e[0])==null?void 0:r.id,n=(c=e==null?void 0:e[0])==null?void 0:c.desc;if(o==="createdAt"&&!n?t="asc":o==="createdAt"&&n&&(t="desc"),t)return{sort:t}},$=e=>{let t="",o="";const n=e==null?void 0:e.find(c=>c.id==="fromDate"),r=e==null?void 0:e.find(c=>c.id==="toDate");if(n&&(t=n!=null&&n.value?x(n==null?void 0:n.value):"",r&&(o=r!=null&&r.value?x(r==null?void 0:r.value):"")),t||o)return{startDate:t,endDate:o}};function R(e,t,o,n){const r={merchantId:e==null?void 0:e.toString(),pageNo:n.pageIndex+1,limit:n.pageSize,...X(o),...$(t)};return S.GET(Y.GET_MERCHANT_INVOICES_BY_ID(),{params:r})}const ee=e=>{const{merchantId:t,columnFilters:o,EnableQuery:n,sorting:r,pagination:c}=e;return H({queryKey:["Invoices-of-Merchant",t,o,r,c],queryFn:()=>R(t,o,r,c),placeholderData:E,enabled:n,refetchOnMount:!1,refetchOnWindowFocus:!1,retry:2})};function te(){var c,l;const{merchantId:e}=y(),{data:t,error:o,isLoading:n,isFetching:r}=Q(e.toString()??"");return e?s.jsxs(s.Fragment,{children:[s.jsxs(k,{children:[s.jsxs(v,{size:"lg",variant:"dot",children:["Merchant ID : ",e]}),s.jsx(v,{size:"lg",children:(l=(c=t==null?void 0:t.data)==null?void 0:c.merchant)==null?void 0:l.merchantName})]}),s.jsx(L,{mb:"md",mt:"md"})]}):s.jsx(q,{size:"lg",mt:30,className:"fallback-ui",children:s.jsx(W,{size:"xl",fw:500,children:"Merchant ID is not provided in the URL."})})}const ae=({invoiceId:e})=>{const t=Y.VIEW_INVOICE_BY_MERCHANT();return S.POST(t,{invoiceId:e})},re=()=>{const e=F();return Z({mutationFn:({invoiceId:t})=>ae({invoiceId:t}),onSuccess:t=>{var o;(o=t==null?void 0:t.data)!=null&&o.success&&e.invalidateQueries({queryKey:["All_Invoices-Grid-data"]})},onError:t=>{J(t)}})},Me=()=>{var I,M;const{merchantId:e}=y(),[t,{open:o,close:n}]=T(!1),[r,c]=m.useState([]),[l,b]=m.useState([]),[D,g]=m.useState({pageIndex:0,pageSize:10}),{data:d,isLoading:C,isError:j}=ee({merchantId:e,columnFilters:r,EnableQuery:!t&&!!e,sorting:l,pagination:D}),{mutateAsync:A,isPending:h,variables:f}=re(),P=async({invoiceId:a,downloadlink:i})=>{try{if(await A({invoiceId:a}),!window.open(i,"_blank","noopener,noreferrer"))throw new Error("Failed to open a new window. The browser may have blocked it.")}catch(p){p instanceof Error&&_.show({title:"Error",message:p.message||"Failed to view or download the invoice.",color:"red"})}},w=m.useMemo(()=>[{accessorKey:"invoiceId",header:"Invoice ID",enableSorting:!1,enableColumnFilter:!1,maxSize:30},{accessorKey:"fromDate",header:"From Date",enableSorting:!1,maxSize:50,accessorFn:a=>new Date(a==null?void 0:a.fromDate),Cell:({cell:a})=>{const i=a.getValue();return u(i).format("DD MMM YYYY")},filterVariant:"date",muiFilterDatePickerProps:{label:"From Date",format:"DD MMM YYYY"}},{accessorKey:"toDate",header:"To Date",enableSorting:!1,maxSize:50,accessorFn:a=>new Date(a==null?void 0:a.toDate),Cell:({cell:a})=>{const i=a.getValue();return u(i).format("DD MMM YYYY")},filterVariant:"date",muiFilterDatePickerProps:{format:"DD MMM YYYY",label:"To Date"}},{accessorKey:"downloadLink",header:"View Invoice",enableSorting:!1,enableColumnFilter:!1,maxSize:150,Cell:({cell:a,row:i})=>a.getValue()?s.jsx(V,{children:h&&(f==null?void 0:f.invoiceId)===i.original.invoiceId?s.jsx(z,{size:"sm"}):s.jsx(B,{variant:"transparent",onClick:()=>{P({invoiceId:i.original.invoiceId,downloadlink:a.getValue()})},children:s.jsx(N,{color:"green"})})}):"Not Available"},{accessorKey:"createdAt",header:"Created At",enableSorting:!0,enableColumnFilter:!1,maxSize:50,accessorFn:a=>new Date(a==null?void 0:a.createdAt),Cell:({cell:a})=>{const i=a.getValue();return u(i).format("DD MMM YYYY hh:mm A")},muiFilterDateTimePickerProps:{label:"Created At"},meta:{fieldType:"DateTimeRange"}}],[h]);return s.jsx(G,{children:s.jsxs(m.Suspense,{fallback:s.jsx(O,{height:300,width:"100%"}),children:[s.jsx(te,{}),s.jsx(K,{data:((I=d==null?void 0:d.data)==null?void 0:I.invoices)??[],columnFilters:r,columns:w,pagination:D,sorting:l,totalRowCount:((M=d==null?void 0:d.data)==null?void 0:M.totalCount)??0,onColumnFiltersChange:c,onPaginationChange:g,onSortingChange:b,isLoading:C,OnFilterButtonClicked:()=>o(),OnApplyFiltersClicked:()=>n(),filterDrawerIsOpen:t,isError:j,tableName:"MerchantInvoicesData",crudOperationHeader:"Invoices",columnPinning:{},uniqueIDForRows:"downloadLink",enableRowActions:!1,muiExpandButtonProps:({row:a,table:i})=>({onClick:()=>i.setExpanded({[a.id]:!a.getIsExpanded()}),sx:{transform:a.getIsExpanded()?"rotate(180deg)":"rotate(-90deg)",transition:"transform 0.2s"}}),renderDetailPanel:({row:a})=>{var i;return(i=a.original)!=null&&i.invoiceParameters?s.jsx(U,{row:a}):null}})]})})};export{Me as default};
