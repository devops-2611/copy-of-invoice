import{i as I,j as r,y as R,z,A as M,b as P,D as A,E as K,r as f,F as w,v as G,H,N as Y,a as V,J as U,K as W,M as q,P as B,T as N,G as Q,e as F,n as T}from"./index-DJfC_LKA.js";import{A as _}from"./AppTabs-DNBFqnla.js";import{c as $,B as J,o as E,u as Z,M as X,a as ee,D as ae}from"./MUIThemeProvider-DlitpbUb.js";import{A as re}from"./AppChipComponent-D5JcRf4Y.js";import{c as te}from"./helperFuntions-D5lYpqZv.js";import{I as se,c as le}from"./useUpdateUser-DMboG7Aw.js";import{c as oe,i as ie,F as ne,b as ce}from"./index.esm-D1SUAxcJ.js";import{F as de,U as me,I as ue}from"./UploadOrderErrorDisplay-BQTn6Jyb.js";import{S as pe}from"./FormikInputField-BCFqIq4V.js";import{L as fe}from"./LoadingOverlay-SsZ0EzDw.js";import"./Rating-DqUX-sFn.js";import"./index-DEqkLp3P.js";import"./Alert-U0SP077c.js";import"./TextInput-Dcw03Ip4.js";import"./Title-CRBpu3gT.js";import"./IconX-Cd2CjIdJ.js";import"./List-Dp--SsnA.js";import"./Card-BxkeFcvN.js";/**
 * @license @tabler/icons-react v3.21.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var ye=I("outline","clipboard-list","IconClipboardList",[["path",{d:"M9 5h-2a2 2 0 0 0 -2 2v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-12a2 2 0 0 0 -2 -2h-2",key:"svg-0"}],["path",{d:"M9 3m0 2a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v0a2 2 0 0 1 -2 2h-2a2 2 0 0 1 -2 -2z",key:"svg-1"}],["path",{d:"M9 12l.01 0",key:"svg-2"}],["path",{d:"M13 12l2 0",key:"svg-3"}],["path",{d:"M9 16l.01 0",key:"svg-4"}],["path",{d:"M13 16l2 0",key:"svg-5"}]]);/**
 * @license @tabler/icons-react v3.21.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var be=I("outline","credit-card-pay","IconCreditCardPay",[["path",{d:"M12 19h-6a3 3 0 0 1 -3 -3v-8a3 3 0 0 1 3 -3h12a3 3 0 0 1 3 3v4.5",key:"svg-0"}],["path",{d:"M3 10h18",key:"svg-1"}],["path",{d:"M16 19h6",key:"svg-2"}],["path",{d:"M19 16l3 3l-3 3",key:"svg-3"}],["path",{d:"M7.005 15h.005",key:"svg-4"}],["path",{d:"M11 15h2",key:"svg-5"}]]);/**
 * @license @tabler/icons-react v3.21.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var he=I("outline","currency-euro","IconCurrencyEuro",[["path",{d:"M17.2 7a6 7 0 1 0 0 10",key:"svg-0"}],["path",{d:"M13 10h-8m0 4h8",key:"svg-1"}]]);const Se=$(r.jsx("path",{d:"M22 16V4c0-1.1-.9-2-2-2H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2m-11-4 2.03 2.71L16 11l4 5H8zM2 6v14c0 1.1.9 2 2 2h14v-2H4V6z"}),"Collections");function O(e){return A(e,"DD MMM YYYY hh:mm A").format("YYYY-MM-DDTHH:mm:ss.SSS[Z]")}const x=["merchantId","pageNo","limit","customerId","orderType","paymentType","confirmationStatus","status","paymentStatus","branchName","orderId"],ve=e=>{let t={};return e==null||e.forEach(s=>{var a;x!=null&&x.includes(s.id)&&(Array.isArray(s.value)?t[s.id]=(a=s.value)==null?void 0:a.join(","):t[s.id]=s.value)}),t},De=e=>{var n,u;let t="";const s=(n=e==null?void 0:e[0])==null?void 0:n.id,a=(u=e==null?void 0:e[0])==null?void 0:u.desc;if(s==="customerFirstName"&&!a?t="ascFirstName":s==="customerFirstName"&&a?t="descFirstName":s==="customerLastName"&&!a?t="ascLastName":s==="customerLastName"&&a?t="descLastName":s==="orderDate"&&!a?t="ascOrder":s==="orderDate"&&a&&(t="descOrder"),t)return{sort:t}},Ce=e=>{let t="",s="";const a=e==null?void 0:e.find(n=>n.id==="orderDate");if(a&&Array.isArray(a==null?void 0:a.value)&&(t=a!=null&&a.value[0]?O(a==null?void 0:a.value[0]):"",s=a!=null&&a.value[1]?O(a==null?void 0:a.value[1]):""),t||s)return{startDate:t,endDate:s}};function Te(e,t,s){const a={merchantId:null,pageNo:s.pageIndex+1,limit:s.pageSize,...De(t),...ve(e),...Ce(e)};return M.GET(P.GET_ALL_ORDERS(),{params:a})}const xe=e=>{const{columnFilters:t,EnableQuery:s,sorting:a,pagination:n}=e;return R({queryKey:["Orders-Grid-data",t,a,n],queryFn:()=>Te(t,a,n),placeholderData:z,enabled:s,refetchOnMount:!0,refetchOnWindowFocus:!1,retry:2})},g=({renderedCellValue:e})=>r.jsxs(J,{sx:{display:"flex",alignItems:"center",gap:"0.5rem",justifyContent:"center"},children:[e==="CASH"&&r.jsx(he,{}),e==="CARD"&&r.jsx(be,{}),e==="DELIVERY"&&r.jsx(K,{}),e==="COLLECTION"&&r.jsx(Se,{}),r.jsx("span",{children:e})]}),ge=[{key:"merchantId",name:"merchantId",fieldType:"Number",label:"Merchant ID",disabled:{disabledFieldForNew:!1}},{key:"orderId",name:"orderId",fieldType:"Number",label:"Order ID",disabled:{disabledFieldForNew:!0,disableFieldForEdit:!0}},{key:"orderDate",name:"orderDate",fieldType:"DateTimeRange",label:"Order Date",disabled:{disabledFieldForNew:!1,disableFieldForEdit:!0}},{key:"customerId",name:"customerId",fieldType:"Number",label:"Customer ID",disabled:{disabledFieldForNew:!1}},{key:"customerFirstName",name:"customerFirstName",fieldType:"Text",label:"Customer First Name"},{key:"customerLastName",name:"customerLastName",fieldType:"Text",label:"Customer Last Name"},{key:"orderType",name:"orderType",fieldType:"Select",label:"Order Type",meta:{options:[{label:"DELIVERY",value:"DELIVERY"},{label:"COLLECTION",value:"COLLECTION"}]}},{key:"paymentType",name:"paymentType",fieldType:"Select",label:"Payment Type",meta:{options:[{label:"CASH",value:"CASH"},{label:"CARD",value:"CARD"}]}},{key:"paymentStatus",name:"paymentStatus",fieldType:"Select",label:"Payment Status",meta:{options:[{label:"COMPLETED",value:"COMPLETED"},{label:"PENDING",value:"PENDING"},{label:"PROCESSED",value:"PROCESSED"}]}},{key:"confirmationStatus",name:"confirmationStatus",fieldType:"Select",label:"Confirmation Status",meta:{options:[{label:"COMPLETED",value:"COMPLETED"},{label:"PENDING",value:"PENDING"}]}},{key:"promoCode",name:"promoCode",fieldType:"Text",label:"Promo Code"},{key:"promoDiscountSwishr",name:"promoDiscountSwishr",fieldType:"Number",label:"Promo Discount (SWISHR)"},{key:"promoDiscountMerchant",name:"promoDiscountMerchant",fieldType:"Number",label:"Promo Discount (Merchant)"},{key:"refundSwishr",name:"refundSwishr",fieldType:"Number",label:"Refund (SWISHR)"},{key:"refundMerchant",name:"refundMerchant",fieldType:"Number",label:"Refund (Merchant)"},{key:"orderDiscount",name:"orderDiscount",fieldType:"Number",label:"Order Discount"},{key:"driverTip",name:"driverTip",fieldType:"Number",label:"Driver Tip"},{key:"deliveryCharge",name:"deliveryCharge",fieldType:"Number",label:"Delivery Charge"},{key:"serviceFee",name:"serviceFee",fieldType:"Number",label:"Service Fee"},{key:"surcharge",name:"surcharge",fieldType:"Number",label:"Surcharge"},{key:"subTotal",name:"subTotal",fieldType:"Number",label:"Sub Total"},{key:"taxes",name:"taxes",fieldType:"Number",label:"Taxes"},{key:"total",name:"total",fieldType:"Number",label:"Total"},{key:"branchName",name:"branchName",fieldType:"Text",label:"Branch Name"},{key:"status",name:"status",fieldType:"Select",label:"Status",meta:{options:E}}],Ee=({data:e,columns:t})=>{const s=Z({columns:t,data:e,enableFullScreenToggle:!1,enableHiding:!1});return r.jsx(X,{table:s})},Ie=()=>{var m,o;const[e,t]=f.useState([]),[s,a]=f.useState([]),[n,u]=f.useState({pageIndex:0,pageSize:50}),[y,{open:b,close:h}]=w(!1),{data:d,isError:D,isLoading:S}=xe({columnFilters:e,EnableQuery:!y,sorting:s,pagination:n}),v=f.useMemo(()=>[{accessorKey:"orderId",header:"Order ID",enableSorting:!1,size:150},{accessorKey:"branchName",header:"Branch Name",enableSorting:!1},{accessorKey:"customerId",header:"Customer ID",enableSorting:!1,size:150,enableEditing:!1},{accessorKey:"orderDate",accessorFn:l=>new Date(l.orderDate),header:"Order Date",filterVariant:"datetime-range",Cell:({cell:l})=>te(l.getValue()),muiFilterDateTimePickerProps:{label:"Order Date",timeSteps:{minutes:1}},maxSize:150},{accessorKey:"customerFirstName",header:"Customer First Name",enableColumnFilter:!1},{accessorKey:"customerLastName",header:"Customer Last Name",enableColumnFilter:!1},{accessorKey:"orderType",header:"Order Type",filterVariant:"multi-select",filterSelectOptions:[{label:"DELIVERY",value:"DELIVERY"},{label:"COLLECTION",value:"COLLECTION"}],enableSorting:!1,maxSize:30,Cell:({renderedCellValue:l})=>g({renderedCellValue:l})},{accessorKey:"paymentType",header:"Payment Type",filterVariant:"multi-select",filterSelectOptions:[{label:"CASH",value:"CASH"},{label:"CARD",value:"CARD"}],enableSorting:!1,maxSize:30,Cell:({renderedCellValue:l})=>g({renderedCellValue:l})},{accessorKey:"paymentStatus",header:"Payment Status",filterVariant:"multi-select",filterSelectOptions:[{label:"COMPLETED",value:"COMPLETED"},{label:"PENDING",value:"PENDING"},{label:"PROCESSED",value:"PROCESSED"}],enableSorting:!1,maxSize:30},{accessorKey:"confirmationStatus",header:"Confirmation Status",filterVariant:"multi-select",filterSelectOptions:[{label:"COMPLETED",value:"COMPLETED"},{label:"PENDING",value:"PENDING"}],enableSorting:!1,maxSize:30},{accessorKey:"promoCode",header:"Promo Code",enableSorting:!1,enableColumnFilter:!1,maxSize:30},{accessorKey:"promoDiscountSwishr",header:"Promo Discount (SWISHR)",enableSorting:!1,enableColumnFilter:!1,maxSize:50},{accessorKey:"promoDiscountMerchant",header:"Promo Discount (Merchant)",enableSorting:!1,enableColumnFilter:!1,maxSize:50},{accessorKey:"refundSwishr",header:"Refund (SWISHR)",enableSorting:!1,enableColumnFilter:!1,maxSize:30},{accessorKey:"refundMerchant",header:"Refund (Merchant)",enableSorting:!1,enableColumnFilter:!1,maxSize:30},{accessorKey:"orderDiscount",header:"Order Discount",enableSorting:!1,enableColumnFilter:!1,maxSize:30},{accessorKey:"driverTip",header:"Driver Tip",enableSorting:!1,enableColumnFilter:!1,maxSize:30},{accessorKey:"deliveryCharge",header:"Delivery Charge",filterVariant:"range-slider",enableSorting:!1,enableColumnFilter:!1,maxSize:30,Cell:({renderedCellValue:l})=>g({renderedCellValue:l})},{accessorKey:"serviceFee",header:"Service Fee",enableSorting:!1,enableColumnFilter:!1,maxSize:30},{accessorKey:"surcharge",header:"Surcharge",enableSorting:!1,enableColumnFilter:!1,maxSize:30},{accessorKey:"subTotal",header:"Sub Total",enableSorting:!1,enableColumnFilter:!1,maxSize:30},{accessorKey:"taxes",header:"Taxes",enableSorting:!1,enableColumnFilter:!1,maxSize:30},{accessorKey:"total",header:"Total",enableSorting:!1,enableColumnFilter:!1,maxSize:30},{accessorKey:"orderItems",header:"Order Items",enableSorting:!1,Cell:({row:l})=>r.jsx(G,{variant:"transparent",onClick:()=>{var i,c;return H.open({title:r.jsx(Y,{icon:r.jsx(ye,{}),color:"teal",title:`Order Items for Order ID: ${(i=l==null?void 0:l.original)==null?void 0:i.orderId}`,mt:"md",withCloseButton:!1,styles:{root:{boxShadow:"none"}}}),children:r.jsx(Ee,{data:((c=l==null?void 0:l.original)==null?void 0:c.orderItems)??[],columns:[{header:"Product",accessorKey:"product"},{header:"Quantity",accessorKey:"quantity"}]}),size:"xl"})},children:r.jsx(se,{color:"green"})})},{accessorKey:"status",header:"Status",maxSize:60,Cell:({cell:l})=>{var i,c;return r.jsx(re,{value:((c=(i=E)==null?void 0:i.find(C=>C.value===l.getValue()))==null?void 0:c.label)??""})},filterVariant:"multi-select",enableSorting:!1,filterSelectOptions:E,editSelectOptions:[{label:"COMPLETED",value:"COMPLETED"},{label:"PENDING",value:"PENDING"}]},{accessorKey:"merchantId",header:"Merchant ID",enableSorting:!1,size:150}],[]);return r.jsx(ee,{children:r.jsx(ae,{data:((m=d==null?void 0:d.data)==null?void 0:m.orders)??[],columnFilters:e,columns:v,pagination:n,sorting:s,totalRowCount:((o=d==null?void 0:d.data)==null?void 0:o.totalCount)??0,onColumnFiltersChange:t,onPaginationChange:u,onSortingChange:a,isLoading:S,OnFilterButtonClicked:()=>b(),OnApplyFiltersClicked:()=>h(),filterDrawerIsOpen:y,enableRowSelection:!0,isError:D,tableName:"OrdersDisplay",columnPinning:{left:["mrt-row-select","orderId","branchName"],right:["mrt-row-actions"]},crudOperationHeader:"Order",uniqueIDForRows:"orderId",uiSchema:ge})})},Ne=async e=>{const t=new FormData;return e.csvfile.forEach(s=>{t.append("files",s)}),await M.POST(P.UPLOAD_AND_PARSE_DOCUMENT(),t)},Fe=()=>V({mutationFn:Ne}),Oe=oe({csvfile:ie().min(1,"You must upload at least one file.").required("CSV file is required.")}),Me=()=>{var S,v;const e={csvfile:[]},t=f.useRef(null),{mutate:s,error:a,reset:n,isPending:u}=Fe(),[y,b]=U.useState(!1),h=W(),d=q(),D=m=>{s({csvfile:m.csvfile},{onSuccess:o=>{var l,i;T.show({title:"Success",message:((l=o.data)==null?void 0:l.message)||"File uploaded successfully.",color:"green",position:"top-center",withCloseButton:!0,autoClose:!0}),(i=t.current)==null||i.resetForm(),d.invalidateQueries({queryKey:["Orders-Grid-data"]}),b(!0)},onError:o=>{var l,i,c;T.show({title:"Error",message:((i=(l=o.response)==null?void 0:l.data)==null?void 0:i.message)||"Failed to upload files.",color:"red"}),(c=t.current)==null||c.setErrors(o),b(!1)}})};return r.jsx(B,{shadow:"sm",p:20,children:r.jsxs(pe,{gap:20,pos:"relative",children:[r.jsx(N,{size:"lg",style:{fontWeight:"600"},children:"Upload Excel or CSV file to store order details. (Multiple files can be uploaded)"}),r.jsx(ne,{initialValues:e,validationSchema:Oe,onSubmit:D,innerRef:t,onReset:()=>n(),children:({values:m,errors:o,touched:l,setFieldValue:i})=>{const c=p=>{i("csvfile",[...m.csvfile,...p])},C=p=>{T.show({title:"Invalid Files",message:"Some files were rejected due to invalid format.",color:"red"}),console.error("Rejected files:",p)},k=p=>{const j=m.csvfile.filter(L=>L.name!==p);i("csvfile",j),n()};return r.jsxs(ce,{children:[r.jsx(de,{onDrop:c,onReject:C,uploadedFiles:m.csvfile,onDeleteFile:k,dropzoneText:{title:"Upload files with relevant data",description:"You can upload at max 10 files with size not exceeding 5 MB",rejectMessage:"Invalid file type. Only CSV files are allowed."},maxFiles:10}),(o==null?void 0:o.csvfile)&&(l==null?void 0:l.csvfile)&&r.jsx("div",{style:{color:"red",marginTop:"10px"},children:o==null?void 0:o.csvfile}),r.jsxs(Q,{mt:"md",justify:"center",children:[r.jsx(F,{type:"submit",loading:!1,children:"Submit"}),r.jsx(F,{type:"reset",variant:"outline",children:"Reset"})]})]})}}),r.jsx(fe,{visible:u,zIndex:1e3,overlayProps:{radius:"sm",blur:2}}),((S=t.current)==null?void 0:S.errors)&&r.jsx(me,{response:(v=a==null?void 0:a.response)==null?void 0:v.data}),y&&r.jsxs(le,{direction:"column",align:"center",mt:"10px",children:[r.jsx(ue,{stroke:2,size:40,color:h.colors.green[6]}),r.jsxs(N,{size:"lg",style:{fontWeight:"600",color:h.colors.gray[7],textAlign:"center"},children:[" ",'Orders are saved successfully. You can see uploaded orders by switching tab to "All Orders".']})]})]})})};function _e(){const e=[{label:"All Orders",value:"All_Orders",content:r.jsx(Ie,{})},{label:"Upload Files",value:"Upload_Files",content:r.jsx(Me,{})}];return r.jsx(_,{tabs:e})}export{_e as default};
