import{z as D,j as e,Q as B,S as R,I as U,r as v,M as W,A as z,F as q,V as Q,N as _,G as M,q as y,B as $,t as w,W as X,R as Z,l as J,P as ee,k,D as E}from"./index-BGPQORr6.js";import{A as ae}from"./AppTabs-H8h3vPNQ.js";import{c as re,B as te,o as P,u as se,M as le,a as ie,D as oe,F as ne}from"./MUIThemeProvider-DYjjTKgw.js";import{u as ce,A as K,a as Y}from"./ApiConstants-D1IcDG0W.js";import{A as de}from"./AppChipComponent-DILUgXEY.js";import{c as me,D as C,I as ue,a as he,T as pe,b as fe,M as N}from"./index-D2jK04Ng.js";import{c as ye,g as be,F as Se,h as xe}from"./index.esm-DYQ8eCU5.js";import{I as ve}from"./IconX-DlvAfq5S.js";import{T as S}from"./Text-Bw2S6QYb.js";import{L,I as Te,T as h,S as ge}from"./IconTrash-BdsgRmiH.js";import{u as Ce,L as De}from"./DateTimePicker-CSAYhhtV.js";import{C as Ie}from"./Card-DBbWKMhb.js";import{A as je}from"./Alert-B7aDEzum.js";import{T as Ee}from"./Title-DxxQha-n.js";import"./helperFuntions-IpEH5JRM.js";/**
 * @license @tabler/icons-react v3.21.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Ne=D("outline","alert-circle","IconAlertCircle",[["path",{d:"M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0",key:"svg-0"}],["path",{d:"M12 8v4",key:"svg-1"}],["path",{d:"M12 16h.01",key:"svg-2"}]]);/**
 * @license @tabler/icons-react v3.21.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Fe=D("outline","clipboard-list","IconClipboardList",[["path",{d:"M9 5h-2a2 2 0 0 0 -2 2v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-12a2 2 0 0 0 -2 -2h-2",key:"svg-0"}],["path",{d:"M9 3m0 2a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v0a2 2 0 0 1 -2 2h-2a2 2 0 0 1 -2 -2z",key:"svg-1"}],["path",{d:"M9 12l.01 0",key:"svg-2"}],["path",{d:"M13 12l2 0",key:"svg-3"}],["path",{d:"M9 16l.01 0",key:"svg-4"}],["path",{d:"M13 16l2 0",key:"svg-5"}]]);/**
 * @license @tabler/icons-react v3.21.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Oe=D("outline","currency-euro","IconCurrencyEuro",[["path",{d:"M17.2 7a6 7 0 1 0 0 10",key:"svg-0"}],["path",{d:"M13 10h-8m0 4h8",key:"svg-1"}]]);/**
 * @license @tabler/icons-react v3.21.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Me=D("outline","thumb-up","IconThumbUp",[["path",{d:"M7 11v8a1 1 0 0 1 -1 1h-2a1 1 0 0 1 -1 -1v-7a1 1 0 0 1 1 -1h3a4 4 0 0 0 4 -4v-1a2 2 0 0 1 4 0v5h3a2 2 0 0 1 2 2l-1 5a2 3 0 0 1 -2 2h-7a3 3 0 0 1 -3 -3",key:"svg-0"}]]);const Pe=re(e.jsx("path",{d:"M22 16V4c0-1.1-.9-2-2-2H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2m-11-4 2.03 2.71L16 11l4 5H8zM2 6v14c0 1.1.9 2 2 2h14v-2H4V6z"}),"Collections");function A(a){return R(a,"DD MMM YYYY hh:mm A").format("YYYY-MM-DDTHH:mm:ss.SSS[Z]")}const F=["merchantId","pageNo","limit","customerId","orderType","paymentType","confirmationStatus","status","paymentStatus","branchName","orderId"],ke=a=>{let t={};return a==null||a.forEach(s=>{var r;F!=null&&F.includes(s.id)&&(Array.isArray(s.value)?t[s.id]=(r=s.value)==null?void 0:r.join(","):t[s.id]=s.value)}),t},Le=a=>{var o,c;let t="";const s=(o=a==null?void 0:a[0])==null?void 0:o.id,r=(c=a==null?void 0:a[0])==null?void 0:c.desc;if(s==="customerFirstName"&&!r?t="ascFirstName":s==="customerFirstName"&&r?t="descFirstName":s==="customerLastName"&&!r?t="ascLastName":s==="customerLastName"&&r?t="descLastName":s==="orderDate"&&!r?t="ascOrder":s==="orderDate"&&r&&(t="descOrder"),t)return{sort:t}},Ae=a=>{let t="",s="";const r=a==null?void 0:a.find(o=>o.id==="orderDate");if(r&&Array.isArray(r==null?void 0:r.value)&&(t=r!=null&&r.value[0]?A(r==null?void 0:r.value[0]):"",s=r!=null&&r.value[1]?A(r==null?void 0:r.value[1]):""),t||s)return{startDate:t,endDate:s}};function Re(a,t,s){const r={merchantId:null,pageNo:s.pageIndex+1,limit:s.pageSize,...Le(t),...ke(a),...Ae(a)};return K.GET(Y.GET_ALL_ORDERS(),{params:r})}const ze=a=>{const{columnFilters:t,EnableQuery:s,sorting:r,pagination:o}=a;return ce({queryKey:["Orders-Grid-data",t,r,o],queryFn:()=>Re(t,r,o),placeholderData:B,enabled:s,refetchOnMount:!1,refetchOnWindowFocus:!1,retry:2})},O=({renderedCellValue:a})=>e.jsxs(te,{sx:{display:"flex",alignItems:"center",gap:"0.5rem",justifyContent:"center"},children:[a==="CASH"&&e.jsx(Oe,{}),a==="CARD"&&e.jsx(me,{}),a==="DELIVERY"&&e.jsx(U,{}),a==="COLLECTION"&&e.jsx(Pe,{}),e.jsx("span",{children:a})]}),we=[{key:"merchantId",name:"merchantId",fieldType:"Number",label:"Merchant ID",disabled:{disabledFieldForNew:!1}},{key:"orderId",name:"orderId",fieldType:"Number",label:"Order ID",disabled:{disabledFieldForNew:!0,disableFieldForEdit:!0}},{key:"orderDate",name:"orderDate",fieldType:"DateTimeRange",label:"Order Date",disabled:{disabledFieldForNew:!1,disableFieldForEdit:!0}},{key:"customerId",name:"customerId",fieldType:"Number",label:"Customer ID",disabled:{disabledFieldForNew:!1}},{key:"customerFirstName",name:"customerFirstName",fieldType:"Text",label:"Customer First Name"},{key:"customerLastName",name:"customerLastName",fieldType:"Text",label:"Customer Last Name"},{key:"orderType",name:"orderType",fieldType:"Select",label:"Order Type",meta:{options:[{label:"DELIVERY",value:"DELIVERY"},{label:"COLLECTION",value:"COLLECTION"}]}},{key:"paymentType",name:"paymentType",fieldType:"Select",label:"Payment Type",meta:{options:[{label:"CASH",value:"CASH"},{label:"CARD",value:"CARD"}]}},{key:"paymentStatus",name:"paymentStatus",fieldType:"Select",label:"Payment Status",meta:{options:[{label:"COMPLETED",value:"COMPLETED"},{label:"PENDING",value:"PENDING"},{label:"PROCESSED",value:"PROCESSED"}]}},{key:"confirmationStatus",name:"confirmationStatus",fieldType:"Select",label:"Confirmation Status",meta:{options:[{label:"COMPLETED",value:"COMPLETED"},{label:"PENDING",value:"PENDING"}]}},{key:"promoCode",name:"promoCode",fieldType:"Text",label:"Promo Code"},{key:"promoDiscountSwishr",name:"promoDiscountSwishr",fieldType:"Number",label:"Promo Discount (SWISHR)"},{key:"promoDiscountMerchant",name:"promoDiscountMerchant",fieldType:"Number",label:"Promo Discount (Merchant)"},{key:"refundSwishr",name:"refundSwishr",fieldType:"Number",label:"Refund (SWISHR)"},{key:"refundMerchant",name:"refundMerchant",fieldType:"Number",label:"Refund (Merchant)"},{key:"orderDiscount",name:"orderDiscount",fieldType:"Number",label:"Order Discount"},{key:"driverTip",name:"driverTip",fieldType:"Number",label:"Driver Tip"},{key:"deliveryCharge",name:"deliveryCharge",fieldType:"Number",label:"Delivery Charge"},{key:"serviceFee",name:"serviceFee",fieldType:"Number",label:"Service Fee"},{key:"surcharge",name:"surcharge",fieldType:"Number",label:"Surcharge"},{key:"subTotal",name:"subTotal",fieldType:"Number",label:"Sub Total"},{key:"taxes",name:"taxes",fieldType:"Number",label:"Taxes"},{key:"total",name:"total",fieldType:"Number",label:"Total"},{key:"branchName",name:"branchName",fieldType:"Text",label:"Branch Name"},{key:"status",name:"status",fieldType:"Select",label:"Status",meta:{options:P}}],Ke=({data:a,columns:t})=>{const s=se({columns:t,data:a,enableFullScreenToggle:!1,enableHiding:!1});return e.jsx(le,{table:s})},Ye=()=>{var f,n;const[a,t]=v.useState([]),[s,r]=v.useState([]),[o,c]=v.useState({pageIndex:0,pageSize:10}),[b,{open:p,close:d}]=W(!1),{data:m,isError:I,isLoading:T}=ze({columnFilters:a,EnableQuery:!b,sorting:s,pagination:o}),g=v.useMemo(()=>[{accessorKey:"merchantId",header:"Merchant ID",enableSorting:!1,size:150},{accessorKey:"orderId",header:"Order ID",enableSorting:!1,size:150},{accessorKey:"customerId",header:"Customer ID",enableSorting:!1,size:150,enableEditing:!1},{accessorKey:"branchName",header:"Branch Name",enableSorting:!1},{accessorKey:"orderDate",accessorFn:l=>new Date(l.orderDate),header:"Order Date",filterVariant:"datetime-range",Cell:({cell:l})=>{const i=l.getValue();return R(i).format("DD MMM YYYY hh:mm A")},muiFilterDateTimePickerProps:{label:"Order Date",timeSteps:{minutes:1}},maxSize:150},{accessorKey:"customerFirstName",header:"Customer First Name",enableColumnFilter:!1},{accessorKey:"customerLastName",header:"Customer Last Name",enableColumnFilter:!1},{accessorKey:"orderType",header:"Order Type",filterVariant:"multi-select",filterSelectOptions:[{label:"DELIVERY",value:"DELIVERY"},{label:"COLLECTION",value:"COLLECTION"}],enableSorting:!1,maxSize:30,Cell:({renderedCellValue:l})=>O({renderedCellValue:l})},{accessorKey:"paymentType",header:"Payment Type",filterVariant:"multi-select",filterSelectOptions:[{label:"CASH",value:"CASH"},{label:"CARD",value:"CARD"}],enableSorting:!1,maxSize:30,Cell:({renderedCellValue:l})=>O({renderedCellValue:l})},{accessorKey:"paymentStatus",header:"Payment Status",filterVariant:"multi-select",filterSelectOptions:[{label:"COMPLETED",value:"COMPLETED"},{label:"PENDING",value:"PENDING"},{label:"PROCESSED",value:"PROCESSED"}],enableSorting:!1,maxSize:30},{accessorKey:"confirmationStatus",header:"Confirmation Status",filterVariant:"multi-select",filterSelectOptions:[{label:"COMPLETED",value:"COMPLETED"},{label:"PENDING",value:"PENDING"}],enableSorting:!1,maxSize:30},{accessorKey:"promoCode",header:"Promo Code",enableSorting:!1,enableColumnFilter:!1,maxSize:30},{accessorKey:"promoDiscountSwishr",header:"Promo Discount (SWISHR)",enableSorting:!1,enableColumnFilter:!1,maxSize:50},{accessorKey:"promoDiscountMerchant",header:"Promo Discount (Merchant)",enableSorting:!1,enableColumnFilter:!1,maxSize:50},{accessorKey:"refundSwishr",header:"Refund (SWISHR)",enableSorting:!1,enableColumnFilter:!1,maxSize:30},{accessorKey:"refundMerchant",header:"Refund (Merchant)",enableSorting:!1,enableColumnFilter:!1,maxSize:30},{accessorKey:"orderDiscount",header:"Order Discount",enableSorting:!1,enableColumnFilter:!1,maxSize:30},{accessorKey:"driverTip",header:"Driver Tip",enableSorting:!1,enableColumnFilter:!1,maxSize:30},{accessorKey:"deliveryCharge",header:"Delivery Charge",filterVariant:"range-slider",enableSorting:!1,enableColumnFilter:!1,maxSize:30,Cell:({renderedCellValue:l})=>O({renderedCellValue:l})},{accessorKey:"serviceFee",header:"Service Fee",enableSorting:!1,enableColumnFilter:!1,maxSize:30},{accessorKey:"surcharge",header:"Surcharge",enableSorting:!1,enableColumnFilter:!1,maxSize:30},{accessorKey:"subTotal",header:"Sub Total",enableSorting:!1,enableColumnFilter:!1,maxSize:30},{accessorKey:"taxes",header:"Taxes",enableSorting:!1,enableColumnFilter:!1,maxSize:30},{accessorKey:"total",header:"Total",enableSorting:!1,enableColumnFilter:!1,maxSize:30},{accessorKey:"status",header:"Status",maxSize:30,Cell:({cell:l})=>{var i,u;return e.jsx(de,{value:((u=(i=P)==null?void 0:i.find(j=>j.value===l.getValue()))==null?void 0:u.label)??""})},filterVariant:"multi-select",enableSorting:!1,filterSelectOptions:P,editSelectOptions:[{label:"COMPLETED",value:"COMPLETED"},{label:"PENDING",value:"PENDING"}]},{accessorKey:"orderItems",header:"Order Items",enableSorting:!1,Cell:({row:l})=>e.jsx(z,{variant:"transparent",onClick:()=>{var i,u;return q.open({title:e.jsx(Q,{icon:e.jsx(Fe,{}),color:"teal",title:`Order Items for Order ID: ${(i=l==null?void 0:l.original)==null?void 0:i.orderId}`,mt:"md",withCloseButton:!1,styles:{root:{boxShadow:"none"}}}),children:e.jsx(Ke,{data:((u=l==null?void 0:l.original)==null?void 0:u.orderItems)??[],columns:[{header:"Product",accessorKey:"product"},{header:"Quantity",accessorKey:"quantity"}]}),size:"xl"})},children:e.jsx(_,{color:"green"})})}],[]);return e.jsx(ie,{children:e.jsx(oe,{data:((f=m==null?void 0:m.data)==null?void 0:f.orders)??[],columnFilters:a,columns:g,pagination:o,sorting:s,totalRowCount:((n=m==null?void 0:m.data)==null?void 0:n.totalCount)??0,onColumnFiltersChange:t,onPaginationChange:c,onSortingChange:r,isLoading:T,OnFilterButtonClicked:()=>p(),OnApplyFiltersClicked:()=>d(),filterDrawerIsOpen:b,enableRowSelection:!0,isError:I,tableName:"OrdersDisplay",columnPinning:{left:["mrt-row-select","mrt-row-actions","orderId","customerId","branchName"],right:["status"]},crudOperationHeader:"Order",uniqueIDForRows:"orderID",uiSchema:we})})},Ge=({maxSize:a=5*1024**2,maxFiles:t=10,acceptedTypes:s=[N.csv,N.xlsx,N.xls],onDrop:r,onReject:o,uploadedFiles:c=[],onDeleteFile:b,dropzoneText:p={title:"Drag your files here",description:"Attach multiple files. Each file should not exceed 5 MB, and the total file count should not exceed 10.",rejectMessage:"File format not allowed"}})=>e.jsx(C,{onDrop:r,onReject:o,maxSize:a,maxFiles:t,accept:s,style:{display:"flex",alignItems:"center",marginTop:"20px"},children:e.jsxs(M,{justify:"center",gap:"xl",children:[e.jsx(C.Accept,{children:e.jsx(ue,{style:{width:y(52),height:y(52),color:"var(--mantine-color-blue-6)"},stroke:1.5})}),e.jsxs(C.Reject,{children:[e.jsx(ve,{style:{width:y(52),height:y(52),color:"var(--mantine-color-red-6)"},stroke:1.5}),p.rejectMessage]}),e.jsx(C.Idle,{children:e.jsx(he,{style:{width:y(52),height:y(52),color:"var(--mantine-color-dimmed)"},stroke:1.5})}),e.jsxs("div",{children:[e.jsx(S,{size:"xl",inline:!0,children:p.title}),e.jsx(S,{size:"sm",c:"dimmed",inline:!0,mt:7,children:p.description}),c.length>0&&e.jsx("div",{style:{marginTop:10,color:"green"},children:e.jsx(L,{spacing:"xs",size:"sm",style:{pointerEvents:"all"},center:!0,icon:e.jsx(pe,{color:"teal",size:24,radius:"xl",children:e.jsx(fe,{style:{width:y(16),height:y(16)}})}),children:c.map(d=>e.jsx(L.Item,{children:e.jsxs(M,{align:"center",children:[e.jsx($,{children:d.name}),b&&e.jsx(z,{onClick:m=>{m.stopPropagation(),b(d.name)},style:{pointerEvents:"all"},variant:"transparent",color:"green",children:e.jsx(Te,{})},d.name)]})},d.name+`${d.size}`))})})]})]})}),He=async a=>{const t=new FormData;return a.csvfile.forEach(s=>{t.append("files",s)}),await K.POST(Y.UPLOAD_AND_PARSE_DOCUMENT(),t)},Ve=()=>Ce({mutationFn:He}),Be=({response:a})=>{const t=w();return a?e.jsxs(Ie,{padding:"lg",radius:"md",withBorder:!0,children:[e.jsx(je,{icon:e.jsx(Ne,{size:16}),title:"Error",color:"red",radius:"md",variant:"outline",mb:"lg",p:"sm",children:a.error}),e.jsxs(X,{children:[e.jsx(Ee,{order:5,mb:"md",styles:{root:{color:t.colors.gray[7]}},children:"Details:"}),e.jsxs(h,{withRowBorders:!0,withTableBorder:!0,withColumnBorders:!0,striped:!0,children:[e.jsx(h.Thead,{children:e.jsxs(h.Tr,{children:[e.jsx(h.Th,{styles:{th:{color:t.colors.gray[7]}},children:"File Name"}),e.jsx(h.Th,{styles:{th:{color:t.colors.gray[7]}},children:"Error"})]})}),e.jsx(h.Tbody,{children:a.errors.map((s,r)=>e.jsxs(h.Tr,{children:[e.jsx(h.Td,{children:e.jsx(S,{children:s.fileName})}),e.jsx(h.Td,{children:e.jsx(S,{style:{color:"red"},children:s.Error})})]},s.fileName+r))})]})]})]}):null},Ue=ye({csvfile:be().min(1,"You must upload at least one file.").required("CSV file is required.")}),We=()=>{var T,g;const a={csvfile:[]},t=v.useRef(null),{mutate:s,error:r,reset:o,isPending:c}=Ve(),[b,p]=Z.useState(!1),d=w(),m=J(),I=f=>{s({csvfile:f.csvfile},{onSuccess:n=>{var l,i;E.show({title:"Success",message:((l=n.data)==null?void 0:l.message)||"File uploaded successfully.",color:"green",position:"top-center",withCloseButton:!0,autoClose:!0}),(i=t.current)==null||i.resetForm(),m.invalidateQueries({queryKey:["Orders-Grid-data"]}),p(!0)},onError:n=>{var l,i,u;E.show({title:"Error",message:((i=(l=n.response)==null?void 0:l.data)==null?void 0:i.message)||"Failed to upload files.",color:"red"}),(u=t.current)==null||u.setErrors(n),p(!1)}})};return e.jsx(ee,{shadow:"sm",p:20,children:e.jsxs(ge,{gap:20,pos:"relative",children:[e.jsx(S,{size:"lg",style:{fontWeight:"600"},children:"Upload Excel or CSV file to store order details. (Multiple files can be uploaded)"}),e.jsx(Se,{initialValues:a,validationSchema:Ue,onSubmit:I,innerRef:t,onReset:()=>o(),children:({values:f,errors:n,touched:l,setFieldValue:i})=>{const u=x=>{i("csvfile",[...f.csvfile,...x])},j=x=>{E.show({title:"Invalid Files",message:"Some files were rejected due to invalid format.",color:"red"}),console.error("Rejected files:",x)},G=x=>{const H=f.csvfile.filter(V=>V.name!==x);i("csvfile",H),o()};return e.jsxs(xe,{children:[e.jsx(Ge,{onDrop:u,onReject:j,uploadedFiles:f.csvfile,onDeleteFile:G,dropzoneText:{title:"Upload files with relevant data",description:"You can upload at max 10 files with size not exceeding 5 MB",rejectMessage:"Invalid file type. Only CSV files are allowed."},maxFiles:10}),(n==null?void 0:n.csvfile)&&(l==null?void 0:l.csvfile)&&e.jsx("div",{style:{color:"red",marginTop:"10px"},children:n==null?void 0:n.csvfile}),e.jsxs(M,{mt:"md",justify:"center",children:[e.jsx(k,{type:"submit",loading:!1,children:"Submit"}),e.jsx(k,{type:"reset",variant:"outline",children:"Reset"})]})]})}}),e.jsx(De,{visible:c,zIndex:1e3,overlayProps:{radius:"sm",blur:2}}),((T=t.current)==null?void 0:T.errors)&&e.jsx(Be,{response:(g=r==null?void 0:r.response)==null?void 0:g.data}),b&&e.jsxs(ne,{direction:"column",align:"center",mt:"10px",children:[e.jsx(Me,{stroke:2,size:40,color:d.colors.green[6]}),e.jsxs(S,{size:"lg",style:{fontWeight:"600",color:d.colors.gray[7],textAlign:"center"},children:[" ",'Orders are saved successfully. You can see uploaded orders by switching tab to "All Orders".']})]})]})})};function na(){const a=[{label:"All Orders",value:"All_Orders",content:e.jsx(Ye,{})},{label:"Upload Files",value:"Upload_Files",content:e.jsx(We,{})}];return e.jsx(ae,{tabs:a})}export{na as default};
