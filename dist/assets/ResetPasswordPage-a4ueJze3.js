import{c as T,a as f,n as y,A as p,b as h,h as R,r as d,j as s,P as E,B as l,L as k,T as A,e as C}from"./index-QDmumIP4.js";import{c as b,a as m,d as F,F as I,b as q}from"./index.esm-DIYcYUZE.js";import{A as O}from"./index-BObyytyr.js";import{h as V}from"./helperFuntions-DGMK7A4e.js";import{F as u}from"./FormikPasswordField-pWwoAtHn.js";import{C as z}from"./Container-x0OucDPN.js";import{T as B}from"./Title-C0NKl79D.js";import{S as n}from"./Space-CVXwJAen.js";import{A as D}from"./Alert-3nYhnQfH.js";import{I as _}from"./IconAlertTriangle-P_kMejIW.js";const v=async(r,e)=>p.POST(h.RESET_PASSWORD(),{token:r,password:e}),L=()=>{const r=T();return f({mutationFn:async({token:e,password:a})=>v(e,a),onSuccess:e=>{y.show({title:"Success",message:e.data.message??"Password has been reset successfully.",color:"green",autoClose:3e3,position:"top-center"}),setTimeout(()=>r("/login"),4e3)},onError:e=>{e instanceof O&&V(e)}})},W=async r=>{if(!r)throw new Error("Token is required.");return p.POST(h.VALIDATE_RESET_PASSWORD_TOKEN(),{token:r})},$=()=>f({mutationFn:async({token:r})=>await W(r)}),os=()=>{const[r]=R(),e=r.get("token"),a=d.useRef(null),{mutate:i,isPending:w,isSuccess:c,data:H}=$(),{mutate:x,isSuccess:P,isPending:g}=L();d.useEffect(()=>{e&&i({token:e})},[e,i]);const j=b().shape({password:m().required("Password is required"),confirmPassword:m().oneOf([F("password"),""],"Passwords do not match.").required("Confirm password is required")}),S=o=>{e&&x({password:o==null?void 0:o.password,token:e})};let t;return w?t=s.jsx(l,{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"150px"},children:s.jsx(k,{size:"lg"})}):!e||!c?t=s.jsx(D,{icon:s.jsx(_,{size:"1rem"}),title:"Error",color:"red",styles:{title:{fontSize:18}},children:"Invalid or expired token. Please check your email link or request a new one."}):P?t=s.jsx(A,{c:"green",size:"lg",children:"Password reset successful! Redirecting to login..."}):c&&(t=s.jsx(I,{initialValues:{password:"",confirmPassword:""},validationSchema:j,onSubmit:S,innerRef:a,children:({handleChange:o,values:N,handleBlur:K,touched:M,errors:G})=>s.jsxs(q,{children:[s.jsx(n,{h:"md"}),s.jsx(u,{name:"password",label:"Enter new password"}),s.jsx(u,{name:"confirmPassword",label:"Confirm Password"}),s.jsx(C,{type:"submit",fullWidth:!0,loading:g,mt:"lg",children:"Reset Password"})]})})),s.jsx(z,{size:"xs",mt:"xl",children:s.jsxs(E,{p:"xl",shadow:"xs",withBorder:!0,children:[s.jsx(l,{style:{display:"flex",justifyContent:"center",flexDirection:"column",alignItems:"center"},children:s.jsx(B,{order:3,c:"gray",children:"Reset your password"})}),s.jsx(n,{h:"lg"}),t,s.jsx(n,{h:"lg"})]})})};export{os as default};
