import{y as N,z as P,A as k,b as E,D as R,r as h,F as z,j as t,I as L,l as B,S as O,a as U,K as W,M as w,P as K,T,G as _,e as I,H as Y,n as j}from"./index-QDmumIP4.js";import{A as G}from"./AppTabs-BRBMgSeL.js";import{B as A,a as V,D as q}from"./MUIThemeProvider-Hl_UDlpR.js";import{f as H,a as Q,c as $}from"./helperFuntions-DGMK7A4e.js";import{c as Z,i as J,F as X,b as ee}from"./index.esm-DIYcYUZE.js";import{F as ae,U as se,I as re}from"./UploadOrderErrorDisplay-BVjmI_BC.js";import{S as te}from"./FormikInputField-Bd876Pl6.js";import{L as le}from"./LoadingOverlay-C-xxoboR.js";import{c as ie}from"./useUpdateUser-0zO8fXV7.js";import"./Rating-CyDkRCVj.js";import"./index-BObyytyr.js";import"./Alert-3nYhnQfH.js";import"./TextInput-DaGPfqTM.js";import"./Title-C0NKl79D.js";import"./IconX-B2CmI7ur.js";import"./List-DRYfdIdh.js";import"./Card-M7JuZp82.js";function M(s){return R(s,"DD MMM YYYY hh:mm A").format("YYYY-MM-DDTHH:mm:ss.SSS[Z]")}const oe=s=>{let a={};return s==null||s.forEach(r=>{var e;Array.isArray(r.value)?a[r.id]=(e=r.value)==null?void 0:e.join(","):a[r.id]=r.value}),a},ne=s=>{var o,f;let a="";const r=(o=s==null?void 0:s[0])==null?void 0:o.id,e=(f=s==null?void 0:s[0])==null?void 0:f.desc;if(r==="customerFirstName"&&!e?a="ascFirstName":r==="customerFirstName"&&e?a="descFirstName":r==="customerLastName"&&!e?a="ascLastName":r==="customerLastName"&&e?a="descLastName":r==="registrationDate"&&!e?a="ascRegistrationDate":r==="registrationDate"&&e&&(a="descRegistrationDate"),a)return{sort:a}},de=s=>{let a="",r="";const e=s==null?void 0:s.find(o=>o.id==="registrationDate");if(e&&Array.isArray(e==null?void 0:e.value)&&(a=e!=null&&e.value[0]?M(e==null?void 0:e.value[0]):"",r=e!=null&&e.value[1]?M(e==null?void 0:e.value[1]):""),a||r)return{startDate:a,endDate:r}};function me(s,a,r){const e={pageNo:r.pageIndex+1,limit:r.pageSize,...ne(a),...oe(s),...de(s)};return k.GET(E.GET_ALL_SWISHR_COURIER_CUSTOMER_DETAILS(),{params:e})}const ce=s=>{const{columnFilters:a,EnableQuery:r,sorting:e,pagination:o}=s;return N({queryKey:["Swishr-Courier-Customers-Grid-data",a,e,o],queryFn:()=>me(a,e,o),placeholderData:P,enabled:r,refetchOnMount:!0,refetchOnWindowFocus:!1,retry:2})},ue=[{key:"customerId",name:"customerId",fieldType:"Number",label:"Customer ID",disabled:{disabledFieldForNew:!1,disableFieldForEdit:!0},hidden:{hideFieldForEDIT:!1,hideFieldForNEW:!0}},{key:"merchantId",name:"merchantId",fieldType:"Number",label:"Merchant ID"},{key:"customerFirstName",name:"customerFirstName",fieldType:"Text",label:"First Name"},{key:"customerLastName",name:"customerLastName",fieldType:"Text",label:"Last Name"},{key:"customerEmail",name:"customerEmail",fieldType:"Text",label:"Email"},{key:"customerMobile",name:"customerMobile",fieldType:"Text",label:"Mobile"},{key:"customerDOB",name:"customerDOB",fieldType:"Date",label:"Date of Birth"},{key:"registrationDate",name:"registrationDate",fieldType:"DateTimeRange",label:"Registration Date",disabled:{disabledFieldForNew:!1,disableFieldForEdit:!0}},{key:"registrationMethod",name:"registrationMethod",fieldType:"Select",label:"Registration Method",disabled:{disabledFieldForNew:!1,disableFieldForEdit:!0},meta:{options:[{label:"Web",value:"Web"}]}},{key:"zone",name:"zone",fieldType:"Select",label:"Zone",meta:{options:[{label:"Chester",value:"Chester"},{label:"Manchester",value:"Manchester"},{label:"Birmingham",value:"Birmingham"},{label:"Wrexham",value:"Wrexham"},{label:"Ellesmere Port",value:"Ellesmere Port"},{label:"Mold",value:"Mold"},{label:"London",value:"London"},{label:"Birkenhead",value:"Birkenhead"},{label:"Wirral",value:"Wirral"}]}},{key:"profileImg",name:"profileImg",fieldType:"imageInput",label:"Profile Image"},{key:"branchId",name:"branchId",fieldType:"Number",label:"Branch ID"},{key:"customerAddress",name:"customerAddress",fieldType:"Section",label:" Customer Address",fieldsInSection:[{key:"customerAddress.line1",name:"customerAddress.line1",fieldType:"Text",label:"Line 1"},{key:"customerAddress.line2",name:"customerAddress.line2",fieldType:"Text",label:"Line 2"},{key:"customerAddress.area",name:"customerAddress.area",fieldType:"Text",label:"Area"},{key:"customerAddress.city",name:"customerAddress.city",fieldType:"Text",label:"City"},{key:"customerAddress.post",name:"customerAddress.post",fieldType:"Text",label:"Postal Code"},{key:"customerAddress.country",name:"customerAddress.country",fieldType:"Text",label:"Country"}]}],fe=()=>{var d,m;const[s,a]=h.useState([]),[r,e]=h.useState([]),[o,f]=h.useState({pageIndex:0,pageSize:50}),[b,{open:v,close:C}]=z(!1),{data:c,isError:y,isLoading:p}=ce({columnFilters:s,EnableQuery:!b,sorting:r,pagination:o}),n=h.useMemo(()=>[{accessorKey:"customerId",header:"Customer ID",enableSorting:!1,maxSize:30,Cell:({cell:l,row:i})=>{var S,u,x,g,F,D;return t.jsxs(A,{sx:{display:"flex",gap:"1rem",alignItems:"center",justifyContent:"center"},children:[t.jsx("p",{children:l.getValue()}),(S=i==null?void 0:i.original)!=null&&S.profileImg?t.jsx(L,{src:`${(u=i==null?void 0:i.original)==null?void 0:u.profileImg}`,alt:`profile ${l.getValue()}`,style:{width:40,height:40,borderRadius:"50%"}}):t.jsxs(B,{color:"cyan",radius:"xl",children:[(g=(x=i==null?void 0:i.original)==null?void 0:x.customerFirstName[0])==null?void 0:g.toUpperCase()," ",(D=(F=i==null?void 0:i.original)==null?void 0:F.customerLastName[0])==null?void 0:D.toUpperCase()]})]})}},{accessorKey:"merchantId",header:"Merchant ID",enableSorting:!1,maxSize:30,enableColumnFilter:!1},{accessorKey:"customerFirstName",header:"First Name",enableSorting:!0,maxSize:50},{accessorKey:"customerLastName",header:"Last Name",enableSorting:!0,maxSize:50},{accessorKey:"customerEmail",header:"Email",enableSorting:!1,maxSize:100},{accessorKey:"customerMobile",header:"Mobile",enableSorting:!1,maxSize:30},{accessorKey:"customerAddress",header:"Address",enableSorting:!1,enableColumnFilter:!1,maxSize:200,Cell:({row:l})=>{var i;return t.jsx(A,{sx:()=>({whiteSpace:"normal",wordWrap:"break-word",maxWidth:"200px",overflowWrap:"break-word"}),children:H((i=l==null?void 0:l.original)==null?void 0:i.customerAddress)})}},{accessorKey:"customerDOB",header:"Date of Birth",enableSorting:!1,Cell:({cell:l})=>Q(l.getValue()),enableColumnFilter:!1,maxSize:50},{accessorKey:"registrationDate",header:"Registration Date",enableSorting:!0,accessorFn:l=>new Date(l.registrationDate),filterVariant:"datetime-range",Cell:({cell:l})=>$(l.getValue()),muiFilterDateTimePickerProps:{label:"Registration Date",timeSteps:{minutes:1}},maxSize:50},{accessorKey:"zone",header:"Zone",enableSorting:!1,maxSize:30,filterVariant:"multi-select",filterSelectOptions:[{label:"Chester",value:"Chester"},{label:"Manchester",value:"Manchester"},{label:"Birmingham",value:"Birmingham"},{label:"Wrexham",value:"Wrexham"},{label:"Ellesmere Port",value:"Ellesmere Port"},{label:"Mold",value:"Mold"},{label:"London",value:"London"},{label:"Birkenhead",value:"Birkenhead"},{label:"Wirral",value:"Wirral"}]},{accessorKey:"totalOrders",header:"Total Orders",enableSorting:!1,maxSize:30,enableColumnFilter:!1},{accessorKey:"branchId",header:"Branch ID",enableSorting:!1,maxSize:30,enableColumnFilter:!1}],[]);return t.jsx(V,{children:t.jsx(h.Suspense,{fallback:t.jsx(O,{height:300,width:"100%"}),children:t.jsx(q,{data:((d=c==null?void 0:c.data)==null?void 0:d.customer)??[],columnFilters:s,columns:n,pagination:o,sorting:r,totalRowCount:((m=c==null?void 0:c.data)==null?void 0:m.totalCount)??0,onColumnFiltersChange:a,onPaginationChange:f,onSortingChange:e,isLoading:p,OnFilterButtonClicked:()=>v(),OnApplyFiltersClicked:()=>C(),filterDrawerIsOpen:b,enableRowSelection:!0,isError:y,tableName:"SwishrCourierCustomersDisplay",crudOperationHeader:"Customer",columnPinning:{left:["mrt-row-select","mrt-row-actions","customerId"]},uniqueIDForRows:"customerId",uiSchema:ue})})})},pe=async s=>{const a=new FormData;return s.csvfile.forEach(r=>{a.append("files",r)}),await k.POST(E.UPLOAD_AND_PARSE_SWISHR_COURIER_CUSTOMER(),a)},he=()=>U({mutationFn:pe}),be=Z({csvfile:J().min(1,"You must upload at least one file.").required("CSV file is required.")}),ye=()=>{var c,y;const s={csvfile:[]},a=h.useRef(null),{mutate:r,error:e,reset:o,isPending:f}=he(),b=W(),v=w(),C=p=>{r({csvfile:p.csvfile},{onSuccess:n=>{var d,m;(d=a.current)==null||d.resetForm(),v.invalidateQueries({queryKey:["Swishr-Courier-Customers-Grid-data"]}),(m=Y)==null||m.open({title:"File(s) Upload Successfully",children:t.jsxs(ie,{direction:"column",align:"center",mt:"10px",children:[t.jsx(re,{stroke:2,size:40,color:b.colors.green[6]}),t.jsx(T,{size:"lg",style:{fontWeight:"600",color:b.colors.gray[7],textAlign:"center"},children:'Customers are saved successfully. You can see uploaded customers by switching tab to "All Customers".'})]}),onClose:()=>{var l;return(l=a.current)==null?void 0:l.resetForm()}})},onError:n=>{var d,m,l;j.show({title:"Error",message:((m=(d=n.response)==null?void 0:d.data)==null?void 0:m.message)||"Failed to upload files.",color:"red"}),(l=a.current)==null||l.setErrors(n)}})};return t.jsx(K,{shadow:"sm",p:20,children:t.jsxs(te,{gap:20,pos:"relative",children:[t.jsx(T,{size:"lg",style:{fontWeight:"600"},children:"Upload Excel or CSV file to store customer details. (Multiple files can be uploaded)"}),t.jsx(X,{initialValues:s,validationSchema:be,onSubmit:C,innerRef:a,onReset:()=>o(),children:({values:p,errors:n,touched:d,setFieldValue:m})=>{const l=u=>{m("csvfile",[...p.csvfile,...u])},i=u=>{j.show({title:"Invalid Files",message:"Some files were rejected due to invalid format.",color:"red"}),console.error("Rejected files:",u)},S=u=>{const x=p.csvfile.filter(g=>g.name!==u);m("csvfile",x),o()};return t.jsxs(ee,{children:[t.jsx(ae,{onDrop:l,onReject:i,uploadedFiles:p.csvfile,onDeleteFile:S,dropzoneText:{title:"Upload files with relevant data",description:"You can upload at max 10 files with size not exceeding 5 MB",rejectMessage:"Invalid file type. Only CSV files are allowed."},maxFiles:10}),(n==null?void 0:n.csvfile)&&(d==null?void 0:d.csvfile)&&t.jsx("div",{style:{color:"red",marginTop:"10px"},children:n==null?void 0:n.csvfile}),t.jsxs(_,{mt:"md",justify:"center",children:[t.jsx(I,{type:"submit",loading:!1,children:"Submit"}),t.jsx(I,{type:"reset",variant:"outline",children:"Reset"})]})]})}}),t.jsx(le,{visible:f,zIndex:1e3,overlayProps:{radius:"sm",blur:2}}),((c=a.current)==null?void 0:c.errors)&&t.jsx(se,{response:(y=e==null?void 0:e.response)==null?void 0:y.data})]})})};function ze(){const s=[{label:"Swishr Courier Customers",value:"Swishr_Courier_Customers",content:t.jsx(fe,{})},{label:"Upload Swishr Courier Customers",value:"Upload_Swishr_Courier_Customers",content:t.jsx(ye,{})}];return t.jsx(G,{tabs:s})}export{ze as default};
