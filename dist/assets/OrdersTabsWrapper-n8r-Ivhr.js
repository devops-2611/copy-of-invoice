import{k as O,j as r,E as R,F as A,A as P,b as M,H as z,J as K,r as p,K as w,x as G,M as H,N as Y,a as V,O as U,Q as W,R as q,P as B,T as I,G as Q,e as N,n as v}from"./index-C9Ciycjy.js";import{A as _}from"./AppTabs-DyuZHAwS.js";import{c as $,B as J,o as E,u as Z,M as X,a as ee,D as ae,T as re}from"./MUIThemeProvider-rthW6W32.js";import{A as te}from"./AppChipComponent-1TDGqaTD.js";import{c as se}from"./helperFuntions-7H5wIplU.js";import{I as le}from"./useUpdateUser-Diei4mhr.js";import{I as oe}from"./IconClipboardList-B-z03yuY.js";import{F as ie,c as ne,a as ce,h as de}from"./index.esm-DCdPUB21.js";import{F as me,U as ue,I as fe}from"./UploadOrderErrorDisplay-m344J0ay.js";import{S as pe}from"./Stack-Dk_up6_e.js";import{L as ye}from"./LoadingOverlay-DEuuc4vr.js";import{F as be}from"./Select-DufhBURI.js";import"./Tabs-Ds_1HGi8.js";import"./index-D3fRiVGU.js";import"./InputBase-IkFEOTEJ.js";import"./FormikInputField-nlZqF9vi.js";import"./TextInput-BjPE68lS.js";import"./Alert-v-SYRoNK.js";import"./Title-DhQLflRm.js";import"./List-fAIbLg8V.js";import"./ThemeIcon-DWizXeYx.js";import"./Card-BzBlRO1c.js";/**
 * @license @tabler/icons-react v3.31.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var he=O("outline","credit-card-pay","IconCreditCardPay",[["path",{d:"M12 19h-6a3 3 0 0 1 -3 -3v-8a3 3 0 0 1 3 -3h12a3 3 0 0 1 3 3v4.5",key:"svg-0"}],["path",{d:"M3 10h18",key:"svg-1"}],["path",{d:"M16 19h6",key:"svg-2"}],["path",{d:"M19 16l3 3l-3 3",key:"svg-3"}],["path",{d:"M7.005 15h.005",key:"svg-4"}],["path",{d:"M11 15h2",key:"svg-5"}]]);/**
 * @license @tabler/icons-react v3.31.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var Se=O("outline","currency-euro","IconCurrencyEuro",[["path",{d:"M17.2 7a6 7 0 1 0 0 10",key:"svg-0"}],["path",{d:"M13 10h-8m0 4h8",key:"svg-1"}]]);const Te=$(r.jsx("path",{d:"M22 16V4c0-1.1-.9-2-2-2H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2m-11-4 2.03 2.71L16 11l4 5H8zM2 6v14c0 1.1.9 2 2 2h14v-2H4V6z"}),"Collections");function F(e){return z(e,"DD MMM YYYY hh:mm A").format("YYYY-MM-DDTHH:mm:ss.SSS[Z]")}const x=["merchantId","pageNo","limit","customerId","orderType","paymentType","confirmationStatus","status","paymentStatus","branchName","orderId"],De=e=>{let t={};return e==null||e.forEach(s=>{var a;x!=null&&x.includes(s.id)&&(Array.isArray(s.value)?t[s.id]=(a=s.value)==null?void 0:a.join(","):t[s.id]=s.value)}),t},Ce=e=>{var n,u;let t="";const s=(n=e==null?void 0:e[0])==null?void 0:n.id,a=(u=e==null?void 0:e[0])==null?void 0:u.desc;if(s==="customerFirstName"&&!a?t="ascFirstName":s==="customerFirstName"&&a?t="descFirstName":s==="customerLastName"&&!a?t="ascLastName":s==="customerLastName"&&a?t="descLastName":s==="orderDate"&&!a?t="ascOrder":s==="orderDate"&&a&&(t="descOrder"),t)return{sort:t}},ve=e=>{let t="",s="";const a=e==null?void 0:e.find(n=>n.id==="orderDate");if(a&&Array.isArray(a==null?void 0:a.value)&&(t=a!=null&&a.value[0]?F(a==null?void 0:a.value[0]):"",s=a!=null&&a.value[1]?F(a==null?void 0:a.value[1]):""),t||s)return{startDate:t,endDate:s}};function xe(e,t,s){const a={merchantId:null,pageNo:s.pageIndex+1,limit:s.pageSize,...Ce(t),...De(e),...ve(e)};return P.GET(M.GET_ALL_ORDERS(),{params:a})}const ge=e=>{const{columnFilters:t,EnableQuery:s,sorting:a,pagination:n}=e;return R({queryKey:["Orders-Grid-data",t,a,n],queryFn:()=>xe(t,a,n),placeholderData:A,enabled:s,refetchOnMount:!0,refetchOnWindowFocus:!1,retry:2})},g=({renderedCellValue:e})=>r.jsxs(J,{sx:{display:"flex",alignItems:"center",gap:"0.5rem",justifyContent:"center"},children:[e==="CASH"&&r.jsx(Se,{}),e==="CARD"&&r.jsx(he,{}),e==="DELIVERY"&&r.jsx(K,{}),e==="COLLECTION"&&r.jsx(Te,{}),r.jsx("span",{children:e})]}),Ee=[{key:"merchantId",name:"merchantId",fieldType:"Number",label:"Merchant ID",disabled:{disabledFieldForNew:!1}},{key:"orderId",name:"orderId",fieldType:"Number",label:"Order ID",disabled:{disabledFieldForNew:!0,disableFieldForEdit:!0}},{key:"orderDate",name:"orderDate",fieldType:"DateTimeRange",label:"Order Date",disabled:{disabledFieldForNew:!1,disableFieldForEdit:!0}},{key:"customerId",name:"customerId",fieldType:"Number",label:"Customer ID",disabled:{disabledFieldForNew:!1}},{key:"customerFirstName",name:"customerFirstName",fieldType:"Text",label:"Customer First Name"},{key:"customerLastName",name:"customerLastName",fieldType:"Text",label:"Customer Last Name"},{key:"orderType",name:"orderType",fieldType:"Select",label:"Order Type",meta:{options:[{label:"DELIVERY",value:"DELIVERY"},{label:"COLLECTION",value:"COLLECTION"}]}},{key:"paymentType",name:"paymentType",fieldType:"Select",label:"Payment Type",meta:{options:[{label:"CASH",value:"CASH"},{label:"CARD",value:"CARD"}]}},{key:"paymentStatus",name:"paymentStatus",fieldType:"Select",label:"Payment Status",meta:{options:[{label:"COMPLETED",value:"COMPLETED"},{label:"PENDING",value:"PENDING"},{label:"PROCESSED",value:"PROCESSED"}]}},{key:"confirmationStatus",name:"confirmationStatus",fieldType:"Select",label:"Confirmation Status",meta:{options:[{label:"COMPLETED",value:"COMPLETED"},{label:"PENDING",value:"PENDING"}]}},{key:"promoCode",name:"promoCode",fieldType:"Text",label:"Promo Code"},{key:"promoDiscountSwishr",name:"promoDiscountSwishr",fieldType:"Number",label:"Promo Discount (SWISHR)"},{key:"promoDiscountMerchant",name:"promoDiscountMerchant",fieldType:"Number",label:"Promo Discount (Merchant)"},{key:"refundSwishr",name:"refundSwishr",fieldType:"Number",label:"Refund (SWISHR)"},{key:"refundMerchant",name:"refundMerchant",fieldType:"Number",label:"Refund (Merchant)"},{key:"orderDiscount",name:"orderDiscount",fieldType:"Number",label:"Order Discount"},{key:"driverTip",name:"driverTip",fieldType:"Number",label:"Driver Tip"},{key:"deliveryCharge",name:"deliveryCharge",fieldType:"Number",label:"Delivery Charge"},{key:"serviceFee",name:"serviceFee",fieldType:"Number",label:"Service Fee"},{key:"surcharge",name:"surcharge",fieldType:"Number",label:"Surcharge"},{key:"subTotal",name:"subTotal",fieldType:"Number",label:"Sub Total"},{key:"taxes",name:"taxes",fieldType:"Number",label:"Taxes"},{key:"total",name:"total",fieldType:"Number",label:"Total"},{key:"branchName",name:"branchName",fieldType:"Text",label:"Branch Name"},{key:"status",name:"status",fieldType:"Select",label:"Status",meta:{options:E}}],Ie=({data:e,columns:t})=>{const s=Z({columns:t,data:e,enableFullScreenToggle:!1,enableHiding:!1});return r.jsx(X,{table:s})},Ne=()=>{var m,o;const[e,t]=p.useState([]),[s,a]=p.useState([]),[n,u]=p.useState({pageIndex:0,pageSize:50}),[y,{open:b,close:h}]=w(!1),{data:d,isError:D,isLoading:S}=ge({columnFilters:e,EnableQuery:!y,sorting:s,pagination:n}),T=p.useMemo(()=>[{accessorKey:"orderId",header:"Order ID",enableSorting:!1,size:150},{accessorKey:"branchName",header:"Branch Name",enableSorting:!1},{accessorKey:"customerId",header:"Customer ID",enableSorting:!1,size:150,enableEditing:!1},{accessorKey:"orderDate",accessorFn:l=>new Date(l.orderDate),header:"Order Date",filterVariant:"datetime-range",Cell:({cell:l})=>se(l.getValue()),muiFilterDateTimePickerProps:{label:"Order Date",timeSteps:{minutes:1}},maxSize:150},{accessorKey:"customerFirstName",header:"Customer First Name",enableColumnFilter:!1},{accessorKey:"customerLastName",header:"Customer Last Name",enableColumnFilter:!1},{accessorKey:"orderType",header:"Order Type",filterVariant:"multi-select",filterSelectOptions:[{label:"DELIVERY",value:"DELIVERY"},{label:"COLLECTION",value:"COLLECTION"}],enableSorting:!1,maxSize:30,Cell:({renderedCellValue:l})=>g({renderedCellValue:l})},{accessorKey:"paymentType",header:"Payment Type",filterVariant:"multi-select",filterSelectOptions:[{label:"CASH",value:"CASH"},{label:"CARD",value:"CARD"}],enableSorting:!1,maxSize:30,Cell:({renderedCellValue:l})=>g({renderedCellValue:l})},{accessorKey:"paymentStatus",header:"Payment Status",filterVariant:"multi-select",filterSelectOptions:[{label:"COMPLETED",value:"COMPLETED"},{label:"PENDING",value:"PENDING"},{label:"PROCESSED",value:"PROCESSED"}],enableSorting:!1,maxSize:30},{accessorKey:"confirmationStatus",header:"Confirmation Status",filterVariant:"multi-select",filterSelectOptions:[{label:"COMPLETED",value:"COMPLETED"},{label:"PENDING",value:"PENDING"}],enableSorting:!1,maxSize:30},{accessorKey:"promoCode",header:"Promo Code",enableSorting:!1,enableColumnFilter:!1,maxSize:30},{accessorKey:"promoDiscountSwishr",header:"Promo Discount (SWISHR)",enableSorting:!1,enableColumnFilter:!1,maxSize:50},{accessorKey:"promoDiscountMerchant",header:"Promo Discount (Merchant)",enableSorting:!1,enableColumnFilter:!1,maxSize:50},{accessorKey:"refundSwishr",header:"Refund (SWISHR)",enableSorting:!1,enableColumnFilter:!1,maxSize:30},{accessorKey:"refundMerchant",header:"Refund (Merchant)",enableSorting:!1,enableColumnFilter:!1,maxSize:30},{accessorKey:"orderDiscount",header:"Order Discount",enableSorting:!1,enableColumnFilter:!1,maxSize:30},{accessorKey:"driverTip",header:"Driver Tip",enableSorting:!1,enableColumnFilter:!1,maxSize:30},{accessorKey:"deliveryCharge",header:"Delivery Charge",filterVariant:"range-slider",enableSorting:!1,enableColumnFilter:!1,maxSize:30,Cell:({renderedCellValue:l})=>g({renderedCellValue:l})},{accessorKey:"serviceFee",header:"Service Fee",enableSorting:!1,enableColumnFilter:!1,maxSize:30},{accessorKey:"surcharge",header:"Surcharge",enableSorting:!1,enableColumnFilter:!1,maxSize:30},{accessorKey:"subTotal",header:"Sub Total",enableSorting:!1,enableColumnFilter:!1,maxSize:30},{accessorKey:"taxes",header:"Taxes",enableSorting:!1,enableColumnFilter:!1,maxSize:30},{accessorKey:"total",header:"Total",enableSorting:!1,enableColumnFilter:!1,maxSize:30},{accessorKey:"orderItems",header:"Order Items",enableSorting:!1,Cell:({row:l})=>r.jsx(G,{variant:"transparent",onClick:()=>{var i,c;return H.open({title:r.jsx(Y,{icon:r.jsx(oe,{}),color:"teal",title:`Order Items for Order ID: ${(i=l==null?void 0:l.original)==null?void 0:i.orderId}`,mt:"md",withCloseButton:!1,styles:{root:{boxShadow:"none"}}}),children:r.jsx(Ie,{data:((c=l==null?void 0:l.original)==null?void 0:c.orderItems)??[],columns:[{header:"Product",accessorKey:"product"},{header:"Quantity",accessorKey:"quantity"}]}),size:"xl"})},children:r.jsx(le,{color:"green"})})},{accessorKey:"status",header:"Status",maxSize:60,Cell:({cell:l})=>{var i,c;return r.jsx(te,{value:((c=(i=E)==null?void 0:i.find(C=>C.value===l.getValue()))==null?void 0:c.label)??""})},filterVariant:"multi-select",enableSorting:!1,filterSelectOptions:E,editSelectOptions:[{label:"COMPLETED",value:"COMPLETED"},{label:"PENDING",value:"PENDING"}]},{accessorKey:"merchantId",header:"Merchant ID",enableSorting:!1,size:150}],[]);return r.jsx(ee,{children:r.jsx(ae,{data:((m=d==null?void 0:d.data)==null?void 0:m.orders)??[],columnFilters:e,columns:T,pagination:n,sorting:s,totalRowCount:((o=d==null?void 0:d.data)==null?void 0:o.totalCount)??0,onColumnFiltersChange:t,onPaginationChange:u,onSortingChange:a,isLoading:S,OnFilterButtonClicked:()=>b(),OnApplyFiltersClicked:()=>h(),filterDrawerIsOpen:y,enableRowSelection:!0,isError:D,tableName:re.OrdersDisplay,columnPinning:{left:["mrt-row-select","orderId","branchName"],right:["mrt-row-actions"]},crudOperationHeader:"Order",uniqueIDForRows:"orderId",uiSchema:Ee})})},Fe=async e=>{const t=new FormData;return e.csvfile.forEach(s=>{t.append("files",s)}),await P.POST(M.UPLOAD_AND_PARSE_DOCUMENT(),t)},Oe=()=>V({mutationFn:Fe}),Pe=ne({csvfile:de().min(1,"You must upload at least one file.").required("CSV file is required.")}),Me=()=>{var S,T;const e={csvfile:[]},t=p.useRef(null),{mutate:s,error:a,reset:n,isPending:u}=Oe(),[y,b]=U.useState(!1),h=W(),d=q(),D=m=>{s({csvfile:m.csvfile},{onSuccess:o=>{var l,i;v.show({title:"Success",message:((l=o.data)==null?void 0:l.message)||"File uploaded successfully.",color:"green",position:"top-center",withCloseButton:!0,autoClose:!0}),(i=t.current)==null||i.resetForm(),d.invalidateQueries({queryKey:["Orders-Grid-data"]}),b(!0)},onError:o=>{var l,i,c;v.show({title:"Error",message:((i=(l=o.response)==null?void 0:l.data)==null?void 0:i.message)||"Failed to upload files.",color:"red"}),(c=t.current)==null||c.setErrors(o),b(!1)}})};return r.jsx(B,{shadow:"sm",p:20,children:r.jsxs(pe,{gap:20,pos:"relative",children:[r.jsx(I,{size:"lg",style:{fontWeight:"600"},children:"Upload Excel or CSV file to store order details. (Multiple files can be uploaded)"}),r.jsx(ie,{initialValues:e,validationSchema:Pe,onSubmit:D,innerRef:t,onReset:()=>n(),children:({values:m,errors:o,touched:l,setFieldValue:i})=>{const c=f=>{i("csvfile",[...m.csvfile,...f])},C=f=>{v.show({title:"Invalid Files",message:"Some files were rejected due to invalid format.",color:"red"}),console.error("Rejected files:",f)},j=f=>{const L=m.csvfile.filter(k=>k.name!==f);i("csvfile",L),n()};return r.jsxs(ce,{children:[r.jsx(me,{onDrop:c,onReject:C,uploadedFiles:m.csvfile,onDeleteFile:j,dropzoneText:{title:"Upload files with relevant data",description:"You can upload at max 10 files with size not exceeding 5 MB",rejectMessage:"Invalid file type. Only CSV files are allowed."},maxFiles:10}),(o==null?void 0:o.csvfile)&&(l==null?void 0:l.csvfile)&&r.jsx("div",{style:{color:"red",marginTop:"10px"},children:o==null?void 0:o.csvfile}),r.jsxs(Q,{mt:"md",justify:"center",children:[r.jsx(N,{type:"submit",loading:!1,children:"Submit"}),r.jsx(N,{type:"reset",variant:"outline",children:"Reset"})]})]})}}),r.jsx(ye,{visible:u,zIndex:1e3,overlayProps:{radius:"sm",blur:2}}),((S=t.current)==null?void 0:S.errors)&&r.jsx(ue,{response:(T=a==null?void 0:a.response)==null?void 0:T.data}),y&&r.jsxs(be,{direction:"column",align:"center",mt:"10px",children:[r.jsx(fe,{stroke:2,size:40,color:h.colors.green[6]}),r.jsxs(I,{size:"lg",style:{fontWeight:"600",color:h.colors.gray[7],textAlign:"center"},children:[" ",'Orders are saved successfully. You can see uploaded orders by switching tab to "All Orders".']})]})]})})};function ea(){const e=[{label:"All Orders",value:"All_Orders",content:r.jsx(Ne,{})},{label:"Upload Files",value:"Upload_Files",content:r.jsx(Me,{})}];return r.jsx(_,{tabs:e})}export{ea as default};
