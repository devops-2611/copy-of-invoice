import{c as y,a as f,f as T,n as R,A as p,b as w,i as E,r as d,j as s,C as k,P as A,B as n,L as C,T as b,e as F}from"./index-C9Ciycjy.js";import{c as I,b as m,d as q,F as z,a as O}from"./index.esm-DCdPUB21.js";import{h as B}from"./helperFuntions-7H5wIplU.js";import{F as u}from"./FormikPasswordField-B7n9rola.js";import{T as V}from"./Title-DhQLflRm.js";import{S as i}from"./Space-BNO5XJcw.js";import{A as D}from"./Alert-v-SYRoNK.js";import{I as _}from"./IconAlertTriangle-CAjJUaI8.js";import"./InputBase-IkFEOTEJ.js";const v=async(r,e)=>p.POST(w.RESET_PASSWORD(),{token:r,password:e}),L=()=>{const r=y();return f({mutationFn:async({token:e,password:a})=>v(e,a),onSuccess:e=>{R.show({title:"Success",message:e.data.message??"Password has been reset successfully.",color:"green",autoClose:3e3,position:"top-center"}),setTimeout(()=>r("/login"),4e3)},onError:e=>{e instanceof T&&B(e)}})},$=async r=>{if(!r)throw new Error("Token is required.");return p.POST(w.VALIDATE_RESET_PASSWORD_TOKEN(),{token:r})},H=()=>f({mutationFn:async({token:r})=>await $(r)}),rs=()=>{const[r]=E(),e=r.get("token"),a=d.useRef(null),{mutate:c,isPending:x,isSuccess:l}=H(),{mutate:h,isSuccess:P,isPending:g}=L();d.useEffect(()=>{e&&c({token:e})},[e,c]);const j=I().shape({password:m().required("Password is required"),confirmPassword:m().oneOf([q("password"),""],"Passwords do not match.").required("Confirm password is required")}),S=o=>{e&&h({password:o==null?void 0:o.password,token:e})};let t;return x?t=s.jsx(n,{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"150px"},children:s.jsx(C,{size:"lg"})}):!e||!l?t=s.jsx(D,{icon:s.jsx(_,{size:"1rem"}),title:"Error",color:"red",styles:{title:{fontSize:18}},children:"Invalid or expired token. Please check your email link or request a new one."}):P?t=s.jsx(b,{c:"green",size:"lg",children:"Password reset successful! Redirecting to login..."}):l&&(t=s.jsx(z,{initialValues:{password:"",confirmPassword:""},validationSchema:j,onSubmit:S,innerRef:a,children:({handleChange:o,values:N,handleBlur:W,touched:K,errors:M})=>s.jsxs(O,{children:[s.jsx(i,{h:"md"}),s.jsx(u,{name:"password",label:"Enter new password"}),s.jsx(u,{name:"confirmPassword",label:"Confirm Password"}),s.jsx(n,{style:{display:"flex",justifyContent:"center"},children:s.jsx(F,{type:"submit",size:"md",w:200,loading:g,mt:"lg",children:"Reset Password"})})]})})),s.jsx(k,{size:"xs",mt:"xl",children:s.jsxs(A,{p:"xl",shadow:"xs",withBorder:!0,children:[s.jsx(n,{style:{display:"flex",justifyContent:"center",flexDirection:"column",alignItems:"center"},children:s.jsx(V,{order:3,c:"gray",children:"Reset your password"})}),s.jsx(i,{h:"lg"}),t,s.jsx(i,{h:"lg"})]})})};export{rs as default};
